## [2381.å­—æ¯ç§»ä½ II ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/shifting-letters-ii/solutions/100000/by-lfool-ipl4)

ä½œè€…ï¼š[lfool](https://leetcode.cn/u/lfool)

# [å¦‚æœæƒ³è¦æŸ¥çœ‹ä½œè€…æ›´å¤šæ–‡ç« ï¼Œå¯ä»¥ç‚¹å‡»æ­¤å¤„ï¼ï¼ï¼ğŸ”¥ğŸ”¥ğŸ”¥](https://lfool.github.io/LFool-Notes/)

# [ä¸ºäº†æœ¬ç¯‡æ–‡ç« æ›´å¥½çš„è§‚æ„Ÿï¼Œå¯ä»¥ç‚¹å‡»æ­¤å¤„ï¼ï¼ï¼](https://lfool.github.io/LFool-Notes/algorithm/å·®åˆ†æ•°ç»„æŠ€å·§.html)

[6158. å­—æ¯ç§»ä½ II](https://leetcode.cn/problems/shifting-letters-ii/)

[1109. èˆªç­é¢„è®¢ç»Ÿè®¡](https://leetcode-cn.com/problems/corporate-flight-bookings/)

[1094. æ‹¼è½¦](https://leetcode-cn.com/problems/car-pooling/)

---

åœ¨ä»‹ç»å·®åˆ†æ•°ç»„ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹ã€Œå‰ç¼€å’Œæ•°ç»„ã€**è¯¦æƒ…å¯è§ [å‰ç¼€å’Œæ•°ç»„](https://lfool.github.io/LFool-Notes/algorithm/å‰ç¼€å’Œæ•°ç»„.html)**

**å‰ç¼€å’Œä¸»è¦é€‚ç”¨çš„åœºæ™¯æ˜¯åŸå§‹æ•°ç»„ä¸ä¼šè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œé¢‘ç¹æŸ¥è¯¢æŸä¸ªåŒºé—´çš„ç´¯åŠ å’Œ**

**å·®åˆ†æ•°ç»„çš„ä¸»è¦é€‚ç”¨åœºæ™¯æ˜¯é¢‘ç¹å¯¹åŸå§‹æ•°ç»„çš„æŸä¸ªåŒºé—´çš„å…ƒç´ è¿›è¡Œå¢å‡**

**ä½¿ç”¨åœºæ™¯**ï¼šå¯¹äºä¸€ä¸ªæ•°ç»„ `nums[]`

- è¦æ±‚ä¸€ï¼šå¯¹ `num[2...4]` å…¨éƒ¨ + 1
- è¦æ±‚äºŒï¼šå¯¹ `num[1...3]` å…¨éƒ¨ - 3
- è¦æ±‚ä¸‰ï¼šå¯¹ `num[0...4]` å…¨éƒ¨ + 9

çœ‹åˆ°ä¸Šè¿°æƒ…æ™¯ï¼Œé¦–å…ˆæƒ³åˆ°çš„è‚¯å®šæ˜¯éå†ï¼ˆbao liï¼‰ã€‚ç›´æ¥å¯¹æ•°ç»„å¾ªç¯ 3 éï¼Œæ¯æ¬¡åœ¨è§„å®šçš„åŒºé—´ä¸ŠæŒ‰è¦æ±‚è¿›è¡Œæ“ä½œï¼Œæ­¤æ—¶æ—¶é—´å¤æ‚åº¦ `O(3n)`

ä½†æ˜¯å½“è¿™æ ·çš„æ“ä½œå˜å¾—é¢‘ç¹åï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿå‘ˆçº¿æ€§é€’å¢

æ‰€ä»¥é’ˆå¯¹è¿™ç§åœºæ™¯ï¼Œæå‡ºäº†ã€Œå·®åˆ†æ•°ç»„ã€çš„æ¦‚å¿µï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­

![1036101649298970IqiB0Himage-20220407103610070.png](https://pic.leetcode-cn.com/1649302054-sjfBPU-1036101649298970IqiB0Himage-20220407103610070.png)


`diff[]` å’Œ `nums[]` çš„å…³ç³»ï¼š`diff[i] = nums[i] - nums[i - 1]`ï¼Œ`diff[0]` é™¤å¤–

**é—®é¢˜ä¸€**ï¼šè¿™æ ·å¤„ç†çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

å½“æˆ‘ä»¬éœ€è¦å¯¹ `nums[]` è¿›è¡Œä¸Šè¿°ä¸‰ä¸ªè¦æ±‚æ—¶ï¼Œä¸éœ€è¦ä¸€æ¬¡ä¸€æ¬¡çš„éå†æ•´ä¸ªæ•°ç»„äº†ï¼Œè€Œåªéœ€è¦å¯¹ `diff[]` è¿›è¡Œä¸€æ¬¡ `O(1)` çš„æ“ä½œå³å¯

- è¦æ±‚ä¸€ï¼š`diff[2] += 1;`
- è¦æ±‚äºŒï¼š`diff[1] += (-3); diff[3 + 1] -= (-3);`
- è¦æ±‚ä¸‰ï¼š`diff[0] += 9;`

**æ€»ç»“**ï¼šå¯¹äºæ”¹å˜åŒºé—´ `[i, j]` çš„å€¼ï¼Œåªéœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œ `diff[i] += val; diff[j + 1] -= val`

**æ³¨**ï¼šå½“ `j + 1 >= diff.length` æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œ `diff[j + 1] -= val` æ“ä½œ

**é—®é¢˜äºŒ**ï¼šæ€ä¹ˆé€šè¿‡ `diff[]` å¾—åˆ°æ›´æ–°åçš„æ•°ç»„å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

```java
// å¤åŸæ“ä½œ
int[] res = new int[n];
// ä¸‹æ ‡ä¸º 0 çš„å…ƒç´ ç›¸ç­‰
res[0] = diff[0];
for (int i = 1; i < n; i++) {
    res[i] = diff[i] + res[i - 1];
}
```

**é—®é¢˜ä¸‰**ï¼š`diff[]` åŸç†

å½“æˆ‘ä»¬éœ€è¦å¯¹åŒºé—´ `[i, j]` è¿›è¡Œ `+ val` æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯¹ `diff[i] += val; diff[j + 1] -= val;`

åœ¨å¤åŸæ“ä½œæ—¶ï¼Œå½“æˆ‘ä»¬æ±‚ `res[i]` æ—¶ï¼Œ`res[i - 1]` æ²¡æœ‰å˜ï¼Œè€Œ `diff[i]` å¢åŠ äº† 3ï¼Œæ‰€ä»¥ `res[i]` å¢åŠ  3

å½“æˆ‘ä»¬æ±‚ `res[i + 1]` æ—¶ï¼Œ`res[i]` å¢åŠ äº† 3ï¼Œè€Œ `diff[i + 1]` æ²¡æœ‰å˜ï¼Œæ•… `res[i + 1] = diff[i + 1] + res[i]` å¢åŠ  3ã€‚å³ï¼šè™½ç„¶ `diff[i + 1]` æ²¡æœ‰å˜ï¼Œä½†æ˜¯ `res[i]` å¯¹åé¢çš„ `res[i + 1]` æœ‰ä¸€ä¸ªç´¯ç§¯ä½œç”¨

å½“æˆ‘ä»¬æ±‚ `res[j + 1]` æ—¶ï¼Œ`res[j]` å¢åŠ äº† 3ï¼Œè€Œ `diff[j + 1]` å‡å°‘äº† 3ï¼Œæ•… `res[j + 1] = diff[j + 1] + res[j]` å¢åŠ æ²¡æœ‰å˜ã€‚å³ï¼šæˆ‘ä»¬åœ¨ `j + 1` çš„æ—¶å€™ï¼ŒæŠŠä¸Šè¿°çš„ç´¯ç§¯ä½œç”¨å»é™¤äº†ï¼Œæ‰€ä»¥ `j + 1` åé¢çš„å…ƒç´ ä¸å—å½±å“


**å®Œæ•´æ¨¡ç‰ˆ**

```java
public class Difference {

    /**
     * å·®åˆ†æ•°ç»„
     */
    private final int[] diff;

    /**
     * åˆå§‹åŒ–å·®åˆ†æ•°ç»„
     * @param nums nums
     */
    public Difference(int[] nums) {
        assert nums.length > 0;
        diff = new int[nums.length];
        diff[0] = nums[0];
        for (int i = 1; i < nums.length; i++) {
            diff[i] = nums[i] - nums[i - 1];
        }
    }

    /**
     * å¯¹åŒºé—´ [i, j] å¢åŠ  valï¼ˆval å¯ä¸ºè´Ÿæ•°ï¼‰
     * @param i i
     * @param j j
     * @param val val
     */
    public void increment(int i, int j, int val) {
        diff[i] += val;
        if (j + 1 < diff.length) {
            diff[j + 1] -= val;
        }
    }

    /**
     * å¤åŸæ“ä½œ
     * @return res
     */
    public int[] result() {
        int[] res = new int[diff.length];
        res[0] = diff[0];
        for (int i = 1; i < diff.length; i++) {
            res[i] = res[i - 1] + diff[i];
        }
        return res;
    }
}
```

## å­—æ¯ç§»ä½ II

**é¢˜ç›®è¯¦æƒ…å¯è§ [å­—æ¯ç§»ä½ II](https://leetcode.cn/problems/shifting-letters-ii/)**

```java
public String shiftingLetters(String s, int[][] shifts) {
    Difference diff = new Difference(new int[s.length()]);
    for (int[] shift : shifts) {
        diff.increment(shift[0], shift[1], shift[2] == 1 ? 1 : -1);
    }
    int[] res = diff.result();
    char[] cur = s.toCharArray();
    for (int i = 0; i < s.length(); i++) {
        int c = cur[i] - 'a';
        c = ((c + res[i]) % 26 + 26) % 26;
        cur[i] = (char) (c + 'a');
    }
    return new String(cur);
}
```