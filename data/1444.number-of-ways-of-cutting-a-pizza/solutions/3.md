## [1444.åˆ‡æŠ«è¨çš„æ–¹æ¡ˆæ•° ä¸­æ–‡çƒ­é—¨é¢˜è§£3](https://leetcode.cn/problems/number-of-ways-of-cutting-a-pizza/solutions/100000/ji-yi-hua-di-gui-bu-xu-yao-guan-dpci-xu-rong-yi-xi)

ä½œè€…ï¼š[java_Lee](https://leetcode.cn/u/java_Lee)

# é›¶ã€è¶…çº§ä»£ç å…ˆç¹ä¸ºå¿«
```python3 []
#æ‰§è¡Œç”¨æ—¶ :96 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
#å†…å­˜æ¶ˆè€— :17.6 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
class Solution:
    def ways(self, pizza, k: int) -> int:
        mod=int(1e9+7)
        row,col=len(pizza),len(pizza[0])
        DP=[{(row,col):(0,0)} for i in range(k)] 
        _FA=[[None]*col for i in range(row)]
        def FA(r,c): return (row,col) if r>=row or c>=col else _FA[r][c] 
        for r in range(row)[::-1]:     
            for c in range(col)[::-1]:   
                _FA[r][c] = (r,c) if 'A'==pizza[r][c] else tuple(map(min,zip(FA(r+1,c),FA(r,c+1)) ))
                if _FA[r][c]!=(row,col):
                    DP[0][_FA[r][c]] = (1,) 
        def dfs(r,c,rm):    
            if (r, c) in DP[rm]: return DP[rm][r, c]  
            nr, nc = FA(r+1,c)
            a0 = (dfs(nr,nc,rm)[0]+(nr-r)*sum(dfs(nr,nc,rm-1)))%mod
            nr, nc = FA(r,c+1)
            a1= (dfs(nr,nc,rm)[1]+(nc-c)*sum(dfs(nr,nc,rm-1)))%mod
            DP[rm][r, c]=(a0,a1)
            return (a0,a1)
        r0,c0=FA(0,0)
        return sum(dfs(r0,c0,k-1)) 
```
```c++ []
//æ‰§è¡Œç”¨æ—¶ :8 ms, åœ¨æ‰€æœ‰ C++ æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
//å†…å­˜æ¶ˆè€— :9.1 MB, åœ¨æ‰€æœ‰ C++ æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
typedef long long LL;
typedef pair<int,int> PINT;
typedef vector<PINT> VPINT;
const int inf = 0x7f7f7f7f;	
const long module = 1e9 + 7;
class Solution {
	static int sum(const PINT& p) { return (p.first + p.second); }
	static PINT minP(const PINT& a, const PINT& b) { return PINT(min(a.first, b.first), min(a.second, b.second)); }
	int rows, cols, acre;	
	VPINT FA;	
	vector<VPINT > DP;	
	int idx(const int&row, const int&col)const {
		if (row >= rows || col >= cols)return acre;
		return row*cols + col;
	}
	int idx(const PINT& p)const {return idx(p.first, p.second);}
	const PINT& dfs(const PINT& RC, int remain) {
		int irc = idx(RC);
		if (-1 != DP[irc][remain].first)return DP[irc][remain];	
		PINT nRC = FA[idx(RC.first + 1, RC.second)];
		int across = ((LL)(nRC.first - RC.first)*sum(dfs(nRC, remain - 1))+ dfs(nRC, remain).first) % module;
		nRC = FA[idx(RC.first, RC.second+1)];
		int vertical = ((LL)(nRC.second - RC.second)*sum(dfs(nRC, remain - 1))+ dfs(nRC, remain).second) % module;
		return DP[irc][remain] = PINT(across, vertical);	
	}
public:
	int ways(vector<string>& pizza, int k) {
		rows = pizza.size(); cols = pizza[0].length(); acre = rows*cols;
		DP.reserve(acre + 1);	DP.resize(acre, VPINT(k, PINT(-1, -1)));
		DP.push_back(VPINT(k, PINT(0, 0)));	
		FA.resize(acre + 1);	FA[acre] = PINT(inf, inf);	
		for (int r = rows; r-- > 0;) {
			for (int c = cols; c-- > 0;) {
				FA[idx(r, c)] = ('A' == pizza[r][c]) ? PINT(r, c) : minP(FA[idx(r + 1, c)], FA[idx(r, c + 1)]);
				if (FA[idx(r, c)].first != inf) {DP[idx(r, c)][0] = PINT(1, 0);	}
			}
		}
		return sum(dfs(FA[0], k - 1));
	}
};
```
# ä¸€ã€åˆ†æ
- æ ¹æ®é¢˜æ„ï¼Œåªèƒ½æ¨ªç€æˆ–ç«–ç€åˆ‡ï¼Œè€Œä¸”æ¨ªç€åˆ‡ä¸Šé¢é‚£å—å¿…é¡»ç«‹åˆ»åˆ†ç»™å®¢äººï¼Œç«–ç€åˆ‡å·¦è¾¹é‚£å—ä¹Ÿæ˜¯ã€‚
- è¿™å°±æ„å‘³ç€åœ¨åˆ‡çš„è¿‡ç¨‹ä¸­ï¼Œæ€»æ˜¯åˆ‡å‰©ä¸‹çš„å³ä¸‹çŸ©å½¢éƒ¨åˆ†çš„å­æ¯”è¨ã€‚
- é‚£ä¹ˆå¯ä»¥ç”¨è¯¥å³ä¸‹çŸ©å½¢éƒ¨åˆ†æ¯”è¨çš„å·¦ä¸Šè§’åæ ‡ï¼ˆrow,colï¼‰è¡¨ç¤ºè¿™éƒ¨åˆ†å­æ¯”è¨ä½œä¸ºå½“å‰æ­£åœ¨åˆ‡çš„å­æ¯”è¨çš„æ ‡è®°ã€‚
- è¿˜æœ‰ä¸€ä¸ªçŠ¶æ€å°±æ˜¯åˆ‡çš„æ¬¡æ•°ï¼Œæœ¬æ–‡ç”¨remainè¡¨ç¤ºè¿˜éœ€è¦åˆ‡å¤šå°‘æ¬¡ï¼Œåˆå§‹remain=k-1ã€‚
- æ‰€ä»¥é€’å½’å‡½æ•°åªéœ€è¦3ä¸ªåŠ¨æ€å‚æ•°â€”â€”row,col,remainï¼Œè€Œpizzaä½œä¸ºé™æ€å…¨å±€å˜é‡ï¼Œä¸ä¼šéšé€’å½’è¿‡ç¨‹å˜åŒ–ã€‚
# äºŒã€æš´åŠ›é€’å½’åˆ†æ
é¦–å…ˆæ¥ä¸ªæš´åŠ›é€’å½’ç®—æ³•ï¼è™½ç„¶ä¼šè¶…æ—¶ï¼Œä½†è‡³å°‘å…ˆæŠŠæ¨¡å¼æ•´å‡ºæ¥ã€‚
å®šä¹‰ pizza[row:,col:] è¡¨ç¤ºrowè¡Œä»¥ä¸‹colåˆ—å¾€å³çš„éƒ¨åˆ†pizzaã€‚(å¦‚ä¸‹ä¾‹å›¾)
![1.png](https://pic.leetcode-cn.com/42ba048b028e1c931911f5dd212e6061e0d33ac4cf90c2e97894e4ef13e8001d-1.png)
åˆ™pizza[3:,2:] å¦‚ä¸‹ï¼ˆæ³¨æ„è™½ç„¶æˆªå–å³ä¸‹éƒ¨åˆ†ï¼Œä½†æ˜¯ä¸‹æ ‡ä¸å˜ä¸å½’0ï¼ï¼‰
![2.png](https://pic.leetcode-cn.com/92d5a3e3c2d0b366bee7d9115c95b7166031ab1f2d39eba32463be61234a506c-2.png)
å¯¹äºæ¯ä¸ªå­pizzaï¼Œ
- å®šä¹‰FARï¼ˆfirst apple rowï¼‰ä¸ºå½“å‰å­pizzaä¸­ä»ä¸Šå¾€ä¸‹é¦–ä¸ªåŒ…å«è‹¹æœçš„è¡Œï¼ˆä¸å­˜åœ¨ğŸå–inf æ— ç©·å¤§ï¼‰
- å®šä¹‰FACï¼ˆfirst apple colï¼‰ä¸ºå½“å‰å­pizzaä¸­ä»å·¦å¾€å³é¦–ä¸ªåŒ…å«è‹¹æœçš„åˆ—ï¼ˆå¦‚ pizza[5:,5:]çš„FAR=FAC=infï¼‰
- é‚£ä¹ˆä¸‹ä¸€æ­¥æ¨ªåˆ‡æ˜¯ä»FAR+1çš„ä¸Šè¾¹ç•Œå¼€å§‹ï¼Œç«–åˆ‡æ˜¯ä»FAC+1çš„å·¦è¾¹ç•Œï¼ˆæˆ–è€…è¯´FACçš„å³è¾¹ç•Œï¼‰å¼€å§‹ï¼Œå°±èƒ½ä¿è¯åˆ‡ä¸‹æ¥çš„éƒ¨åˆ†ï¼ˆæ¨ªåˆ‡å–ä¸Šéƒ¨ï¼Œç«–åˆ‡å–å·¦éƒ¨ï¼‰åŒ…å«ğŸã€‚å¦‚ä¸‹å›¾å¯¹ pizza[1:,3:] é€’å½’åˆ‡æ³•æœ‰æ¨ªåˆ‡4ç§ï¼Œç«–åˆ‡1ç§ï¼Œå…±5ç§ï¼Œå®šä¹‰ï¼šæ¨ªåˆ‡çš„æ˜¯nrè¡Œçš„ä¸Šè¾¹ï¼Œç«–åˆ‡çš„æ˜¯ncåˆ—çš„å·¦è¾¹ã€‚å¦‚æ­¤å®šä¹‰æ˜¯å› ä¸ºåˆ‡å®Œå nrï¼ˆæˆ–ncï¼‰å°±ä¼šæˆä¸ºä¸‹ä¸€é€’å½’çš„å­pizzaå·¦ä¸Šè§’è¡Œå·ï¼ˆæˆ–åˆ—å·ï¼‰ã€‚
![3.png](https://pic.leetcode-cn.com/939b18797050d04f34ecd7da2bc1e0f20f63cf38bb4aa4cc37c6b6068f4cf9b2-3.png)

å°† pizza[][]ä½œä¸ºå…¨å±€å˜é‡ï¼Œé€’å½’å‡½æ•°çš„å‚æ•°åªæœ‰ï¼ˆrow,col,remainï¼‰
ä¼ªä»£ç å¦‚ä¸‹ï¼š
```PYTHON
#pizza[][]ä½œä¸ºå…¨å±€å˜é‡
#è¡¨ç¤ºå­pizza[row:,col:]åˆ‡remainæ¬¡æœ‰å¤šå°‘ç§åˆ‡æ³•
é€’å½’å‡½æ•° ways(row,col,remain)ï¼š
	if remain==0:	#ä¸€åˆ€éƒ½ä¸ç”¨åˆ‡
		if ğŸ in pizza[row:,col:]ï¼š
			return 1 #æœ€åå‰©ä¸‹çš„pizzaå«æœ‰ğŸæ‰èƒ½ç®—1ç§
		elseï¼šreturn 0ï¼›	#å¦åˆ™åˆ†å‰²æ— æ•ˆç®—0ç§
	else (remain>0):
		cnt=0	#è®¡æ•°å½“å‰å­pizza[row:,col:]çš„ways
		#éå†æ‰€æœ‰æ¨ªåˆ‡
		FAR = min{r>=row| ğŸ in pizza[r,col:] }	#å…ˆå¾—æ‰¾åˆ°pizza[row:,col:]ä¸­é¦–ä¸ªå«æœ‰ğŸçš„è¡Œ
		for(nr=FAR+1 ~ rows-1)ï¼š#ä»FARçš„ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œæ‰èƒ½ä¿è¯åˆ‡èµ°çš„ä¸Šéƒ¨æœ‰ğŸ
			#å°†pizza[row:,col:]æ¨ªåˆ‡ä¸º pizza[row:nr,col:]å’Œpizza[nr:,col:]ä¸¤éƒ¨åˆ†
			cnt += ways(nr,col,remain-1)	#é€’å½’æ±‚å‰©ä¸‹çš„å­pizza
		#éå†æ‰€æœ‰ç«–åˆ‡
		FAC = min{c>=col| ğŸ in pizza[row:,c] }	#å…ˆå¾—æ‰¾åˆ°pizza[row:,col:]ä¸­é¦–ä¸ªå«æœ‰ğŸçš„åˆ—
		for(nr=FAR+1 ~ rows-1)ï¼š#ä»FACçš„ä¸‹ä¸€åˆ—å¼€å§‹ï¼Œæ‰èƒ½ä¿è¯åˆ‡èµ°çš„å·¦éƒ¨æœ‰ğŸ
			#å°†pizza[row:,col:]ç«–åˆ‡ä¸º pizza[row:,col:nc]å’Œpizza[row,nc:]ä¸¤éƒ¨åˆ†
			cnt += ways(row,nc,remain-1)	#é€’å½’æ±‚å‰©ä¸‹çš„å­pizza
		return cntï¼›
```
# ä¸‰ã€æš´åŠ›ç®—æ³•ä»£ç ï¼š
- PYTHON3ç”¨äº†numpyçš„arrayç±»ï¼Œå¯ä»¥ç”¨åˆ‡ç‰‡å¾ˆæ–¹ä¾¿åœ°(å°±æ˜¯ç¼–ç¨‹çœäº‹)åˆ¤æ–­pizzaå±€éƒ¨æœ‰æ— ğŸ
- è€ŒC++ç‰ˆç”¨çš„æ˜¯**äºŒç»´å‰ç¼€å’Œ**æ¥åˆ¤æ–­å±€éƒ¨æœ‰æ— ğŸ
`52 / 53 ä¸ªé€šè¿‡æµ‹è¯•ç”¨ä¾‹	çŠ¶æ€ï¼šè¶…å‡ºæ—¶é—´é™åˆ¶`
```python3 []
#---------------------------ä½¿ç”¨numpyåº“arrayçš„ç‰ˆæœ¬ï¼ˆæ˜“è¯»æ€§å¥½ï¼ï¼‰----------------------------
import numpy as np
class Solution:
    def ways(self, pizza, k: int) -> int:
        module=int(1e9+7)
        rows,cols=len(pizza),len(pizza[0])
        G=np.array([np.array(['A'==ch for ch in s],dtype=bool) for s in pizza])
#        print(G)    #ä¸ºäº†æ–¹ä¾¿åšå­pizzaåˆ‡ç‰‡ï¼Œå°†pizza[]ä¸­çš„'A'Trueï¼Œ'.'æ˜ å°„ä¸ºFalseã€‚ç”¨numpyåº“çš„arrayç±»éå¸¸æ–¹ä¾¿
        # dfs: ä»¥rowè¡Œcolåˆ—ä¸ºå·¦ä¸Šè§’çš„çŸ©å½¢å­pizzaï¼Œåˆ‡remainåˆ€ï¼ˆæŒ‰é¢˜ç›®è¦æ±‚æ¯ä¸€ä»½éƒ½è¦æœ‰appleï¼‰çš„åˆ‡æ³•
        def dfs(row,col,remain):
            if remain<=0:   #å·²ç»ä¸ç”¨åˆ‡äº†
                return 1 if True in G[row:,col:] else 0#å½“å‰å­pizzaå«æœ‰appleæ—¶ç®—1ç§ã€‚å¦åˆ™ä¸ç¬¦åˆé¢˜ç›®æ‰€éœ€ï¼Œç®—0ç§ï¼
            cnt=0   #è¿˜è¦åˆ‡remainåˆ€ã€‚cntè®°å½•æœ€ç»ˆåˆ‡æ³•æ•°
            nr,nc=row,col
            while nr<rows and True not in G[nr,col:]: nr+=1   #è·³è¿‡æ²¡æœ‰appleçš„è¡Œï¼ˆåˆ‡äº†ä¸ç®—æ•°ï¼‰
            while nr<rows-1:  #æ¨ªç€åˆ‡
                nr+=1 #å…ˆ+1ï¼Œå› ä¸ºé¦–æ¬¡è¿›å…¥å¾ªç¯æ˜¯pizza[nr][col:]æ°å¥½æœ‰appleï¼Œè¦åˆ‡å…¶ä¸‹ä¸€è¡Œæ‰å¯¹
                cnt=(cnt + dfs(nr,col,remain-1))%module     #åˆ†ä¸º pizza[row:nr][col:]å’Œpizza[nr:][col:] ä¸¤ä¸ªå­pizza
            while nc<cols and True not in G[row:,nc]:nc+=1   #è·³è¿‡æ²¡æœ‰appleçš„åˆ—ï¼ˆåˆ‡äº†ä¸ç®—æ•°ï¼‰
            while nc<cols-1:  #æ¨ªç€åˆ‡
                nc+=1
                cnt=(cnt + dfs(row,nc,remain-1))%module
#            print(row,col,remain,cnt)
            return cnt
        return dfs(0,0,k-1)
```
```cpp []
typedef vector<int> VINT;
class Solution {
	const long module = 1e9 + 7;
	int rows, cols;
	vector<VINT> sumA;	//sumA[r][c]=pizza[r:,c:]ä¸­çš„è‹¹æœæ•°é‡ã€‚è¿™ç§æ–¹æ³•å«ï¼šäºŒç»´å‰ç¼€å’Œ
	//é€’å½’æ±‚pizza[r:,c:]åˆ‡remainåˆ€ï¼ˆæŒ‰é¢˜ç›®è¦æ±‚æ¯ä¸€ä»½éƒ½è¦æœ‰appleï¼‰çš„åˆ‡æ³•
	long dfs(int r, int c, int remain) {
		if (remain == 0) {	//å·²ç»ä¸ç”¨åˆ‡äº†
			return (sumA[r][c] > 0);//å½“å‰å­pizzaå«æœ‰appleæ—¶ç®—1ç§ã€‚å¦åˆ™æ— appleç®—0ç§ï¼
		}//else  è¿˜éœ€è¦åˆ‡
		long cnt = 0;	//æœ¬é€’å½’pizza[r:,c:]åˆ‡æ³•ç»“æœ
		for (int nr = r; ++nr < rows;) { //åˆ‡ä¸º[r,nr)è¡Œå’Œ[nr,rows)è¡Œ
			if (sumA[r][c] == sumA[nr][c])continue;	//è¦ä¿è¯[r,nr)è¡Œä¸”cåˆ—ä¹‹å³æœ‰è‹¹æœæ‰èƒ½åˆ‡
			cnt = (cnt + dfs(nr, c, remain - 1)) % module; 
		}
		for (int nc = c; ++nc < cols;) { //åˆ‡ä¸º[c,nc)åˆ—å’Œ[nc,cols)åˆ—ã€‚
			if(sumA[r][c] == sumA[r][nc])continue;	//è¦ä¿è¯rè¡ŒåŠä»¥ä¸‹[c,nc)åˆ—æœ‰è‹¹æœæ‰èƒ½åˆ‡
			cnt = (cnt + dfs(r, nc, remain - 1)) % module; 
		}
		return cnt;
	}
public:
	int ways(vector<string>& pizza, int k) {
		rows = pizza.size(); cols = pizza[0].length();
		sumA.resize(rows+1, VINT(cols+1, 0));		//å¤šåŠ ä¸€è¡Œä¸€åˆ—ï¼Œè¾¹ç•Œå€¼ä¸º0
		for (int r = rows; r-- > 0;) {	//å› ä¸ºæ˜¯åˆ°å³ä¸‹è§’ï¼Œæ•…é€†åºæ„é€ sumA
			for (int c = cols; c-- > 0;) {
				sumA[r][c] = (pizza[r][c] == 'A') + 
					sumA[r + 1][c] + sumA[r][c + 1] - sumA[r + 1][c + 1];
			}//äºŒç»´å‰ç¼€å’Œï¼šsum[r,c] = [r,c]è¿™æ ¼çš„æ•°é‡ + ï¼ˆä¸‹é¢æ‰€æœ‰ + å³è¾¹æ‰€æœ‰ - å³ä¸‹é‡å çš„ï¼‰
		}
		return dfs(0, 0, k - 1);
	}
};
```
# å››ã€ä»æš´åŠ›é€’å½’åˆ°è®°å¿†åŒ–é€’å½’
å½“é€’å½’å‡½æ•°çš„å‚æ•°ä¸å¤ªå¤æ‚æ—¶ï¼Œå°†é€’å½’å‡½æ•°æ”¹é€ ä¸ºè®°å¿†åŒ–é€’å½’éå¸¸ç®€å•ä¸”å¥—è·¯ï¼Œåªè¦åšä¸€ä¸ª**æ‰€æœ‰å‚æ•°**ï¼ˆrow,col,remainï¼‰åˆ°**é€’å½’è¿”å›å€¼**çš„**æ˜ å°„**ã€‚
é€’å½’å‡½æ•°å¼€å¤´å…ˆæŸ¥è¡¨ï¼ŒæŸ¥ä¸åˆ°å†è¿›è¡Œè®¡ç®—ã€‚
å…ˆä»¥python3ç‰ˆæœ¬ï¼ˆç”±æš´åŠ›numpyç‰ˆæœ¬æ”¹é€ ï¼‰ä¸ºä¾‹ï¼Œå› ä¸ºpythonå¯ä»¥å¾ˆæ–¹ä¾¿ä½¿ç”¨å­—å…¸ã€‚
```python3 []
#Pythonç‰ˆï¼šä»…ä»…æ¯”ä¿®æ”¹å‰çš„æš´åŠ›è§£æ³•numpyç‰ˆå¤šäº†3è¡Œï¼ï¼ˆæ³¨é‡Šä¸­æœ‰â˜…çš„è¡Œï¼‰
import numpy as np
class Solution:
    def ways(self, pizza, k: int) -> int:
        module=int(1e9+7)
        rows,cols=len(pizza),len(pizza[0])
        G=np.array([np.array(['A'==ch for ch in s],dtype=bool) for s in pizza])
#        print(G)    #ä¸ºäº†æ–¹ä¾¿åšå­pizzaåˆ‡ç‰‡ï¼Œå°†pizza[]ä¸­çš„'A'Trueï¼Œ'.'æ˜ å°„ä¸ºFalseã€‚ç”¨numpyåº“çš„arrayç±»éå¸¸æ–¹ä¾¿
        DP={}   #â˜…é€’å½’æŸ¥è¡¨ï¼šDP[(row,col,remain)] = ways(row,col,remain)â˜…
        # dfs: ä»¥rowè¡Œcolåˆ—ä¸ºå·¦ä¸Šè§’çš„çŸ©å½¢å­pizzaï¼Œåˆ‡remainåˆ€ï¼ˆæŒ‰é¢˜ç›®è¦æ±‚æ¯ä¸€ä»½éƒ½è¦æœ‰appleï¼‰çš„åˆ‡æ³•
        def dfs(row,col,remain):
            if (row,col,remain) in DP: return DP[(row,col,remain)]  #â˜…èƒ½æŸ¥åˆ°è¡¨ç›´æ¥è¿”å›â˜…
            if remain<=0:   #å·²ç»ä¸ç”¨åˆ‡äº†
                return 1 if True in G[row:,col:] else 0#å½“å‰å­pizzaå«æœ‰appleæ—¶ç®—1ç§ã€‚å¦åˆ™ä¸ç¬¦åˆé¢˜ç›®æ‰€éœ€ï¼Œç®—0ç§ï¼
            cnt=0   #è¿˜è¦åˆ‡remainåˆ€ã€‚cntè®°å½•æœ€ç»ˆåˆ‡æ³•æ•°
            nr,nc=row,col
            while nr<rows and True not in G[nr,col:]: nr+=1   #è·³è¿‡æ²¡æœ‰appleçš„è¡Œï¼ˆåˆ‡äº†ä¸ç®—æ•°ï¼‰
            while nr<rows-1:  #æ¨ªç€åˆ‡
                nr+=1 #å…ˆ+1ï¼Œå› ä¸ºé¦–æ¬¡è¿›å…¥å¾ªç¯æ˜¯pizza[nr][col:]æ°å¥½æœ‰appleï¼Œè¦åˆ‡å…¶ä¸‹ä¸€è¡Œæ‰å¯¹
                cnt=(cnt + dfs(nr,col,remain-1))%module     #åˆ†ä¸º pizza[row:nr][col:]å’Œpizza[nr:][col:] ä¸¤ä¸ªå­pizza
            while nc<cols and True not in G[row:,nc]:nc+=1   #è·³è¿‡æ²¡æœ‰appleçš„åˆ—ï¼ˆåˆ‡äº†ä¸ç®—æ•°ï¼‰
            while nc<cols-1:  #æ¨ªç€åˆ‡
                nc+=1
                cnt=(cnt + dfs(row,nc,remain-1))%module
            DP[(row, col, remain)]=cnt  #â˜…åˆ«å¿˜è®°å°†è¾›è‹¦æ±‚å¾—çš„ç»“æœè®°å½•åœ¨è¡¨ä¸­â˜…
            return cnt
        return dfs(0,0,k-1)
```
```cpp []
//C++ç‰ˆï¼šä»…ä»…æ¯”ä¿®æ”¹å‰çš„æš´åŠ›è§£æ³•å¤šäº†4è¡Œï¼ï¼ˆæ³¨é‡Šä¸­æœ‰â˜…çš„è¡Œï¼‰
//æ‰§è¡Œç”¨æ—¶ :40 ms, åœ¨æ‰€æœ‰ C++ æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
//å†…å­˜æ¶ˆè€— :8.7 MB, åœ¨æ‰€æœ‰ C++ æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
typedef vector<int> VINT;
typedef vector<VINT> VVINT;
class Solution {
	const long module = 1e9 + 7;
	int rows, cols;
	VVINT sumA;	//sumA[r][c]=pizza[r:,c:]ä¸­çš„è‹¹æœæ•°é‡ã€‚è¿™ç§æ–¹æ³•å«ï¼šäºŒç»´å‰ç¼€å’Œ
	vector<VVINT > DP;	//â˜…è®°å¿†åŒ–é€’å½’â€”â€”è®°å¿†è¡¨ï¼ˆ3ä¸ªå‚æ•°3ç»´ï¼‰â˜…
	//é€’å½’æ±‚pizza[r:,c:]åˆ‡remainåˆ€ï¼ˆæŒ‰é¢˜ç›®è¦æ±‚æ¯ä¸€ä»½éƒ½è¦æœ‰appleï¼‰çš„åˆ‡æ³•
	long dfs(int r, int c, int remain) {
		if (-1 != DP[r][c][remain])return DP[r][c][remain];	//â˜…è®°å¿†åŒ–é€’å½’â€”â€”è®°å½•æœ‰æ•ˆï¼Œç›´æ¥æŸ¥è¡¨â˜…
		if (remain == 0) {	//å·²ç»ä¸ç”¨åˆ‡äº†
			return DP[r][c][remain] = (sumA[r][c] > 0);//å½“å‰å­pizzaå«æœ‰appleæ—¶ç®—1ç§ã€‚å¦åˆ™æ— appleç®—0ç§ï¼
		}//else  è¿˜éœ€è¦åˆ‡
		long cnt = 0;	//æœ¬é€’å½’pizza[r:,c:]åˆ‡æ³•ç»“æœ
		int nr = r, nc = c;	//æå‰åˆ¤æ–­å¥½ä»å¤šå°‘è¡Œåˆ—å¼€å§‹åˆ‡èƒ½ä¿è¯åˆ‡èµ°çš„éƒ¨åˆ†æœ‰è‹¹æœã€‚æœ‰çš„å†™æ³•æ˜¯æ”¾è¿›å¾ªç¯ä¸­åˆ¤æ–­ï¼Œé‚£ä¸è¿˜æ˜¯è¦åˆ¤æ–­å—ï¼Ÿ
		while (++nr < rows && sumA[r][c] == sumA[nr][c]);	//è¦ä¿è¯[r,nr)è¡Œä¸”cåˆ—ä¹‹å³æœ‰è‹¹æœï¼Œè·³å‡ºå¾ªç¯å nr==FAR+1
		for (; nr < rows; ++nr) { //åˆ‡ä¸º[r,nr)è¡Œå’Œ[nr,rows)è¡Œ
			cnt = (cnt + dfs(nr, c, remain - 1)) % module; 
		}
		while (++nc < cols && sumA[r][c] == sumA[r][nc]);	//è¦ä¿è¯rè¡ŒåŠä»¥ä¸‹[c,nc)åˆ—æœ‰è‹¹æœï¼Œè·³å‡ºå¾ªç¯å nc==FAC+1
		for (; nc < cols; ++nc) { //åˆ‡ä¸º[c,nc)åˆ—å’Œ[nc,cols)åˆ—ã€‚
			cnt = (cnt + dfs(r, nc, remain - 1)) % module; 
		}
		return DP[r][c][remain] = cnt;	//â˜…è®°å¿†åŒ–é€’å½’â€”â€”è®°å¾—è®°å½•ï¼â˜…
	}
public:
	int ways(vector<string>& pizza, int k) {
		rows = pizza.size(); cols = pizza[0].length();
		DP.resize(rows, VVINT(cols, VINT(k, -1)));	//â˜…è®°å¿†åŒ–é€’å½’â€”â€”è®°å¿†è¡¨åˆå§‹åŒ–ï¼Œ-1è¡¨ç¤ºæœªè®°å½•â˜…
		sumA.resize(rows+1, VINT(cols+1, 0));		//å¤šåŠ ä¸€è¡Œä¸€åˆ—ï¼Œè¾¹ç•Œå€¼ä¸º0
		for (int r = rows; r-- > 0;) {	//å› ä¸ºæ˜¯åˆ°å³ä¸‹è§’ï¼Œæ•…é€†åºæ„é€ sumA
			for (int c = cols; c-- > 0;) {
				sumA[r][c] = (pizza[r][c] == 'A') + 
					sumA[r + 1][c] + sumA[r][c + 1] - sumA[r + 1][c + 1];
			}//äºŒç»´å‰ç¼€å’Œï¼šsum[r,c] = [r,c]è¿™æ ¼çš„æ•°é‡ + ï¼ˆä¸‹é¢æ‰€æœ‰ + å³è¾¹æ‰€æœ‰ - å³ä¸‹é‡å çš„ï¼‰
		}
		return dfs(0, 0, k - 1);
	}
};
```
å¤æ‚åº¦åˆ†æï¼š
ç”±äº dfs(r,c,remain) ræœ‰rowsä¸ªï¼Œcæœ‰colsä¸ªï¼Œremainæœ‰kä¸ªã€‚è€ŒåŒä¸€ä¸ªé€’å½’ä¸­forå¾ªç¯è‡³å¤šrows+colsæ¬¡ã€‚
æ‰€ä»¥æœ€åæ—¶é—´å¤æ‚åº¦ä¸ºï¼š`O(rows*cols*(rows+cols)*k)`
å¯¹äºä¸€èˆ¬éšæœºæ•°æ®ï¼Œèƒ½å‡å°‘çš„forå¾ªç¯å¹¶ä¸å¤šï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦æ¥è¿‘æœ€åæ—¶é—´å¤æ‚åº¦ã€‚
ç©ºé—´å¤æ‚åº¦æœ€ä¸»è¦æ˜¯DPå çš„ï¼Œä¸º`O(rows*cols*k)`

# äº”ã€å…³äºè®°å¿†åŒ–é€’å½’å’ŒåŠ¨æ€è§„åˆ’çš„çœ‹æ³•
ä½†å°±æ­¤é¢˜è€Œè¨€ï¼Œç”±äºåˆ‡pizzaçš„è¿‡ç¨‹ä¸­å‰©ä½™pizzaæ˜¯ç”±å¤§åˆ°å°çš„ï¼Œæ‰€ä»¥é€’å½’çš„æ€ç»´é¡ºåºç¬¦åˆåˆ‡pizzaçš„é¡ºåºã€‚
ä¹Ÿå°±æ˜¯é€’å½’ç¬¦åˆå…¶æ­£å‘æ€ç»´ï¼Œè€ŒåŠ¨æ€è§„åˆ’å¿…é¡»æ˜¯ä»å°è§„æ¨¡æ•°æ®æ¨å‘å¤§è§„æ¨¡ï¼Œå¯¹äºæ­¤é¢˜è€Œè¨€æ˜¯é€†å‘æ€ç»´ã€‚
æ‰€ä»¥ç¬”è€…è®¤ä¸ºæ­¤é¢˜å†™é€’å½’è¦ç›¸å¯¹å®¹æ˜“ï¼ˆå¯èƒ½å¯¹äºé€†å‘æ€ç»´å’ŒåŠ¨æ€è§„åˆ’æå…¶ç†Ÿç»ƒçš„å¤§ç¥è€Œè¨€æ²¡æœ‰å·®åˆ«ï¼‰ï¼Œä¹Ÿæ¯”è¾ƒä¸å®¹æ˜“çŠ¯è¾¹ç•Œé”™è¯¯ã€‚
å³ä¾¿æ˜¯å†™åŠ¨æ€è§„åˆ’ï¼Œé‚£ä¹Ÿå¯ä»¥ä»é€’å½’æ€ç»´ä¸­é€†å‘æ¨å¯¼ï¼ˆæ­¤é¢˜è€Œè¨€ï¼‰ã€‚
å½“ç„¶æœ‰äº›é¢˜ç›®å…¶æ­£å‘æ€ç»´å°±æ˜¯è§„æ¨¡æœ‰å°åˆ°å¤§çš„ï¼Œåè€ŒåŠ¨æ€è§„åˆ’æ›´å®¹æ˜“ã€‚
å°±å®Œæˆæ­¤é¢˜è€Œè¨€ï¼Œå­¦ä¼šä¸Šé¢çš„è®°å¿†åŒ–é€’å½’ï¼ˆæˆ–è€…å°†å…¶æ”¹é€ ä¸ºåŠ¨æ€è§„åˆ’ï¼‰å°±è¶³å¤Ÿäº†ï¼Œç¬”è€…æœ‰ç©ºä¼šåœ¨å¦ä¸€ç¯‡å†™ä¸€ä¸ªåŠ¨æ€è§„åˆ’çš„ç‰ˆæœ¬ã€‚

# å…­ã€è¿½æ±‚æ›´å¿«æ›´ç²¾ç®€ï¼
å‰é¢çš„é€’å½’å‡½æ•°ä¸­é€’æ¨è‡³ä¸‹ä¸€çº§ä¸­å«æœ‰å¾ªç¯ï¼Œæœ€åæƒ…å†µä¸‹ï¼ˆéå†ä¸­æ²¡æœ‰æ— ğŸçš„è¡Œåˆ—ï¼Œæ— æ³•è·³è¿‡ï¼‰æ¯ä¸€æ¬¡é€’å½’éƒ½è¦æ±‚`row+1,row+2,...,rows-1å’Œcol+1,col+2,...,cols-1`æ¬¡å­å‡½æ•°ï¼Œé€’å½’æ ‘çš„åˆ†æ”¯æ•°éšç€rowså’Œcolsï¼Œé‚£ä¹ˆæœ€åçš„æ—¶é—´å¤æ‚åº¦å°†ä¼šæ˜¯`O((rows+cols)*rows*cols*remain)`ã€‚
é‚£èƒ½ä¸èƒ½å°†é€’å½’å‡½æ•°çš„é€’å½’æ ‘ä¼˜åŒ–è‡³å¸¸æ•°ä¸ªåˆ†æ”¯å‘¢ï¼Ÿä¸ä¼šå› ä¸ºrowså’Œcolsçš„å¢å¤§è€Œå¢åŠ ã€‚ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚

**ä½†å†å±•ç¤ºæ­¤è¶…çº§ä¼˜åŒ–è§£ä¹‹å‰è¦å…ˆè¯æ˜ä¸€ä¸ªå¼•ç†â€”â€”â€œåˆ‡èµ°å·¦ä¸Šæ— ğŸçš„è¡Œåˆ—ä¸å½±å“ç»“æœâ€**
è¡¨è¾¾å¼ï¼š**ways(row,col,remain)==dfs(FAR,FAC,remain)**,å…¶ä¸­(FAR,FAC)æ˜¯æŒ‡`pizza[row:,col:]`å«æœ‰ğŸçš„é¦–è¡Œ,åˆ—ï¼ˆæŒ‰ä»ä¸Šåˆ°ä¸‹ï¼Œä»åšåˆ°å³ï¼‰
å›¾ä¾‹å¦‚ä¸‹ï¼š
æ±‚æ­¤å­`pizza[3:,2:]`çš„ways
![2.png](https://pic.leetcode-cn.com/71cbc9c4f5aa4f5a9cad862eb3b630797d60d64015228451f6f17c8204eeaac3-2.png)
å¯ä»¥ç›´æ¥æŒ‰pizza[3:,2:]æ¥åˆ‡ï¼Œç¬¬ä¸€åˆ€å…±ä¸¤ä¸ªé€’å½’åˆ†æ”¯ï¼ˆå·²ç»æ˜¯æœ€åä¸€åˆ€ï¼Œæ‰€ä»¥åˆ‡å®Œåçš„æ¯ä¸ªåˆ†æ”¯å°±æ˜¯ä¸€ç§ï¼‰
![temp_00.png](https://pic.leetcode-cn.com/ddcc7a094822ba17630290bd2f68be5b41025375f3de16755aea4cd38ecc8d38-temp_00.png)
é‚£å¦‚æœå…ˆæˆªå»é å·¦ä¸Šçš„ä¸å«æœ‰ğŸçš„è¡Œåˆ—ï¼Œåˆ‡å‡ºæ¥çš„ç»“æœä¼šä¸€æ ·å—ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![temp2_00.png](https://pic.leetcode-cn.com/df8792b4dfdf3a6d07dc6eb7521cfae487d8c1ff63cdc81f8537f146a1305bcd-temp2_00.png)
å°±æ­¤ä¾‹å­è€Œè¨€ç»“æœæ˜¯ä¸€è‡´çš„ã€‚
è¿™æ˜¯å¶ç„¶è¿˜æ˜¯å¿…ç„¶å‘¢ï¼Ÿå…ˆæ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆå¯ä»¥æˆªå»é å·¦ä¸Šçš„ä¸å«æœ‰ğŸçš„è¡Œåˆ—ã€‚å› ä¸ºé¢˜ç›®è¦æ±‚çš„åˆ‡ä¸‹çš„é å·¦ä¸Šçš„pizzaå¿…é¡»å«æœ‰ğŸï¼Œè€Œå…ˆå°†é å·¦ä¸Šçš„ä¸å«æœ‰ğŸçš„è¡Œåˆ—å»æ‰ï¼Œå¹¶ä¸ä¼šå½±å“å‰©ä¸‹çš„pizzağŸçš„åˆ†å¸ƒï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªåˆ†æ”¯çš„wayséƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚è€Œä¸”æ¯æ¬¡é€’å½’ä¸èƒ½åˆ‡(FAR,FAC)ä¹‹å·¦ä¸Šçš„è¡Œå’Œåˆ—ï¼Œæ‰€ä»¥åˆ†æ”¯æ•°ä¹Ÿä¸ä¼šæœ‰å·®åˆ«ï¼Œæ‰€ä»¥æœ€åç»“æœä¸ä¼šæ”¹å˜ã€‚è¿™ä¸ªå¯ä»¥ç”¨æ•°å­¦å½’çº³æ³•è¯æ˜ï¼ˆä»¥åæœ‰ç©ºå†è¯•ç€å†™ï¼‰ã€‚

ä½¿ç”¨äº† **ways(row,col,remain)==dfs(FAR,FAC,remain)** çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå…ˆå°†å½“å‰å­pizzaçš„FARå’ŒFACè®°å½•æˆè¡¨æ ¼ï¼Œåˆ™åœ¨é€’å½’ä¸­æ— éœ€æŸ¥ğŸæ˜¯å¦åœ¨å­pizzaçš„æŸè¡Œåˆ—ä¸­äº†ã€‚

éªŒè¯ **â€œåˆ‡èµ°å·¦ä¸Šæ— ğŸçš„è¡Œåˆ—ä¸å½±å“ç»“æœâ€çš„è¿‡æ¸¡ç‰ˆæœ¬â€**ï¼Œåªå†™python3
```python3
#æ‰§è¡Œç”¨æ—¶ :284 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
#å†…å­˜æ¶ˆè€— :15.3 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
class Solution:
    def ways(self, pizza, k: int) -> int:
        module=int(1e9+7)
        rows,cols=len(pizza),len(pizza[0])
        # DP[remain][(row,col)]=dfs(row,col,remain)
        DP=[{(rows,cols):0} for i in range(k)] #åˆå§‹å€¼ï¼šä»¥(rows,cols)ä¸ºå·¦ä¸Šè§’çš„å­pizzaæ˜¯ç©ºçš„ï¼Œå½“ç„¶ç®—0ç§ï¼
        # _FA[r][c]=(FAR,_FAC) è¡¨ç¤ºä»¥rè¡Œcåˆ—ä¸ºå·¦ä¸Šè§’çš„å­pizzaï¼Œä»ä¸Šå¾€ä¸‹ç¬¬1ä¸ªappleæ˜¯FARè¡Œï¼Œä»å·¦å¾€å³ç¬¬1ä¸ªappleæ˜¯_FACåˆ—ã€‚
        _FA=[[None]*cols for i in range(rows)]
        def FA(r,c): return (rows,cols) if r>=rows or c>=cols else _FA[r][c] #é˜²æ­¢ç›´æ¥è®¿é—® _FAè¶Šç•Œï¼Œåšå¤„ç†
        for r in range(rows)[::-1]:     #é€†åºé€’æ¨ï¼
            for c in range(cols)[::-1]:   #æœ‰appleï¼šæœ¬åæ ‡(r,c)ï¼›æ— appleï¼šå–å³å’Œä¸‹çš„è¡Œã€åˆ—å„è‡ªå–å°è€…ã€‚
                _FA[r][c] = (r,c) if 'A'==pizza[r][c] else tuple(map(min,zip(FA(r+1,c),FA(r,c+1)) ))
                if _FA[r][c]!=(rows,cols):DP[0][_FA[r][c]] = 1 # å­pizza[r:,c:]å«æœ‰appleï¼Œåˆ‡0åˆ€ç®—1ç§
#        for line in _FA: print(line)
        # dfs: ä»¥rowè¡Œcolåˆ—ä¸ºå·¦ä¸Šè§’çš„çŸ©å½¢å­pizzaï¼Œåˆ‡remainåˆ€ï¼ˆæŒ‰é¢˜ç›®è¦æ±‚æ¯ä¸€ä»½éƒ½è¦æœ‰appleï¼‰çš„åˆ‡æ³•
        def dfs(row,col,remain):
            if _FA[row][col] in DP[remain]: return DP[remain][_FA[row][col]]  # è®°å¿†åŒ–é€’å½’ï¼Œèƒ½æŸ¥è¡¨å°±æŸ¥è¡¨ï¼ˆå…¶ä¸­æ‰€æœ‰0ç§åˆ‡æ³•éƒ½å·²ç»èµ‹å€¼äº†ï¼‰
            row, col = _FA[row][col] # dfs(row,col,remain)==dfs(FAR,FAC,remain)
            #åˆ‡0åˆ€çš„ï¼ˆremain==0ï¼‰çš„æƒ…å†µå…¨éƒ½å†™å¥½åœ¨ DP[0]ä¸­äº†ï¼
            cnt = 0  # è¿˜è¦åˆ‡remainåˆ€ã€‚cntè®°å½•æœ€ç»ˆåˆ‡æ³•æ•°
            for nr in range(row + 1, rows):  # æ¨ªç€åˆ‡ï¼ˆnrc[0]æ˜¯å½“å‰å­pizzaå¾€ä¸‹ç¬¬ä¸€ä¸ªæœ‰appleçš„è¡Œå·ï¼‰
                cnt = (cnt + dfs(nr, col, remain - 1)) % module  # é€’å½’æ±‚å­é—®é¢˜çš„å’Œ
            for nc in range(col + 1, cols):  # ç«–ç€åˆ‡ï¼ˆnrc[1]æ˜¯å½“å‰å­pizzaå¾€å³ç¬¬ä¸€ä¸ªæœ‰appleçš„åˆ—å·ï¼‰
                cnt = (cnt + dfs(row, nc, remain - 1)) % module  # é€’å½’æ±‚å­é—®é¢˜çš„å’Œ
            DP[remain][(row, col)] = cnt    #ä¸éœ€è¦è®°å½• DP[remain][(row, col)] å› ä¸ºä¸€å¼€å§‹æŸ¥è¡¨å°±æ˜¯æŸ¥çš„ DP[remain][(row, col)]
            return cnt
        return dfs(0,0,k-1) #åˆ«å¿˜äº†æœ€åä¸»å‡½æ•°è°ƒç”¨dfs
```
**ä¼˜åŒ–æ€è·¯ä¸€ï¼šåˆ†ä¸ºåˆ‡ä¸ä¸åˆ‡ï¼ˆé”™è¯¯è§£æ³•ï¼‰**
ç¬”è€…ä¸€å¼€å§‹å°è¯•çš„çŒœæƒ³å…¬å¼å¦‚ä¸‹
```C
//é¦–å…ˆç”¨ä¸Š row,col=FA(row,col) å³åˆ‡å»å·¦ä¸Šä¸å«appleçš„è¡Œåˆ—ï¼Œå†å¦‚ä¸‹é€’å½’ï¼š
dfs(row,col,remain) = 
	  dfs(row+1,col,remain)		//åªåˆ‡row+1è¡Œä»¥ä¸‹çš„ï¼ˆæ­¤é€’å½’ä¸åˆ‡ï¼‰
	+ dfs(row,col+1,remain)		//åªåˆ‡col+1åˆ—å¾€å³çš„ï¼ˆæ­¤é€’å½’ä¸åˆ‡ï¼‰
	- dfs(row+1,col+1,remain)	//æ‰£é™¤ç®—äº¤å‰çš„éƒ¨åˆ†
	+ dfs(row+1,col,remain-1)	//åˆ‡äº†rowå’Œrow+1è¡Œä¹‹é—´
	+ dfs(row,col+1,remain-1)	//åˆ‡äº†colå’Œcol+1è¡Œä¹‹é—´
	- dfs(row+1,col+1,remain-1)	//æ‰£é™¤ç®—äº¤å‰çš„éƒ¨åˆ†
```
å¯åˆ‡å¯ä¸åˆ‡ï¼Œè¡Œåˆ—é‡å¤è¦æ‰£é™¤ã€‚å—¯çœ‹èµ·æ¥ä¼¼ä¹å¾ˆåˆç†ï¼Œä½†è¿™æ˜¯**é”™è¯¯**çš„ï¼
é”™è¯¯æ ·ä¾‹å¦‚ä¸‹ï¼š
```python
pizza=[	"AA"
,	"AA"]
k=2	#å¯¹åº”åˆå§‹çš„remain=1
dfs(0,0,1)=
  dfs(1,0,1)# +1
+ dfs(0,1,1)# +1
- dfs(1,1,1)# -0	â˜…pizza[1:,1:]="A" æ— æ³•å†åˆ‡ç®—0ç§â˜…
+ dfs(1,0,0)# +1
+ dfs(0,1,0)# +1
- dfs(1,1,0)# -1
```
- æœ€ç»ˆdfs(0,0,1)==3 ï¼ˆremain=1è¡¨ç¤ºåˆ‡1åˆ€ï¼Œå¯¹åº”k=2ï¼‰
- ä½†æ­£ç¡®ç­”æ¡ˆæ˜¯==2ï¼Œå³æ¨ªä¸€åˆ€æˆ–è€…ç«–ä¸€åˆ€éƒ½åˆ‡ä¸­é—´ã€‚é‚£å¤šå‡ºæ¥è¯¡å¼‚çš„ä¸€ç§åˆ‡æ³•æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ
- å…¶å®é”™è¯¯åŸå› æ˜¯å‰ä¸‰é¡¹å’Œåä¸‰é¡¹é€’æ¨ä¸­ä¼šæœ‰é‡å¤è®¡ç®—çš„å¯èƒ½ï¼Œä½ çœ‹å‰ä¸‰é¡¹æœ‰åˆ‡å‡º["AA"]å’Œ["A","A"]ï¼Œåä¸‰é¡¹ä¹Ÿæœ‰ï¼Œåªæ˜¯åä¸‰é¡¹è¿˜æŠµæ¶ˆäº†ä¸€ä¸ªã€‚

è¯•å®Œæ€è·¯ä¸€ä¹‹åï¼Œç¬”è€…æƒ³äº†å¾ˆä¹…ä¹Ÿæƒ³ä¸å‡ºï¼Œä½†è¿‡äº†ä¸€æ®µæ—¶é—´ç¬”è€…åˆ‡è¥¿ç“œå‡ºçš„æ—¶å€™çªç„¶çµå…‰ä¸€ç°ï¼åˆ‡è¥¿ç“œä¸é€‚åˆå¹³è¡Œç€åˆ‡ï¼Œè€Œæ˜¯å‚ç›´äº¤å‰åœ°åˆ‡ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°†æ¨ªåˆ‡ç«–åˆ‡åˆ†å¼€ç®—å‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢æ­£è§£ã€‚

# ä¼˜åŒ–æ€è·¯äºŒï¼šé¦–åˆ‡åˆ†æ¨ªç«–ï¼ï¼ˆæ­£ç¡®è§£æ³•ï¼‰
- å®šä¹‰:dfs(row,col,remain)=(across,vertical)
- acrossï¼šé¦–åˆ‡ä¸ºæ¨ªåˆ‡ï¼Œä½†ä¹‹åçš„remain-1ä¸‹ä¸åˆ†æ¨ªç«–ï¼Œæœ‰å¤šå°‘ç§åˆ‡æ³•ï¼›
- verticalï¼šé¦–åˆ‡ä¸ºç«–åˆ‡ï¼Œä½†ä¹‹åçš„remain-1ä¸‹ä¸åˆ†æ¨ªç«–ï¼Œæœ‰å¤šå°‘ç§åˆ‡æ³•ï¼›
- é‚£ä¹ˆacross+verticalå°±æ˜¯åŸæœ¬è¦æ±‚çš„æ€»åˆ‡æ³•ï¼›
- ç‰¹åˆ«åœ° dfs(r,c,0) = (1,0) if pizza[r:,c:]æœ‰ğŸ else (0,0)
- é‚£ä¹ˆå°±å¯ä»¥åˆ†åˆ«é€’æ¨ acrosså€¼å’Œverticalå€¼ã€‚

ç”±äºæ—¶é—´å…³ç³»å…ˆä¸Šä»£ç ï¼Œç­‰ä¼šå†è¡¥å…¨å«å›¾è§£æï¼
```python3 []
#æ‰§è¡Œç”¨æ—¶ :96 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
#å†…å­˜æ¶ˆè€— :17.6 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·
class Solution:
    def ways(self, pizza, k: int) -> int:
        module=int(1e9+7)
        rows,cols=len(pizza),len(pizza[0])
        # DP[remain][(row,col)]=dfs(row,col,remain)
        DP=[{(rows,cols):(0,0)} for i in range(k)] #åˆå§‹å€¼ï¼šç©ºå­pizzaæ•…æ€ä¹ˆåˆ‡éƒ½æ˜¯0ç§ï¼
        # _FA[r][c]=(FAR,_FAC) è¡¨ç¤ºä»¥rè¡Œcåˆ—ä¸ºå·¦ä¸Šè§’çš„å­pizzaï¼Œ
        _FA=[[None]*cols for i in range(rows)]#ä»ä¸Šå¾€ä¸‹ç¬¬1ä¸ªappleæ˜¯FARè¡Œï¼Œä»å·¦å¾€å³ç¬¬1ä¸ªappleæ˜¯_FACåˆ—ã€‚
        def FA(r,c): return (rows,cols) if r>=rows or c>=cols else _FA[r][c] #é˜²æ­¢ç›´æ¥è®¿é—® _FAè¶Šç•Œï¼Œåšå¤„ç†
        for r in range(rows)[::-1]:     #é€†åºé€’æ¨ï¼
            for c in range(cols)[::-1]:   #æœ‰appleï¼šæœ¬åæ ‡(r,c)ï¼›æ— appleï¼šå–å³å’Œä¸‹çš„è¡Œã€åˆ—å„è‡ªå–å°è€…ã€‚
                _FA[r][c] = (r,c) if 'A'==pizza[r][c] else tuple(map(min,zip(FA(r+1,c),FA(r,c+1)) ))
                if _FA[r][c]!=(rows,cols):
                    DP[0][_FA[r][c]] = (1,) # å­pizza[r:,c:]å«æœ‰appleï¼Œåˆ‡0åˆ€ç®—1ç§ï¼ˆè¦ç”¨å…ƒç»„ï¼Œå¦åˆ™sum(..)ä¼šå‡ºé”™ï¼‰
        # dfs(row,col,remain)=(across,vertical): ä»¥rowè¡Œcolåˆ—ä¸ºå·¦ä¸Šè§’çš„çŸ©å½¢å­pizzaï¼Œ
        #åˆ‡remainåˆ€ï¼ˆé¦–åˆ€æ˜¯æ¨ªåˆ‡æœ‰acrossç§ï¼Œé¦–åˆ€æ˜¯ç«–åˆ‡æœ‰verticalç§ï¼Œåˆè®¡across+verticalç§ã€‚
        def dfs(row,col,remain):    #â˜…åŠ¡å¿…åœ¨ä»£å…¥ä¹‹å‰ç”¨ è§„èŒƒä¸º (FAR,FAC)=FA(r,c)
            if (row, col) in DP[remain]: return DP[remain][row, col]  #æŸ¥è¡¨ï¼ˆå…¶ä¸­æ‰€æœ‰0ç§åˆ‡æ³•éƒ½å·²ç»èµ‹å€¼äº†ï¼‰
            nr, nc = FA(row+1,col)  #æ±‚pizza[row+1:col:]çš„(FAR,FAC)
            across = (dfs(nr,nc,remain)[0]+(nr-row)*sum(dfs(nr,nc,remain-1)))%module
            nr, nc = FA(row,col+1)  #æ±‚pizza[row:col+1:]çš„(FAR,FAC)
            vertical= (dfs(nr,nc,remain)[1]+(nc-col)*sum(dfs(nr,nc,remain-1)))%module
            DP[remain][row, col]=(across,vertical)
            return (across,vertical)
        r0,c0=FA(0,0)
        return sum(dfs(r0,c0,k-1)) #è°ƒç”¨dfså–æ¨ªåˆ‡+ç«–åˆ‡ä¹‹å’Œ
```
```c++ []
typedef long long LL;
typedef pair<int,int> PINT;
typedef vector<PINT> VPINT;
const int inf = 0x7f7f7f7f;	//ä¸èƒ½è®¾ä¸º7fffffffï¼å®¹æ˜“è¶Šç•Œï¼
const long module = 1e9 + 7;
class Solution {
	static int sum(const PINT& p) { return (p.first + p.second); }
	static PINT minP(const PINT& a, const PINT& b) { return PINT(min(a.first, b.first), min(a.second, b.second)); }
	int rows, cols, acre;	//è¡Œæ•°ï¼Œåˆ—æ•°ï¼Œé¢ç§¯
	VPINT FA;		// FA[idx(row,col)]=(FAR,FAC)
	vector<VPINT > DP;	// DP[idx(row,col)][remain]= <across, vertical>  ï¼›å½“å€¼ä¸º<-1,-1>è¡¨ç¤ºæ— æ•ˆè®°å½•
	int idx(const int&row, const int&col)const {    //(row,col)äºŒç»´è½¬ä¸€ç»´ä¸‹æ ‡irc
		if (row >= rows || col >= cols)return acre;
		return row*cols + col;
	}
	int idx(const PINT& p)const {return idx(p.first, p.second);}
	//RC=(row,col),ä»¥rowè¡Œcolåˆ—ä¸ºå·¦ä¸Šè§’çš„çŸ©å½¢å­pizzaï¼Œåˆ‡remainåˆ€ï¼ˆæŒ‰é¢˜ç›®è¦æ±‚æ¯ä¸€ä»½éƒ½è¦æœ‰appleï¼‰çš„åˆ‡æ³•ã€‚
	const PINT& dfs(const PINT& RC, int remain) {
		int irc = idx(RC);
		if (-1 != DP[irc][remain].first)return DP[irc][remain];	//â˜…è®°å¿†åŒ–é€’å½’â€”â€”è®°å½•æœ‰æ•ˆï¼Œç›´æ¥æŸ¥è¡¨â˜…
		//åˆ‡0åˆ€çš„ï¼ˆremain==0ï¼‰çš„æƒ…å†µå…¨éƒ½å†™å¥½åœ¨ DP[][0] ä¸­äº†ï¼
		PINT nRC = FA[idx(RC.first + 1, RC.second)];
		int across = ((LL)(nRC.first - RC.first)*sum(dfs(nRC, remain - 1))+ dfs(nRC, remain).first) % module;
		nRC = FA[idx(RC.first, RC.second+1)];
		int vertical = ((LL)(nRC.second - RC.second)*sum(dfs(nRC, remain - 1))+ dfs(nRC, remain).second) % module;
		return DP[irc][remain] = PINT(across, vertical);	//â˜…è®°å¿†åŒ–é€’å½’â€”â€”è®°å½•ï¼â˜…
	}
public:
	int ways(vector<string>& pizza, int k) {
		rows = pizza.size(); cols = pizza[0].length(); acre = rows*cols;
		DP.reserve(acre + 1);	DP.resize(acre, VPINT(k, PINT(-1, -1)));
		DP.push_back(VPINT(k, PINT(0, 0)));	//å¤šå‡ºçš„1ä¸ªç©ºé—´ç”¨äºè¿”å›(row,col)è¶Šç•Œæ—¶çš„ç»“æœâ€”â€”0ç§åˆ‡æ³•
		FA.resize(acre + 1);	FA[acre] = PINT(inf, inf);	//åæ ‡è¶Šç•Œè®¾ä¸ºæ— ç©·ï¼ˆåªè¦å¤§äºrows,colså³å¯ï¼‰
		for (int r = rows; r-- > 0;) {
			for (int c = cols; c-- > 0;) {
				FA[idx(r, c)] = ('A' == pizza[r][c]) ? PINT(r, c) : minP(FA[idx(r + 1, c)], FA[idx(r, c + 1)]);
				if (FA[idx(r, c)].first != inf) {DP[idx(r, c)][0] = PINT(1, 0);}	//å­pizza[r:,c:]å«æœ‰appleï¼Œåˆ‡0åˆ€ç®—1ç§
			}
		}
		return sum(dfs(FA[0], k - 1));
	}
};
```
python3 æ‰§è¡Œæ—¶é—´96msï¼C++çš„8msï¼æœ‰å›¾æœ‰çœŸç›¸
![96msï¼8msï¼.png](https://pic.leetcode-cn.com/6ca7475f0867ad0d6a5f91580dc0554169515d326142bd9fb549a8bbce89ecde-96ms%EF%BC%818ms%EF%BC%81.png)
`dfs(row,col,remain)`è‡³å¤šæœ‰`rows*cols*k`ç§ã€‚åˆå› ä¸ºdfså†…éƒ¨æ— å¾ªç¯ï¼Œå•ä¸ªé€’å½’å‡½æ•°æ‰§è¡ŒæŒ‡ä»¤æ˜¯å¸¸æ•°å¤æ‚åº¦ã€‚
æ‰€ä»¥æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š`O(rows*cols*k)`ï¼Œæ¯”å‰é¢çš„ `O(rows*cols*(rows+cols)*k)` å°‘ä¹˜ä¸€ä¸ª`(rows+cols)`ï¼›
ç©ºé—´å¤æ‚åº¦ä¾ç„¶æ˜¯ï¼š`O(rows*cols*k)`ã€‚

å¦‚æœæ”¹é€ ä¸ºåŠ¨æ€è§„åˆ’ï¼Œå¯ä»¥æŒ‰kï¼ˆremainï¼‰ä»å°åˆ°å¤§è¿­ä»£ï¼Œç©ºé—´å¤æ‚åº¦ä¼šå¯ä»¥å‹ç¼©ä¸ºO(rows*cols)ã€‚

ä»è®°å¿†åŒ–é€’å½’åˆ°åŠ¨æ€è§„åˆ’ï¼Œå°±åªéœ€è¦ç¡®å®šåŠ¨æ€è½¬ç§»æ–¹ç¨‹å’Œéå†çš„é¡ºåºé—®é¢˜ã€‚æœ‰ç©ºæˆ‘ä¼šå†™ä¸ªåŠ¨æ€è§„åˆ’ç‰ˆæœ¬ã€‚
æ¬¢è¿è¯„è®ºï¼Œå¦‚æœä¸æ˜ç™½æ¬¢è¿æé—®ï¼ˆå¦‚Pythonä¸­çš„zipã€mapä¹‹ç±»çš„æ“ä½œï¼‰ï¼Œæˆ‘æœ‰ç©ºä¼šç»§ç»­å®Œå–„ã€‚