## [398.éšæœºæ•°ç´¢å¼• ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/random-pick-index/solutions/100000/by-ac_oier-zhml)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)

## å“ˆå¸Œè¡¨ é¢„å¤„ç†ï¼ˆå®šé•¿æ•°æ®æµï¼‰

åˆ‡æ¢è‹±æ–‡è¡¥å…¨ä¸€ä¸‹æ•°æ®èŒƒå›´ï¼š
* $1 <= nums.length <= 2 * 10^4$
* $-2^{31} <= nums[i] <= 2^{31} - 1$
* `target` ç¡®ä¿å­˜åœ¨äº `nums` ä¸­
* æœ€å¤šè°ƒç”¨ $10^4$ æ¬¡çš„ `pick`

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä»¤ `nums` çš„é•¿åº¦ä¸º $n$ï¼Œåˆ©ç”¨ $n$ çš„æ•°æ®èŒƒå›´ä¸º $2 * 10^4$ï¼Œä¸”å®Œæ•´çš„æ•°ç»„ä¸ºåˆå§‹åŒ–æ—¶å·²ç»™å‡ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ + é¢„å¤„ç†ã€çš„æ–¹å¼è¿›è¡Œæ±‚è§£ã€‚

å…·ä½“çš„ï¼Œåœ¨æ„é€ å‡½æ•°ä¼ å…¥ `nums` æ—¶ï¼Œéå† `nums` å¹¶å­˜å‚¨æ¯ä¸ª $nums[i]$ å¯¹åº”çš„ä¸‹æ ‡é›†åˆï¼Œå³ä½¿ç”¨å“ˆå¸Œè¡¨ä»¥ $nums[i]$ ä¸ºé”®ï¼Œä¸‹æ ‡é›†åˆ `List` ä½œä¸ºå€¼è¿›è¡Œå­˜å‚¨ã€‚

åœ¨ `pick` æ“ä½œæ—¶ï¼Œé€šè¿‡ $O(1)$ çš„å¤æ‚åº¦å–å‡ºæ‰€æœ‰ $nums[i] = target$ çš„é›†åˆä¸‹æ ‡ï¼Œå†éšæœºä¸€ä¸ªä¸‹æ ‡è¿›è¡Œè¿”å›ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    Random random = new Random();
    Map<Integer, List<Integer>> map = new HashMap<>();
    public Solution(int[] nums) {
        int n = nums.length;
        for (int i = 0; i < n; i++) {
            List<Integer> list = map.getOrDefault(nums[i], new ArrayList<>());
            list.add(i);
            map.put(nums[i], list);
        }
    }
    public int pick(int target) {
        List<Integer> list = map.get(target);
        return list.get(random.nextInt(list.size()));
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šåˆå§‹åŒ–çš„å¤æ‚åº¦ä¸º $O(n)$ï¼›`pick` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(1)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## è“„æ°´æ± æŠ½æ ·ï¼ˆä¸å®šé•¿æ•°æ®æµï¼‰

è‹¥ `nums` å¹¶ä¸æ˜¯åœ¨åˆå§‹åŒ–æ—¶å®Œå…¨ç»™å‡ºï¼Œè€Œæ˜¯æŒç»­ä»¥ã€Œæµã€çš„å½¢å¼ç»™å‡ºï¼Œä¸”æ•°æ®æµçš„å¾ˆé•¿ï¼Œä¸ä¾¿è¿›è¡Œé¢„å¤„ç†çš„è¯ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ã€Œè“„æ°´æ± æŠ½æ ·ã€çš„æ–¹å¼æ±‚è§£ã€‚

**ä¸äº†è§£ã€Œè“„æ°´æ± æŠ½æ ·ã€çš„åŒå­¦å¯ä»¥çœ‹å‰ç½® ğŸ§€ : [å¤šè¯­è¨€å…¥é—¨ã€Œè“„æ°´æ± æŠ½æ ·ã€çŸ¥è¯†ç‚¹](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247490892&idx=1&sn=c1fe373edc88142cbabd383ef3c0669b)**

å…·ä½“çš„ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡ `pick` æ—¶å¯¹æµè¿›è¡Œéå†ï¼Œç”±äºæ•°æ®æµå¾ˆå¤§ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨è¯¸å¦‚æ•°ç»„çš„å®¹å™¨å­˜å‚¨æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ä¸‹æ ‡ï¼Œåªèƒ½å¯¹äºæ¯ä¸ª $nums[i] = target$ æ‰§è¡Œã€Œæ˜¯å¦è¦å°† $i$ ä½œä¸ºæœ€æ–°ç­”æ¡ˆå€™é€‰ã€çš„æ“ä½œã€‚

å‡è®¾å…±æœ‰ $m$ ä¸ªä¸‹æ ‡æ»¡è¶³ $nums[i] = target$ï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°ä»¥ $\frac{1}{m}$ æ¦‚ç‡è¿”å›ä»»ä¸€åæ ‡ã€‚

æˆ‘ä»¬è§„å®šå½“é‡åˆ°ç¬¬ $k$ ä¸ªæ»¡è¶³ $nums[i] = target$ çš„ä¸‹æ ‡æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡ $[0, k)$ çš„éšæœºæ“ä½œï¼Œå½“éšæœºç»“æœä¸º $0$ æ—¶ï¼ˆå‘ç”Ÿæ¦‚ç‡ä¸º $\frac{1}{k}$ï¼‰ï¼Œæˆ‘ä»¬å°†è¯¥åæ ‡ä½œä¸ºæœ€æ–°çš„ç­”æ¡ˆå€™é€‰ã€‚

å½“å¯¹æ¯ä¸€ä¸ª $nums[i] = target$ çš„ä¸‹æ ‡éƒ½è¿›è¡Œä¸Šè¿°æ“ä½œåï¼Œå®¹æ˜“è¯æ˜æ¯ä¸€ä½ä¸‹æ ‡è¿”å›çš„æ¦‚ç‡å‡ä¸º $\frac{1}{m}$ã€‚

å‡è®¾æœ€åè¿”å›çš„æ˜¯ç¬¬ $k$ ä¸ªæ»¡è¶³æ¡ä»¶çš„ä¸‹æ ‡ï¼Œå‘ç”Ÿæ¦‚ç‡ä¸º = ç¬¬ $k$ ä¸ªä¸‹æ ‡è¢«å€™é€‰çš„æ¦‚ç‡ $\times$ åé¢ $k + 1$ åˆ° $m$ ä¸ªä¸‹æ ‡ä¸è¢«å€™é€‰çš„æ¦‚ç‡ = $\frac{1}{k} \times (1 - \frac{1}{k + 1}) \times ... \times (1 - \frac{1}{m})$ = $\frac{1}{m}$ ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    Random random = new Random();
    int[] nums;
    public Solution(int[] _nums) {
        nums = _nums;
    }
    public int pick(int target) {
        int n = nums.length, ans = 0;
        for (int i = 0, cnt = 0; i < n; i++) {
            if (nums[i] == target) {
                cnt++;
                if (random.nextInt(cnt) == 0) ans = i;
            }
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šåˆå§‹åŒ–çš„å¤æ‚åº¦ä¸º $O(1)$ï¼›`pick` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~