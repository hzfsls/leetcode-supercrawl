## [446.ç­‰å·®æ•°åˆ—åˆ’åˆ† II - å­åºåˆ— ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/arithmetic-slices-ii-subsequence/solutions/100000/gong-shui-san-xie-xiang-jie-ru-he-fen-xi-ykvk)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)
## åŸºæœ¬åˆ†æ

ä»é¢˜ç›®æè¿°æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€ä¸ªã€Œåºåˆ— DPã€é—®é¢˜ï¼Œé€šå¸¸ã€Œåºåˆ— DPã€éœ€è¦ $O(n^2)$ çš„æ—¶é—´å¤æ‚åº¦ï¼Œè€ŒæŸäº›å…·æœ‰ç‰¹æ®Šæ€§è´¨çš„ã€Œåºåˆ— DPã€é—®é¢˜ï¼Œä¾‹å¦‚ LIS é—®é¢˜ï¼Œèƒ½å¤Ÿé…åˆè´ªå¿ƒæ€è·¯ + äºŒåˆ†åšåˆ° $O(n\log{n})$ å¤æ‚åº¦ã€‚å†çœ‹ä¸€çœ¼æ•°æ®èŒƒå›´ä¸º $10^3$ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€é“å¤æ‚åº¦ä¸º $O(n^2)$ çš„ã€Œåºåˆ— DPã€é—®é¢˜ã€‚

---

## åŠ¨æ€è§„åˆ’ + å®¹æ–¥åŸç†

**æ—¢ç„¶åˆ†æå‡ºæ˜¯åºåˆ— DP é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçŒœæƒ³ä¸€ä¸ªåŸºæœ¬çš„çŠ¶æ€å®šä¹‰ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿã€Œä¸é‡ä¸æ¼ã€çš„å°†çŠ¶æ€é€šè¿‡è½¬ç§»è®¡ç®—å‡ºæ¥ã€‚å¦‚æœä¸è¡Œï¼Œæˆ‘ä»¬å†è€ƒè™‘å¼•å…¥æ›´å¤šçš„ç»´åº¦æ¥è¿›è¡Œæ±‚è§£ã€‚**

å…ˆä»æœ€æœ´ç´ çš„çŒœæƒ³å‡ºå‘ï¼Œå®šä¹‰ $f[i]$ ä¸ºè€ƒè™‘ä¸‹æ ‡ä¸è¶…è¿‡ $i$ çš„æ‰€æœ‰æ•°ï¼Œå¹¶ä¸”ä»¥ $nums[i]$ ä¸ºç»“å°¾çš„ç­‰å·®åºåˆ—çš„ä¸ªæ•°ã€‚

ä¸å¤±ä¸€èˆ¬æ€§çš„ $f[i]$ è¯¥å¦‚ä½•è½¬ç§»ï¼Œä¸éš¾å‘ç°æˆ‘ä»¬éœ€è¦æšä¸¾ $[0, i - 1]$ èŒƒå›´å†…çš„æ‰€æœ‰æ•°ï¼Œå‡è®¾å½“å‰æˆ‘ä»¬æšä¸¾åˆ° $[0, i - 1]$ ä¸­çš„ä½ç½® $j$ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç®—å‡ºä¸¤ä¸ªä½ç½®çš„å·®å€¼ $d = nums[i] - nums[j]$ï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“ $f[j]$ å­˜å‚¨çš„å­åºåˆ—æ•°é‡æ˜¯å·®å€¼ä¸ºå¤šå°‘çš„ã€‚

åŒæ—¶ï¼Œæ ¹æ®é¢˜ç›®æˆ‘ä»¬è¦æ±‚çš„æ˜¯æ‰€æœ‰çš„ç­‰å·®åºåˆ—çš„ä¸ªæ•°ï¼Œè€Œä¸æ˜¯æ±‚å·®å€¼ä¸ºæŸä¸ªå…·ä½“å€¼ $x$ çš„ç­‰å·®åºåˆ—çš„ä¸ªæ•°ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•ä¸‹æ‰€æœ‰å·®å€¼çš„å­åºåˆ—ä¸ªæ•°ï¼Œå¹¶æ±‚å’Œæ‰æ˜¯ç­”æ¡ˆã€‚

**å› æ­¤æˆ‘ä»¬çš„ $f[i]$ ä¸èƒ½æ˜¯ä¸€ä¸ªæ•°ï¼Œè€Œåº”è¯¥æ˜¯ä¸€ä¸ªã€Œé›†åˆã€ï¼Œè¯¥é›†åˆè®°å½•ä¸‹äº†æ‰€æœ‰ä»¥ $nums[i]$ ä¸ºç»“å°¾ï¼Œå·®å€¼ä¸ºæ‰€æœ‰æƒ…å†µçš„å­åºåˆ—çš„ä¸ªæ•°ã€‚**

æˆ‘ä»¬å¯ä»¥è®¾ç½® $f[i] = g$ï¼Œå…¶ä¸­ $g$ ä¸ºä¸€ä¸ªã€Œé›†åˆã€æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æœŸæœ›åœ¨ $O(1)$ çš„å¤æ‚åº¦å†…æŸ¥çš„æŸä¸ªå·®å€¼ $d$ çš„å­åºåˆ—ä¸ªæ•°æ˜¯å¤šå°‘ã€‚

**è¿™æ · $f[i][j]$ å°±ä»£è¡¨äº†ä»¥ $nums[i]$ ä¸ºç»“å°¾ï¼Œå¹¶ä¸”å·®å€¼ä¸º $j$ çš„å­åºåˆ—ä¸ªæ•°æ˜¯å¤šå°‘ã€‚**

å½“æˆ‘ä»¬å¤šå¼•å…¥ä¸€ç»´è¿›è¡Œè¿™æ ·çš„çŠ¶æ€å®šä¹‰åï¼Œæˆ‘ä»¬å†åˆ†æä¸€ä¸‹èƒ½å¦ã€Œä¸é‡ä¸æ¼ã€çš„é€šè¿‡è½¬ç§»è®¡ç®—å‡ºæ‰€æœ‰çš„åŠ¨è§„å€¼ã€‚

ä¸å¤±ä¸€èˆ¬æ€§çš„è€ƒè™‘ $f[i][j]$ è¯¥å¦‚ä½•è½¬ç§»ï¼Œæ˜¾ç„¶åºåˆ— DP é—®é¢˜æˆ‘ä»¬è¿˜æ˜¯è¦æšä¸¾åŒºé—´ $[0, i - 1]$ çš„æ‰€æœ‰æ•°ã€‚

**å’Œå…¶ä»–çš„ã€Œåºåˆ— DPã€é—®é¢˜ä¸€æ ·ï¼Œæšä¸¾å½“å‰ä½ç½®å‰é¢çš„æ‰€æœ‰ä½ç½®çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†æ‰¾åˆ°å½“å‰ä½ç½®çš„æ•°ï¼Œèƒ½å¤Ÿæ¥åœ¨å“ªä¸€ä¸ªä½ç½®çš„åé¢ï¼Œå½¢æˆåºåˆ—ã€‚**

**å¯¹äºæœ¬é¢˜ï¼Œæšä¸¾åŒºé—´ $[0, i - 1]$ çš„æ‰€æœ‰æ•°çš„å«ä¹‰æ˜¯ï¼šæšä¸¾ä»¥ $nums[i]$ ä¸ºå­åºåˆ—ç»“å°¾æ—¶ï¼Œå®ƒçš„å‰ä¸€ä¸ªå€¼æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯ $nums[i]$ æ¥åœ¨å“ªä¸ªæ•°çš„åé¢ï¼Œå½¢æˆç­‰å·®å­åºåˆ—ã€‚**

è¿™æ ·å¿…ç„¶æ˜¯å¯ä»¥ã€Œä¸é‡ä¸æ¼ã€çš„å¤„ç†åˆ°æ‰€æœ‰ä»¥ $nums[i]$ ä¸ºå­åºåˆ—ç»“å°¾çš„æƒ…å†µçš„ã€‚

è‡³äºå…·ä½“çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæˆ‘ä»¬ä»¤å·®å€¼ $d = nums[i] - nums[j]$ï¼Œæ˜¾ç„¶æœ‰ï¼ˆå…ˆä¸è€ƒè™‘é•¿åº¦è‡³å°‘ä¸º $3$ çš„é™åˆ¶ï¼‰ï¼š

$$
f[i][d] = \sum_{j = 0}^{i - 1} (f[j][d] + 1)
$$

å«ä¹‰ä¸ºï¼š**åœ¨åŸæœ¬ä»¥ $nums[j]$ ä¸ºç»“å°¾çš„ï¼Œä¸”å·®å€¼ä¸º $d$ çš„å­åºåˆ—çš„åŸºç¡€ä¸Šæ¥ä¸Š $nums[i]$ï¼Œå†åŠ ä¸Šæ–°çš„å­åºåˆ— $(nums[j], nums[i])$ï¼Œå…± $f[j][d] + 1$ ä¸ªå­åºåˆ—ã€‚**

**æœ€åå¯¹æ‰€æœ‰çš„å“ˆå¸Œè¡¨çš„ã€Œå€¼ã€å¯¹è¿›è¡Œç´¯åŠ è®¡æ•°ï¼Œå°±æ˜¯ä»¥ä»»æ„ä½ç½®ä¸ºç»“å°¾ï¼Œé•¿åº¦å¤§äº $1$ çš„ç­‰å·®å­åºåˆ—çš„æ•°é‡ $ans$ã€‚**

è¿™æ—¶å€™å†çœ‹ä¸€çœ¼æ•°æ®èŒƒå›´ $-2^{31} <= nums[i] <= 2^{31}-1$ï¼Œå¦‚æœä»æ•°æ®èŒƒå›´å‡ºå‘ï¼Œä½¿ç”¨ã€Œæ•°ç»„ã€å……å½“é›†åˆçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°ç»„å¼€å¾—å¾ˆå¤§ï¼Œå¿…ç„¶ä¼šçˆ†å†…å­˜ã€‚

ä½†åŒæ—¶æœ‰ $1  <= nums.length <= 1000$ï¼Œä¹Ÿå°±æ˜¯è¯´ã€Œæœ€å°å·®å€¼ã€å’Œã€Œæœ€å¤§å·®å€¼ã€ä¹‹é—´å¯èƒ½ç›¸å·®å¾ˆå¤§ï¼Œä½†æ˜¯å·®å€¼çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œä¸ä¼šè¶…è¿‡ $n^2$ ä¸ªã€‚

ä¸ºäº†ä¸å¼•å…¥å¤æ‚çš„ã€Œç¦»æ•£åŒ–ã€æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ã€æ¥å……å½“ã€Œé›†åˆã€ã€‚

æ¯ä¸€ä¸ª $f[i]$ ä¸ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨çš„ä»¥ `{d:cnt}` çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œ`d` ä¸ºå­åºåˆ—å·®å€¼ï¼Œ`cnt` ä¸ºå­åºåˆ—æ•°é‡ã€‚

è™½ç„¶ç›¸æ¯”ä½¿ç”¨æ•°ç»„ï¼Œå“ˆå¸Œè¡¨å¸¸æ•°æ›´å¤§ï¼Œä½†æ˜¯ç»è¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬çš„å¤æ‚åº¦ä¸º $O(n^2)$ï¼Œè®¡ç®—é‡ä¸º $10^6$ï¼Œè·ç¦»è®¡ç®—é‡ä¸Šç•Œ $10^7$ è¿˜ä¿æœ‰ä¸€æ®µè·ç¦»ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨å“ˆå¸Œè¡¨ååˆ†å®‰å…¨ã€‚

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è§£å†³äº†ä¸è€ƒè™‘ã€Œé•¿åº¦ä¸ºè‡³å°‘ä¸º $3$ã€é™åˆ¶çš„åŸé—®é¢˜ã€‚

é‚£ä¹ˆéœ€è¦è€ƒè™‘ã€Œé•¿åº¦ä¸ºè‡³å°‘ä¸º $3$ã€é™åˆ¶æ€ä¹ˆåŠï¼Ÿ

**æ˜¾ç„¶ï¼Œæˆ‘ä»¬è®¡ç®—çš„ $ans$ ä¸ºç»Ÿè®¡æ‰€æœ‰çš„ã€Œé•¿åº¦å¤§äº $1$ã€çš„ç­‰å·®å­åºåˆ—æ•°é‡ï¼Œç”±äºé•¿åº¦å¿…ç„¶ä¸ºæ­£æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡çš„æ˜¯ã€Œé•¿åº¦å¤§äºç­‰äº $2$ã€çš„ç­‰å·®å­åºåˆ—çš„æ•°é‡ã€‚**

**å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ±‚å‡ºé•¿åº¦ä¸º $2$ çš„å­åºåˆ—çš„ä¸ªæ•°çš„è¯ï¼Œä» $ans$ ä¸­å‡å»ï¼Œå¾—åˆ°çš„å°±æ˜¯ã€Œé•¿åº¦ä¸ºè‡³å°‘ä¸º $3$ã€å­åºåˆ—çš„æ•°é‡ã€‚**

é•¿åº¦ä¸º $2$ çš„ç­‰å·®å­åºåˆ—ï¼Œç”±äºæ²¡æœ‰ç¬¬ä¸‰ä¸ªæ•°çš„å·®å€¼é™åˆ¶ï¼Œå› æ­¤ä»»æ„çš„æ•°å¯¹ $(j, i)$ éƒ½æ˜¯ä¸€ä¸ªåˆæ³•çš„é•¿åº¦ä¸º $2$ çš„ç­‰å·®å­åºåˆ—ã€‚

è€Œæ±‚é•¿åº¦ä¸º $n$ çš„æ•°ç»„çš„æ‰€æœ‰æ•°å¯¹ï¼Œå…¶å®å°±æ˜¯æ±‚ **é¦–é¡¹ä¸º $0$ï¼Œæœ«é¡¹ä¸º $n - 1$ï¼Œå…¬å·®ä¸º $1$ï¼Œé•¿åº¦ä¸º $n$ çš„ç­‰å·®æ•°åˆ—ä¹‹å’Œ**ï¼Œç›´æ¥ä½¿ç”¨ã€Œç­‰å·®æ•°åˆ—æ±‚å’Œã€å…¬å¼æ±‚è§£å³å¯ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    public int numberOfArithmeticSlices(int[] nums) {
        int n = nums.length;
        // æ¯ä¸ª f[i] å‡ä¸ºå“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨é”®å€¼å¯¹ä¸º {d : cnt}
        // d : å­åºåˆ—å·®å€¼
        // cnt : ä»¥ nums[i] ä¸ºç»“å°¾ï¼Œä¸”å·®å€¼ä¸º d çš„å­åºåˆ—æ•°é‡
        List<Map<Long, Integer>> f = new ArrayList<>();
        for (int i = 0; i < n; i++) {
            Map<Long, Integer> cur = new HashMap<>();
            for (int j = 0; j < i; j++) {
                Long d = nums[i] * 1L - nums[j];
                Map<Long, Integer> prev = f.get(j);
                int cnt = cur.getOrDefault(d, 0);
                cnt += prev.getOrDefault(d, 0);
                cnt ++;
                cur.put(d, cnt);
            }
            f.add(cur);
        }
        int ans = 0;
        for (int i = 0; i < n; i++) {
            Map<Long, Integer> cur = f.get(i);
            for (Long key : cur.keySet()) ans += cur.get(key);
        }
        int a1 = 0, an = n - 1;
        int cnt = (a1 + an) * n / 2;
        return ans - cnt;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šDP è¿‡ç¨‹çš„å¤æ‚åº¦ä¸º $O(n^2)$ï¼Œéå†æ‰€æœ‰çš„å“ˆå¸Œè¡¨çš„å¤æ‚åº¦ä¸Šç•Œä¸ä¼šè¶…è¿‡ $O(n^2)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼šæ‰€æœ‰å“ˆå¸Œè¡¨å­˜å‚¨çš„å¤æ‚åº¦ä¸Šç•Œä¸ä¼šè¶…è¿‡ $O(n^2)$

---

## å…¶ä»–ã€Œåºåˆ— DPã€é—®é¢˜

| é¢˜ç›®                                                         | é¢˜è§£                                                         | éš¾åº¦ | æ¨èæŒ‡æ•° |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- | -------- |
| [354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](https://leetcode-cn.com/problems/russian-doll-envelopes/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/russian-doll-envelopes/solution/zui-chang-shang-sheng-zi-xu-lie-bian-xin-6s8d/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [368. æœ€å¤§æ•´é™¤å­é›†](https://leetcode-cn.com/problems/largest-divisible-subset/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/largest-divisible-subset/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-0a3jc/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [446. ç­‰å·®æ•°åˆ—åˆ’åˆ† II - å­åºåˆ—](https://leetcode-cn.com/problems/arithmetic-slices-ii-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/arithmetic-slices-ii-subsequence/solution/gong-shui-san-xie-xiang-jie-ru-he-fen-xi-ykvk/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [740. åˆ é™¤å¹¶è·å¾—ç‚¹æ•°](https://leetcode-cn.com/problems/delete-and-earn/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/delete-and-earn/solution/gong-shui-san-xie-zhuan-huan-wei-xu-lie-6c9t0/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [978. æœ€é•¿æ¹æµå­æ•°ç»„](https://leetcode-cn.com/problems/longest-turbulent-subarray/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/longest-turbulent-subarray/solution/xiang-jie-dong-tai-gui-hua-ru-he-cai-dp-3spgj/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©      |
| [1035. ä¸ç›¸äº¤çš„çº¿](https://leetcode-cn.com/problems/uncrossed-lines/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/uncrossed-lines/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-bkaas/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1143. æœ€é•¿å…¬å…±å­åºåˆ—](https://leetcode-cn.com/problems/longest-common-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/longest-common-subsequence/solution/gong-shui-san-xie-zui-chang-gong-gong-zi-xq0h/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1713. å¾—åˆ°å­åºåˆ—çš„æœ€å°‘æ“ä½œæ¬¡æ•°](https://leetcode-cn.com/problems/minimum-operations-to-make-a-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/minimum-operations-to-make-a-subsequence/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-oj7yu/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |

**æ³¨ï¼šä»¥ä¸Šç›®å½•æ•´ç†æ¥è‡ª [wiki](https://github.com/SharingSource/LogicStack-LeetCode/wiki/åºåˆ—-DP)ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½å¼•ç”¨è¯·ä¿ç•™å‡ºå¤„ã€‚**


---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 