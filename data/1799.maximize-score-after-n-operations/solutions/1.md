## [1799.N æ¬¡æ“ä½œåçš„æœ€å¤§åˆ†æ•°å’Œ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/maximize-score-after-n-operations/solutions/100000/by-lcbin-8uxm)

ä½œè€…ï¼š[lcbin](https://leetcode.cn/u/lcbin)
**æ–¹æ³•ä¸€ï¼šçŠ¶æ€å‹ç¼© + åŠ¨æ€è§„åˆ’**

æˆ‘ä»¬å¯ä»¥å…ˆé¢„å¤„ç†å¾—åˆ°æ•°ç»„ `nums` ä¸­ä»»æ„ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ï¼Œå­˜å‚¨åœ¨äºŒç»´æ•°ç»„ $g$ ä¸­ï¼Œå…¶ä¸­ $g[i][j]$ è¡¨ç¤º $nums[i]$ å’Œ $nums[j]$ çš„æœ€å¤§å…¬çº¦æ•°ã€‚

ç„¶åå®šä¹‰ $f[k]$ è¡¨ç¤ºå½“å‰æ“ä½œåçš„çŠ¶æ€ä¸º $k$ æ—¶ï¼Œå¯ä»¥è·å¾—çš„æœ€å¤§åˆ†æ•°å’Œã€‚å‡è®¾ $m$ ä¸ºæ•°ç»„ `nums` ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œé‚£ä¹ˆçŠ¶æ€ä¸€å…±æœ‰ $2^m$ ç§ï¼Œå³ $k$ çš„å–å€¼èŒƒå›´ä¸º $[0, 2^m - 1]$ã€‚

ä»å°åˆ°å¤§æšä¸¾æ‰€æœ‰çŠ¶æ€ï¼Œå¯¹äºæ¯ä¸ªçŠ¶æ€ $k$ï¼Œå…ˆåˆ¤æ–­æ­¤çŠ¶æ€çš„äºŒè¿›åˆ¶ä½ä¸­ $1$ çš„ä¸ªæ•° $cnt$ æ˜¯å¦ä¸ºå¶æ•°ï¼Œæ˜¯åˆ™è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

æšä¸¾ $k$ ä¸­äºŒè¿›åˆ¶ä½ä¸º $1$ çš„ä½ç½®ï¼Œå‡è®¾ä¸º $i$ å’Œ $j$ï¼Œåˆ™ $i$ å’Œ $j$ ä¸¤ä¸ªä½ç½®çš„å…ƒç´ å¯ä»¥è¿›è¡Œä¸€æ¬¡æ“ä½œï¼Œæ­¤æ—¶å¯ä»¥è·å¾—çš„åˆ†æ•°ä¸º $\frac{cnt}{2} \times g[i][j]$ï¼Œæ›´æ–° $f[k]$ çš„æœ€å¤§å€¼ã€‚

æœ€ç»ˆç­”æ¡ˆå³ä¸º $f[2^m - 1]$ã€‚


```python [sol1-Python3]
class Solution:
    def maxScore(self, nums: List[int]) -> int:
        m = len(nums)
        g = [[0] * m for _ in range(m)]
        for i in range(m):
            for j in range(i + 1, m):
                g[i][j] = gcd(nums[i], nums[j])
        f = [0] * (1 << m)
        for k in range(1 << m):
            if (cnt := k.bit_count()) % 2 == 0:
                for i in range(m):
                    if k >> i & 1:
                        for j in range(i + 1, m):
                            if k >> j & 1:
                                f[k] = max(f[k], f[k ^ (1 << i) ^ (1 << j)] + cnt // 2 * g[i][j])
        return f[-1]
```



```java [sol1-Java]
class Solution {
    public int maxScore(int[] nums) {
        int m = nums.length;
        int[][] g = new int[m][m];
        for (int i = 0; i < m; ++i) {
            for (int j = i + 1; j < m; ++j) {
                g[i][j] = gcd(nums[i], nums[j]);
            }
        }
        int[] f = new int[1 << m];
        for (int k = 0; k < 1 << m; ++k) {
            int cnt = Integer.bitCount(k);
            if (cnt % 2 == 0) {
                for (int i = 0; i < m; ++i) {
                    if (((k >> i) & 1) == 1) {
                        for (int j = i + 1; j < m; ++j) {
                            if (((k >> j) & 1) == 1) {
                                f[k] = Math.max(f[k], f[k ^ (1 << i) ^ (1 << j)] + cnt / 2 * g[i][j]);
                            }
                        }
                    }
                }
            }
        }
        return f[(1 << m) - 1];
    }

    private int gcd(int a, int b) {
        return b == 0 ? a : gcd(b, a % b);
    }
}
```


```cpp [sol1-C++]
class Solution {
public:
    int maxScore(vector<int>& nums) {
        int m = nums.size();
        int g[m][m];
        for (int i = 0; i < m; ++i) {
            for (int j = i + 1; j < m; ++j) {
                g[i][j] = gcd(nums[i], nums[j]);
            }
        }
        int f[1 << m];
        memset(f, 0, sizeof f);
        for (int k = 0; k < 1 << m; ++k) {
            int cnt = __builtin_popcount(k);
            if (cnt % 2 == 0) {
                for (int i = 0; i < m; ++i) {
                    if (k >> i & 1) {
                        for (int j = i + 1; j < m; ++j) {
                            if (k >> j & 1) {
                                f[k] = max(f[k], f[k ^ (1 << i) ^ (1 << j)] + cnt / 2 * g[i][j]);
                            }
                        }
                    }
                }
            }
        }
        return f[(1 << m) - 1];
    }
};
```


```go [sol1-Go]
func maxScore(nums []int) int {
	m := len(nums)
	g := [14][14]int{}
	for i := 0; i < m; i++ {
		for j := i + 1; j < m; j++ {
			g[i][j] = gcd(nums[i], nums[j])
		}
	}
	f := make([]int, 1<<m)
	for k := 0; k < 1<<m; k++ {
		cnt := bits.OnesCount(uint(k))
		if cnt%2 == 0 {
			for i := 0; i < m; i++ {
				if k>>i&1 == 1 {
					for j := i + 1; j < m; j++ {
						if k>>j&1 == 1 {
							f[k] = max(f[k], f[k^(1<<i)^(1<<j)]+cnt/2*g[i][j])
						}
					}
				}
			}
		}
	}
	return f[1<<m-1]
}

func max(a, b int) int {
	if a > b {
		return a
	}
	return b
}

func gcd(a, b int) int {
	if b == 0 {
		return a
	}
	return gcd(b, a%b)
}
```


æ—¶é—´å¤æ‚åº¦ $O(2^m \times m^2)$ï¼Œç©ºé—´å¤æ‚åº¦ $O(2^m)$ã€‚å…¶ä¸­ $m$ ä¸ºæ•°ç»„ `nums` ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚



---

æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºåŒºäº¤æµï¼Œæ¬¢è¿è¯„è®ºåŒºæä¾›å…¶å®ƒè§£é¢˜æ€è·¯ï¼ˆä»£ç ï¼‰ï¼Œä¹Ÿå¯ä»¥ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ä½œè€…å“ˆğŸ˜„~