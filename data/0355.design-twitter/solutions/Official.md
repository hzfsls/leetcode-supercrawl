### ğŸ“º è§†é¢‘é¢˜è§£  

![355 è®¾è®¡æ¨ç‰¹-ä»²è€€æ™–.mp4](262540fb-dfbf-4220-a8b9-504f0151d287)

### ğŸ“– æ–‡å­—é¢˜è§£

#### æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ + é“¾è¡¨

**æ€è·¯å’Œç®—æ³•**

æ ¹æ®é¢˜æ„æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºæ¯ä¸ªæ¨ç‰¹ç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨ä»–å…³æ³¨çš„ç”¨æˆ· `Id`ï¼Œä»¥åŠè‡ªå·±å‘çš„æ¨æ–‡ `Id` çš„é›†åˆï¼Œä¸ºäº†ä½¿æ¯ä¸ªæ“ä½œçš„å¤æ‚åº¦å°½å¯èƒ½çš„ä½ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®æ“ä½œæ¥å†³å®šå­˜å‚¨è¿™äº›ä¿¡æ¯çš„æ•°æ®ç»“æ„ã€‚æ³¨æ„ï¼Œç”±äºé¢˜ç›®ä¸­æ²¡æœ‰è¯´æ˜ç”¨æˆ·çš„ `Id` æ˜¯å¦è¿ç»­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªä»¥ç”¨æˆ· `Id` ä¸ºç´¢å¼•çš„å“ˆå¸Œè¡¨æ¥å­˜å‚¨ç”¨æˆ·çš„ä¿¡æ¯ã€‚

å¯¹äºæ“ä½œ `3` å’Œæ“ä½œ `4`ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨å­˜å‚¨ï¼Œå³å¯å®ç°æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º $O(1)$ã€‚

å¯¹äºæ“ä½œ `1` å’Œæ“ä½œ `2`ï¼Œç”±äºæ“ä½œ `2` è¦çŸ¥é“æ­¤ç”¨æˆ·å…³æ³¨çš„äººå’Œç”¨æˆ·è‡ªå·±å‘å‡ºçš„æœ€è¿‘åæ¡æ¨æ–‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¯¹æ¯ä¸ªç”¨æˆ·ç”¨é“¾è¡¨å­˜å‚¨å‘é€çš„æ¨æ–‡ã€‚æ¯æ¬¡åˆ›å»ºæ¨æ–‡çš„æ—¶å€™æˆ‘ä»¬åœ¨é“¾è¡¨å¤´æ’å…¥ï¼Œè¿™æ ·èƒ½ä¿è¯é“¾è¡¨é‡Œå­˜å‚¨çš„æ¨æ–‡çš„æ—¶é—´æ˜¯ä»æœ€è¿‘åˆ°æœ€ä¹…çš„ã€‚é‚£ä¹ˆå¯¹äºæ“ä½œ `2`ï¼Œé—®é¢˜å…¶å®å°±ç­‰ä»·äºæœ‰è‹¥å¹²ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å®ƒä»¬åˆèµ·æ¥æœ€è¿‘çš„åæ¡æ¨æ–‡ã€‚ç”±äºé“¾è¡¨é‡Œå­˜å‚¨çš„æ•°æ®éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿™äº›é“¾è¡¨è¿›è¡Œçº¿æ€§å½’å¹¶å³å¯å¾—åˆ°æœ€è¿‘çš„åæ¡æ¨æ–‡ã€‚è¿™ä¸ªæ“ä½œä¸ [23. åˆå¹¶Kä¸ªæ’åºé“¾è¡¨](https://leetcode-cn.com/problems/merge-k-sorted-lists/) åŸºæœ¬ç­‰åŒã€‚

![fig1](https://assets.leetcode-cn.com/solution-static/355_fig1.png)

å¦‚æœæˆ‘ä»¬ç›´æ¥ç…§æ¬ã€Œåˆå¹¶Kä¸ªæ’åºé“¾è¡¨ã€çš„è§£æ³•æ¥è¿›è¡Œåˆå¹¶ï¼Œé‚£ä¹ˆæ— ç–‘ä¼šé€ æˆç©ºé—´çš„éƒ¨åˆ†æµªè´¹ï¼Œå› ä¸ºè¿™ä¸ªé¢˜ç›®ä¸è¦æ±‚ä½ å±•ç¤ºç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åŠ¨æ€ç»´æŠ¤ç”¨æˆ·çš„é“¾è¡¨ï¼Œå­˜å‚¨æœ€è¿‘çš„ `recentMax` ä¸ªæ¨æ–‡ `Id` å³å¯ï¼ˆé¢˜ç›®ä¸­çš„ `recentMax` ä¸º `10`ï¼‰ã€‚é‚£ä¹ˆå¯¹äºæ“ä½œ `1`ï¼Œå½“å‘ç°é“¾è¡¨çš„èŠ‚ç‚¹æ•°ç­‰äº `recentMax` æ—¶ï¼Œæˆ‘ä»¬æŒ‰é¢˜æ„åˆ é™¤é“¾è¡¨æœ«å°¾çš„å…ƒç´ ï¼Œå†æ’å…¥æœ€æ–°çš„æ¨æ–‡ `Id`ã€‚å¯¹äºæ“ä½œ `2`ï¼Œåœ¨ä¸¤ä¸ªé“¾è¡¨è¿›è¡Œçº¿æ€§å½’å¹¶çš„æ—¶å€™ï¼Œåªè¦å·²åˆå¹¶çš„æ•°é‡ç­‰äº `recentMax`ï¼Œä»£è¡¨å·²ç»æ‰¾åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨åˆèµ·æ¥åæœ€è¿‘çš„ `recentMax` æ¡æ¨æ–‡ï¼Œç›´æ¥ç»“æŸåˆå¹¶å³å¯ã€‚

```C++ [sol1-C++]
class Twitter {
    struct Node {
        // å“ˆå¸Œè¡¨å­˜å‚¨å…³æ³¨äººçš„ Id
        unordered_set<int> followee;
        // ç”¨é“¾è¡¨å­˜å‚¨ tweetId
        list<int> tweet;
    };
    // getNewsFeed æ£€ç´¢çš„æ¨æ–‡çš„ä¸Šé™ä»¥åŠ tweetId çš„æ—¶é—´æˆ³
    int recentMax, time;
    // tweetId å¯¹åº”å‘é€çš„æ—¶é—´
    unordered_map<int, int> tweetTime;
    // æ¯ä¸ªç”¨æˆ·å­˜å‚¨çš„ä¿¡æ¯
    unordered_map<int, Node> user;
public:
    Twitter() {
        time = 0;
        recentMax = 10;
        user.clear();
    }
    
    // åˆå§‹åŒ–
    void init(int userId) {
        user[userId].followee.clear();
        user[userId].tweet.clear();
    }

    void postTweet(int userId, int tweetId) {
        if (user.find(userId) == user.end()) {
            init(userId);
        }
        // è¾¾åˆ°é™åˆ¶ï¼Œå‰”é™¤é“¾è¡¨æœ«å°¾å…ƒç´ 
        if (user[userId].tweet.size() == recentMax) {
            user[userId].tweet.pop_back();
        }
        user[userId].tweet.push_front(tweetId);
        tweetTime[tweetId] = ++time;
    }
    
    vector<int> getNewsFeed(int userId) {
        vector<int> ans; ans.clear();
        for (list<int>::iterator it = user[userId].tweet.begin(); it != user[userId].tweet.end(); ++it) {
            ans.emplace_back(*it);
        }
        for (int followeeId: user[userId].followee) {
            if (followeeId == userId) continue; // å¯èƒ½å‡ºç°è‡ªå·±å…³æ³¨è‡ªå·±çš„æƒ…å†µ
            vector<int> res; res.clear();
            list<int>::iterator it = user[followeeId].tweet.begin();
            int i = 0;
            // çº¿æ€§å½’å¹¶
            while (i < (int)ans.size() && it != user[followeeId].tweet.end()) {
                if (tweetTime[(*it)] > tweetTime[ans[i]]) {
                    res.emplace_back(*it);
                    ++it;
                } else {
                    res.emplace_back(ans[i]);
                    ++i;
                }
                // å·²ç»æ‰¾åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨åˆèµ·æ¥åæœ€è¿‘çš„ recentMax æ¡æ¨æ–‡
                if ((int)res.size() == recentMax) break;
            }
            for (; i < (int)ans.size() && (int)res.size() < recentMax; ++i) res.emplace_back(ans[i]);
            for (; it != user[followeeId].tweet.end() && (int)res.size() < recentMax; ++it) res.emplace_back(*it);
            ans.assign(res.begin(),res.end());
        }
        return ans;
    }
    
    void follow(int followerId, int followeeId) {
        if (user.find(followerId) == user.end()) {
            init(followerId);
        }
        if (user.find(followeeId) == user.end()) {
            init(followeeId);
        }
        user[followerId].followee.insert(followeeId);
    }
    
    void unfollow(int followerId, int followeeId) {
        user[followerId].followee.erase(followeeId);
    }
};
```

```Java [sol1-Java]
class Twitter {
    private class Node {
        // å“ˆå¸Œè¡¨å­˜å‚¨å…³æ³¨äººçš„ Id
        Set<Integer> followee;
        // ç”¨é“¾è¡¨å­˜å‚¨ tweetId
        LinkedList<Integer> tweet;

        Node() {
            followee = new HashSet<Integer>();
            tweet = new LinkedList<Integer>();
        }
    }

    // getNewsFeed æ£€ç´¢çš„æ¨æ–‡çš„ä¸Šé™ä»¥åŠ tweetId çš„æ—¶é—´æˆ³
    private int recentMax, time;
    // tweetId å¯¹åº”å‘é€çš„æ—¶é—´
    private Map<Integer, Integer> tweetTime;
    // æ¯ä¸ªç”¨æˆ·å­˜å‚¨çš„ä¿¡æ¯
    private Map<Integer, Node> user;

    public Twitter() {
        time = 0;
        recentMax = 10;
        tweetTime = new HashMap<Integer, Integer>();
        user = new HashMap<Integer, Node>();
    }

    // åˆå§‹åŒ–
    public void init(int userId) {
        user.put(userId, new Node());
    }

    public void postTweet(int userId, int tweetId) {
        if (!user.containsKey(userId)) {
            init(userId);
        }
        // è¾¾åˆ°é™åˆ¶ï¼Œå‰”é™¤é“¾è¡¨æœ«å°¾å…ƒç´ 
        if (user.get(userId).tweet.size() == recentMax) {
            user.get(userId).tweet.remove(recentMax - 1);
        }
        user.get(userId).tweet.addFirst(tweetId);
        tweetTime.put(tweetId, ++time);
    }
    
    public List<Integer> getNewsFeed(int userId) {
        LinkedList<Integer> ans = new LinkedList<Integer>();
        for (int it : user.getOrDefault(userId, new Node()).tweet) {
            ans.addLast(it);
        }
        for (int followeeId : user.getOrDefault(userId, new Node()).followee) {
            if (followeeId == userId) { // å¯èƒ½å‡ºç°è‡ªå·±å…³æ³¨è‡ªå·±çš„æƒ…å†µ
                continue;
            }
            LinkedList<Integer> res = new LinkedList<Integer>();
            int tweetSize = user.get(followeeId).tweet.size();
            Iterator<Integer> it = user.get(followeeId).tweet.iterator();
            int i = 0;
            int j = 0;
            int curr = -1;
            // çº¿æ€§å½’å¹¶
            if (j < tweetSize) {
                curr = it.next();
                while (i < ans.size() && j < tweetSize) {
                    if (tweetTime.get(curr) > tweetTime.get(ans.get(i))) {
                        res.addLast(curr);
                        ++j;
                        if (it.hasNext()) {
                            curr = it.next();
                        }
                    } else {
                        res.addLast(ans.get(i));
                        ++i;
                    }
                    // å·²ç»æ‰¾åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨åˆèµ·æ¥åæœ€è¿‘çš„ recentMax æ¡æ¨æ–‡
                    if (res.size() == recentMax) {
                        break;
                    }
                }
            }
            for (; i < ans.size() && res.size() < recentMax; ++i) {
                res.addLast(ans.get(i));
            }
            if (j < tweetSize && res.size() < recentMax) {
                res.addLast(curr);
                for (; it.hasNext() && res.size() < recentMax;) {
                    res.addLast(it.next());
                }
            }
            ans = new LinkedList<Integer>(res);
        }
        return ans;
    }
    
    public void follow(int followerId, int followeeId) {
        if (!user.containsKey(followerId)) {
            init(followerId);
        }
        if (!user.containsKey(followeeId)) {
            init(followeeId);
        }
        user.get(followerId).followee.add(followeeId);
    }
    
    public void unfollow(int followerId, int followeeId) {
        user.getOrDefault(followerId, new Node()).followee.remove(followeeId);
    }
}
```

```Python [sol1-Python3]
class Twitter:

    class Node:
        def __init__(self):
            self.followee = set()
            self.tweet = list()

    def __init__(self):
        self.time = 0
        self.recentMax = 10
        self.tweetTime = dict()
        self.user = dict()

    def postTweet(self, userId: int, tweetId: int) -> None:
        if userId not in self.user:
            self.user[userId] = Twitter.Node()
        self.user[userId].tweet.append(tweetId)
        self.time += 1
        self.tweetTime[tweetId] = self.time

    def getNewsFeed(self, userId: int) -> List[int]:
        if userId not in self.user:
            return list()
        ans = self.user[userId].tweet[-10:][::-1]
        for followeeId in self.user[userId].followee:
            if followeeId in self.user:
                opt = self.user[followeeId].tweet[-10:][::-1]
                i, j, combined = 0, 0, list()
                while i < len(ans) and j < len(opt):
                    if self.tweetTime[ans[i]] > self.tweetTime[opt[j]]:
                        combined.append(ans[i])
                        i += 1
                    else:
                        combined.append(opt[j])
                        j += 1
                combined.extend(ans[i:])
                combined.extend(opt[j:])
                ans = combined[:10]
        return ans

    def follow(self, followerId: int, followeeId: int) -> None:
        if followerId != followeeId:
            if followerId not in self.user:
                self.user[followerId] = Twitter.Node()
            self.user[followerId].followee.add(followeeId)
            
    def unfollow(self, followerId: int, followeeId: int) -> None:
        if followerId != followeeId:
            if followerId in self.user:
                self.user[followerId].followee.discard(followeeId)
```

**å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š
	
	- æ“ä½œ `1` ï¼š $O(1)$ï¼Œé“¾è¡¨çš„æ’å…¥åˆ é™¤ä¸º $O(1)$ çš„å¤æ‚åº¦ã€‚
	
	- æ“ä½œ `2` ï¼š $O(\textit{recentMax}*num)$ï¼Œå…¶ä¸­ `recentMax = 10`ï¼Œ `num` ä¸ºç”¨æˆ·å…³æ³¨çš„äººåŠ ä¸Šè‡ªå·±çš„æ•°é‡å’Œã€‚å› ä¸ºé“¾è¡¨é‡Œæœ€å¤šå­˜å‚¨ `recentMax` ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤æ¯æ¬¡åˆå¹¶ä¸¤ä¸ªé“¾è¡¨æœ€å¤šæ¯”è¾ƒ `recentMax` æ¬¡åèƒ½å¾—åˆ°ä¸¤ä¸ªé“¾è¡¨æœ€è¿‘çš„ `recentMax` ä¸ªæ¨æ–‡ï¼Œä¸€å…±éœ€è¦åˆå¹¶ `num` æ¬¡ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(\textit{recentMax}*num)$ã€‚
	
	- æ“ä½œ `3` ï¼š $O(1)$ï¼Œå“ˆå¸Œè¡¨æ’å…¥ä¸º $O(1)$ çš„å¤æ‚åº¦ã€‚
	
	- æ“ä½œ `4` ï¼š $O(1)$ï¼Œå“ˆå¸Œè¡¨æ’å…¥ä¸º $O(1)$ çš„å¤æ‚åº¦ã€‚

- ç©ºé—´å¤æ‚åº¦ï¼š$O(\textit{recentMax}*tot)$ï¼Œå…¶ä¸­ `recentMax = 10`ï¼Œ`tot` ä¸ºæ¨ç‰¹æ€»ç”¨æˆ·æ•°ã€‚å³å¯¹äºæ¯ä¸ªç”¨æˆ·æˆ‘ä»¬ä¸ä¼šå­˜å‚¨è¶…è¿‡ `recentMax` ä¸ªæ¨ç‰¹ `Id`ï¼Œæ‰€ä»¥ç©ºé—´ä¸Šé™ä¸º $O(\textit{recentMax}*tot)$ã€‚