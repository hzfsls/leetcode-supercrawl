## [828.ç»Ÿè®¡å­ä¸²ä¸­çš„å”¯ä¸€å­—ç¬¦ ä¸­æ–‡çƒ­é—¨é¢˜è§£2](https://leetcode.cn/problems/count-unique-characters-of-all-substrings-of-a-given-string/solutions/100000/by-ac_oier-922k)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)

## æ¨¡æ‹Ÿ + ä¹˜æ³•åŸç†

è¿™é“é¢˜å’Œ [907. å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247493485&idx=1&sn=c6d6ac25c171e2617c5a95173aa58825) å¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡æ— é¡»è€ƒè™‘è¿ç”¨ã€Œå•è°ƒæ ˆã€ã€‚

åŸé—®é¢˜ä¸ºæ±‚æ‰€æœ‰å­æ•°ç»„çš„å”¯ä¸€å­—ç¬¦æ•°é‡å’Œï¼Œå…¶å¯ç­‰ä»·ä¸ºæ±‚æ¯ä¸ª $s[i]$ å¯¹ç­”æ¡ˆçš„è´¡çŒ®ï¼Œå³æ¯ä¸ª $s[i]$ å¯ä½œä¸ºå¤šå°‘ä¸ªå­æ•°ç»„çš„å”¯ä¸€å…ƒç´ ã€‚

å‡å®šæˆ‘ä»¬èƒ½é¢„å¤„ç†å‡ºä¸¤æ•°ç»„ `l` å’Œ `r` åˆ†åˆ«ä»£è¡¨ $s[i]$ ä½œä¸ºå­æ•°ç»„å”¯ä¸€å­—ç¬¦æ—¶ï¼Œå…¶æ‰€èƒ½åˆ°è¾¾çš„æœ€è¿œä¸¤ç«¯ï¼š
* `l[i] = a` ä»£è¡¨ä¸‹æ ‡ $a$ ä¸º $s[i]$ èƒ½å¤Ÿä½œä¸ºå­æ•°ç»„å”¯ä¸€å­—ç¬¦æ—¶çš„æœ€è¿œå·¦è¾¹ç•Œï¼Œå³ä¸º $s[i]$ å·¦è¾¹ç¬¬ä¸€ä¸ªä¸ $s[i]$ å€¼ç›¸åŒçš„ä½ç½®ï¼ˆè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¸º $a = -1$ï¼‰
* `r[i] = b` ä»£è¡¨è·³è¡¨ $b$ ä¸º $s[i]$ èƒ½å¤Ÿä½œä¸ºå­æ•°ç»„å”¯ä¸€å­—ç¬¦æ—¶çš„æœ€è¿œå³è¾¹ç•Œï¼Œå³ä¸º $s[i]$ å³è¾¹ç¬¬ä¸€ä¸ªä¸ $s[i]$ å€¼ç›¸åŒçš„ä½ç½®ï¼ˆè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¸º $b = n$ï¼‰

å­æ•°ç»„å·¦ç«¯ç‚¹ä¸ªæ•°ä¸º $(i - a)$ ä¸ªï¼Œå³ç«¯ç‚¹ä¸ªæ•°ä¸º $(b - i)$ ä¸ªï¼Œæ ¹æ®ä¹˜æ³•åŸç†å¯çŸ¥ï¼Œå­æ•°ç»„ä¸ªæ•°ä¸ºä¸¤è€…ä¹˜ç§¯ã€‚

é¢„å¤„ç† `l` å’Œ `r` åªéœ€è¦ä½¿ç”¨éå†è®¡æ•°å³å¯ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    public int uniqueLetterString(String s) {
        char[] cs = s.toCharArray();
        int n = cs.length, ans = 0;
        int[] l = new int[n], r = new int[n];
        int[] idx = new int[26];
        Arrays.fill(idx, -1);
        for (int i = 0; i < n; i++) {
            int u = cs[i] - 'A';
            l[i] = idx[u];
            idx[u] = i;
        }
        Arrays.fill(idx, n);
        for (int i = n - 1; i >= 0; i--) {
            int u = cs[i] - 'A';
            r[i] = idx[u];
            idx[u] = i;
        }
        for (int i = 0; i < n; i++) ans += (i - l[i]) * (r[i] - i);
        return ans;
    }
}
```
```Typescript []
function uniqueLetterString(s: string): number {
    let n = s.length, ans = 0
    const l = new Array<number>(n), r = new Array<number>(n)
    const idx = new Array<number>(26).fill(-1)
    for (let i = 0; i < n; i++) {
        const u = s.charCodeAt(i) - 65
        l[i] = idx[u]
        idx[u] = i
    }
    idx.fill(n)
    for (let i = n - 1; i >= 0; i--) {
        const u = s.charCodeAt(i) - 65
        r[i] = idx[u]
        idx[u] = i
    }
    for (let i = 0; i < n; i++) ans += (i - l[i]) * (r[i] - i)
    return ans
};
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## çº¿æ€§ DP

å¦å¤–ä¸€ä¸ªå®ç°æ€è·¯æ˜¯åˆ©ç”¨ã€ŒåŠ¨æ€è§„åˆ’ã€æ€æƒ³ã€‚

å®šä¹‰ $f[i]$ ä¸ºè€ƒè™‘ä»¥ $s[i]$ ä¸ºç»“å°¾çš„æ‰€æœ‰å­ä¸²ä¸­çš„å”¯ä¸€å­—ç¬¦ä¸ªæ•°ã€‚

ä¸å¤±ä¸€èˆ¬æ€§è€ƒè™‘ $f[i]$ è¯¥å¦‚ä½•è½¬ç§»ï¼šä»¥ $s[i]$ ä¸ºç»“å°¾çš„å­ä¸²åŒ…æ‹¬åœ¨æ‰€æœ‰ä»¥ $s[i - 1]$ ä¸ºç»“å°¾çš„å­ä¸²ç»“å°¾æ·»åŠ ä¸€ä¸ªå­—ç¬¦è€Œæ¥ï¼Œä»¥åŠ $s[i]$ å­—ç¬¦æœ¬èº«ç»„æˆçš„æ–°å­ä¸²ã€‚

é¦–å…ˆæˆ‘ä»¬ä»¤ $f[i] = f[i - 1]$ï¼ŒåŒæ—¶ä½¿ç”¨ $b[x]$ è®°å½•å­—ç¬¦ $x$ å‰ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡ï¼Œä½¿ç”¨ $a[x]$ è®°å½•å­—ç¬¦ $x$ åœ¨ä¸Šä¸Šæ¬¡å‡ºç°çš„ä¸‹æ ‡ï¼Œç„¶åå‡è®¾å½“å‰å¤„ç†çš„å­—ç¬¦ä¸º $c = s[i]$ï¼Œè€ƒè™‘ $s[i]$ å¯¹ $f[i]$ çš„å½±å“ï¼ˆæ³¨æ„ $s[i]$ å§‹ç»ˆä¸ºå­ä¸²å³ç«¯ç‚¹ï¼‰ï¼š

* åœ¨å­ä¸²å·¦ç«¯ç‚¹ä¸‹æ ‡èŒƒå›´åœ¨ $[b[c] + 1, i]$ çš„å­ä¸²ä¸­ï¼Œ$s[i]$ å¿…ç„¶åªå‡ºç°ä¸€æ¬¡ï¼ˆæ»¡è¶³å”¯ä¸€å­—ç¬¦è¦æ±‚ï¼‰ï¼Œå³å¯å¢åŠ  $i - b[c]$ ä¸ªå”¯ä¸€å­—ç¬¦ $s[i]$ï¼›
* åœ¨å­ä¸²å·¦ç«¯ç‚¹ä¸‹æ ‡èŒƒå›´åœ¨ $[a[c] + 1, b[c]]$ çš„å­ä¸²ä¸­ï¼ŒåŸæœ¬ä½äº $b[c]$ çš„å­—ç¬¦åœ¨æ–°å­ä¸²ä¸­å‡ºç°æ¬¡æ•°å˜ä¸º $2$ æ¬¡ï¼ˆä¸å†æ»¡è¶³å”¯ä¸€å­—ç¬¦è¦æ±‚ï¼‰ï¼Œå³éœ€å‡å°‘ $b[c] - a[c]$ ä¸ªå”¯ä¸€å­—ç¬¦ $s[i]$ã€‚

ç»¼ä¸Šï¼Œæˆ‘ä»¬æœ‰çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š$f[i] = f[i - 1] + (i - b[s[i]]) - (b[s[i]] - a[s[i]])$

å®ç°ä¸Šï¼Œç”±äº $f[i]$ åªä¾èµ–äº $f[i - 1]$ï¼Œå› æ­¤æˆ‘ä»¬çœŸçš„æ— é¡»åˆ›å»ºåŠ¨è§„æ•°ç»„ï¼Œè€Œåªéœ€è¦ä½¿ç”¨å•ä¸ªå˜é‡ `cur` æ¥è®°å½•å½“å‰å¤„ç†åˆ°çš„ $f[i]$ å³å¯ï¼Œç´¯ç§¯æ‰€æœ‰çš„ $f[i]$ å³æ˜¯ç­”æ¡ˆã€‚

ä»£ç ï¼š
```Java []
class Solution {
    public int uniqueLetterString(String s) {
        int n = s.length(), ans = 0, cur = 0;
        int[] a = new int[26], b = new int[26];
        Arrays.fill(a, -1); Arrays.fill(b, -1);
        for (int i = 0; i < n; i++) {
            int u = s.charAt(i) - 'A';
            cur += i - b[u] - (b[u] - a[u]);
            ans += cur;
            a[u] = b[u]; b[u] = i;
        }
        return ans;
    }
}
```
```TypeScript []
function uniqueLetterString(s: string): number {
    let n = s.length, ans = 0, cur = 0
    const a = new Array<number>(26).fill(-1), b = new Array<number>(26).fill(-1)
    for (let i = 0; i < n; i++) {
        const u = s.charCodeAt(i) - 65
        cur += i - b[u] - (b[u] - a[u])
        ans += cur
        a[u] = b[u]; b[u] = i
    }
    return ans
};
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(C)$ï¼Œå…¶ä¸­ $C = 26$ ä¸ºå­—ç¬¦é›†å¤§å°

---

## åŠ é¤ 

**åŠ é¤ä¸€é“ä¸æœ¬é¢˜ååˆ†ç±»ä¼¼ï¼ˆéœ€ç»“åˆå•è°ƒæ ˆä¸”è€ƒè™‘é‡å¤é—®é¢˜ï¼‰çš„ä¸­ç­‰é¢˜ : [907. å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247493485&idx=1&sn=c6d6ac25c171e2617c5a95173aa58825) ğŸ‰ğŸ‰**

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://acoier.com/oimg/gzh-qrcode.webp) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~