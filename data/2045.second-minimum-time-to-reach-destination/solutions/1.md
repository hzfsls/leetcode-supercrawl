## [2045.åˆ°è¾¾ç›®çš„åœ°çš„ç¬¬äºŒçŸ­æ—¶é—´ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/second-minimum-time-to-reach-destination/solutions/100000/gong-shui-san-xie-yi-ti-shuang-jie-dui-y-88np)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)

## å †ä¼˜åŒ– Dijkstra

æ•´ä½“é¢˜æ„ï¼šåœ¨ä¸€å¼ æ­£æƒæ— å‘å›¾ä¸Šæ±‚ä¸¥æ ¼æ¬¡çŸ­è·¯ï¼Œè¯¥å›¾æ— é‡è¾¹ä¸è‡ªç¯ã€‚

åŒæ—¶æ ¹æ®æç¤º $edges.length <= \min(2 * 10^4, n * (n - 1) / 2)$ å¯çŸ¥ï¼Œè¯¥å›¾ä¸ºã€Œç¨€ç–å›¾ã€ï¼Œå®¹æ˜“æƒ³åˆ°ã€Œå †ä¼˜åŒ– Dijkstraã€åšæ³•ã€‚

å¯¹ã€Œå †ä¼˜åŒ– Dijkstraã€æˆ–è€…ã€Œå…¶ä»–æœ€çŸ­è·¯ç®—æ³•ã€ä¸ç†Ÿæ‚‰çš„åŒå­¦ï¼Œå¯ä»¥çœ‹å‰ç½® ğŸ§€ ï¼š[ã€æœ€çŸ­è·¯/å¿…èƒŒæ¨¡æ¿ã€‘æ¶µç›–æ‰€æœ‰çš„ã€Œå­˜å›¾æ–¹å¼ã€ä¸ã€Œæœ€çŸ­è·¯ç®—æ³•ï¼ˆè¯¦å°½æ³¨é‡Šï¼‰ã€](https%3A//mp.weixin.qq.com/s?__biz%3DMzU4NDE3MTEyMA%3D%3D%26mid%3D2247488007%26idx%3D1%26sn%3D9d0dcfdf475168d26a5a4bd6fcd3505d)ã€‚å†…å®¹å¦‚é¢˜ï¼Œé¦–æ¬¡æ¥è§¦çš„è¯ï¼Œå»ºè®®æ¯ä¸ªæ¨¡æ¿å…ˆæ•²åéã€‚

å›åˆ°æœ¬é¢˜ï¼Œä¸å¸¸è§„çš„ã€Œæ±‚æœ€çŸ­è·¯ã€ä¸åŒï¼Œæœ¬é¢˜éœ€è¦æ±‚å¾—ã€Œä¸¥æ ¼æ¬¡çŸ­è·¯ã€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŸæ¥çš„æœ€çŸ­è·¯ç®—æ³•åŸºç¡€ä¸Šï¼ˆ$dist1[]$ æ•°ç»„ç”¨äºè®°å½•æœ€çŸ­è·¯ï¼‰å¤šå¼•å…¥ä¸€ä¸ª $dist2[]$ æ•°ç»„ï¼Œ$dist2[x]$ ç”¨äºè®°å½•ä»èŠ‚ç‚¹ $1$ åˆ°èŠ‚ç‚¹ $x$ çš„ä¸¥æ ¼æ¬¡çŸ­è·¯ã€‚

ç»´æŠ¤æ¬¡çŸ­è·¯æ˜¯å®¹æ˜“çš„ï¼ŒåŸºæœ¬æ€è·¯ä¸ºï¼š

* è‹¥å½“å‰è·ç¦» $dist$ å°äº $dist1[x]$ï¼ŒåŸæœ¬çš„æœ€çŸ­è·¯ $dist1[x]$ æ²¦ä¸ºæ¬¡çŸ­è·¯ $dist2[x]$ï¼Œå³å…ˆç”¨ $dist1[x]$ æ›´æ–° $dist2[x]$ åï¼Œå†ç”¨ $dist$ æ›´æ–° $dist1[x]$ï¼›
* è‹¥å½“å‰è·ç¦» $dist$ ç­‰äº $dist1[x]$ï¼Œä¸ç¬¦åˆã€Œä¸¥æ ¼æ¬¡çŸ­è·¯ã€ï¼Œå¿½ç•¥ï¼›
* è‹¥å½“å‰è·ç¦» $dist$ å¤§äº $dist1[x]$ï¼Œä¸” $dist$ å°äº $dist2[x]$ï¼Œåˆ™ä½¿ç”¨ $dist$ æ›´æ–° $dist2[x]$ã€‚

åŒæ—¶ï¼Œç”±äºå¤„ç†ã€Œä¸¥æ ¼æ¬¡çŸ­è·¯åŒ…å«é‡å¤è¾¹ã€çš„æƒ…å†µï¼Œæˆ‘ä»¬æ— é¡»ä½¿ç”¨ $vis[]$ æ•°ç»„è®°å½•å¤„ç†è¿‡çš„ç‚¹ï¼Œè€Œè¦ç¡®ä¿æ¯æ¬¡ã€Œæœ€çŸ­è·¯ã€æˆ–è€…ã€Œæ¬¡çŸ­è·¯ã€è¢«æ›´æ–°æ—¶ï¼Œéƒ½è¿›è¡Œå…¥å †æ“ä½œã€‚

ç„¶åè€ƒè™‘ã€Œçº¢ç»¿ç¯ã€åˆ‡æ¢é—®é¢˜ï¼Œè¿™æœ¬è´¨æ˜¯å¼•å…¥åŠ¨æ€è¾¹æƒï¼Œå‡è®¾æˆ‘ä»¬å½“å‰ç»è¿‡ $step$ æ­¥åˆ°è¾¾èŠ‚ç‚¹ $i$ï¼Œæ ¹æ®å…¶ä¸ $change$ çš„å…³ç³»åˆ†æƒ…å†µè®¨è®ºå³å¯ï¼š

* $\left \lfloor \frac{step}{change} \right \rfloor$ ä¸ºå¶æ•°ï¼šå½“å‰å¤„äºç»¿ç¯ï¼ŒåŠ¨æ€è¾¹æƒä¸º $0$ï¼›
* $\left \lfloor \frac{step}{change} \right \rfloor$ ä¸ºå¥‡æ•°ï¼šå½“å‰å¤„äºçº¢ç¯ï¼Œéœ€è¦å¢åŠ åŠ¨æ€è¾¹æƒï¼ˆç­‰å¾…æ—¶é—´ï¼‰ï¼Œå¢åŠ çš„åŠ¨æ€è¾¹æƒä¸º `change - (step % change)`ã€‚

æœ€åï¼Œä¸ºäº†é¿å…æ¯ä¸ªæ ·ä¾‹éƒ½ `new` å¤§æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `static` ä¿®é¥°éœ€è¦ç”¨åˆ°çš„æ•°ç»„ï¼Œå¹¶åœ¨æ‰§è¡Œé€»è¾‘å‰è¿›è¡Œé‡ç½®å·¥ä½œã€‚

ä»£ç ï¼š
```Java []
class Solution {
    static int N = 10010, M = 4 * N, INF = 0x3f3f3f3f, idx = 0;
    static int[] he = new int[N], e = new int[M], ne = new int[M];
    static int[] dist1 = new int[N], dist2 = new int[N];
    void add(int a, int b) {
        e[idx] = b;
        ne[idx] = he[a];
        he[a] = idx;
        idx++;
    }
    public int secondMinimum(int n, int[][] edges, int time, int change) {
        Arrays.fill(dist1, INF);
        Arrays.fill(dist2, INF);
        Arrays.fill(he, -1);
        idx = 0;
        for (int[] e : edges) {
            int u = e[0], v = e[1];
            add(u, v); add(v, u);
        }
        PriorityQueue<int[]> q = new PriorityQueue<>((a,b)->a[1]-b[1]);
        q.add(new int[]{1, 0});
        dist1[1] = 0;
        while (!q.isEmpty()) {
            int[] poll = q.poll();
            int u = poll[0], step = poll[1];
            for (int i = he[u]; i != -1; i = ne[i]) {
                int j = e[i];
                int a = step / change, b = step % change;
                int wait = a % 2 == 0 ? 0 : change - b;
                int dist = step + time + wait;
                if (dist1[j] > dist) {
                    dist2[j] = dist1[j];
                    dist1[j] = dist;
                    q.add(new int[]{j, dist1[j]});
                    q.add(new int[]{j, dist2[j]});
                } else if (dist1[j] < dist && dist < dist2[j]) {
                    dist2[j] = dist;
                    q.add(new int[]{j, dist2[j]});
                }
            }
        }
        return dist2[n];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $n$ ä¸ºç‚¹æ•°ï¼Œ$m$ ä¸ºè¾¹æ•°ï¼Œå †ä¼˜åŒ– Dijkstra çš„å¤æ‚åº¦ä¸º $O(m\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n + m)$

---

## BFS

æ›´è¿›ä¸€æ­¥ï¼ŒåŸå›¾è¾¹æƒè™½ç„¶ç”±ã€Œå›ºå®šéƒ¨åˆ† $time$ã€å’Œã€ŒåŠ¨æ€éƒ¨åˆ† $change$ ç›¸å…³ã€æ‰€ç»„æˆï¼Œä½†åœ¨è·¯å¾„å›ºå®šçš„å‰æä¸‹ï¼Œå…¶å®è¾¹æƒä¹‹å’Œå®Œå…¨ç¡®å®šã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆå°†åŸå›¾ç­‰ä»·ä¸ºè¾¹æƒä¸º $1$ çš„æ–°å›¾ï¼Œé€šè¿‡ `BFS` æ±‚å‡ºæœ€çŸ­è·¯ $dist1[x]$ å’Œä¸¥æ ¼æ¬¡çŸ­è·¯ $dist2[x]$ï¼Œç„¶ååˆ©ç”¨æ­¤æ—¶çš„ $dist2[n]$ å…¶å®æ˜¯ä¸¥æ ¼æ¬¡çŸ­è·¯çš„è¾¹æ•°ï¼Œè®¡ç®—åŸå›¾ä¸Šçš„è¾¹æƒä¹‹å’Œã€‚

ä»£ç ï¼š
```Java []
class Solution {
    static int N = 10010, M = 4 * N, INF = 0x3f3f3f3f, idx = 0;
    static int[] he = new int[N], e = new int[M], ne = new int[M];
    void add(int a, int b) {
        e[idx] = b;
        ne[idx] = he[a];
        he[a] = idx;
        idx++;
    }
    public int secondMinimum(int n, int[][] edges, int time, int change) {
        Arrays.fill(he, -1);
        idx = 0;
        for (int[] e : edges) {
            int u = e[0], v = e[1];
            add(u, v); add(v, u);
        }
        Deque<int[]> d = new ArrayDeque<>();
        int[] dist1 = new int[n + 10], dist2 = new int[n + 10];
        Arrays.fill(dist1, INF);
        Arrays.fill(dist2, INF);
        d.addLast(new int[]{1, 0});
        dist1[1] = 0;
        while (!d.isEmpty()) {
            int[] poll = d.pollFirst();
            int u = poll[0], dist = poll[1];
            for (int i = he[u]; i != -1; i = ne[i]) {
                int j = e[i];
                if (dist1[j] > dist + 1) {
                    dist2[j] = dist1[j];
                    dist1[j] = dist + 1;
                    d.addLast(new int[]{j, dist1[j]});
                    d.addLast(new int[]{j, dist2[j]});
                } else if (dist1[j] < dist + 1 && dist + 1 < dist2[j]) {
                    dist2[j] = dist + 1;
                    d.addLast(new int[]{j, dist2[j]});
                }
            }
        }
        int ans = 0;
        for (int i = 0; i < dist2[n]; i++) {
            int a = ans / change, b = ans % change;
            int wait = a % 2 == 0 ? 0 : change - b;
            ans += time + wait;
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $n$ ä¸ºç‚¹æ•°ï¼Œ$m$ ä¸ºè¾¹æ•°ï¼ŒBFS çš„å¤æ‚åº¦ä¸º $O(n + m)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n + m)$

---

## AStar ç®—æ³•

åœ¨ `BFS` çš„åŸºç¡€ä¸Šå†è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†é—®é¢˜æ‹“å±•ä¸ºã€Œä½¿ç”¨ AStar ç®—æ³•æ¥æ‰¾ç¬¬ `K` çŸ­è·¯ã€ï¼ˆä¿®æ”¹ä»£ç çš„ `K` å³å¯ï¼‰ï¼Œåˆ©ç”¨ç»ˆç‚¹çš„ç¬¬ $k$ æ¬¡å‡ºé˜Ÿå¿…ç„¶æ˜¯ç¬¬ $k$ çŸ­è·¯ï¼ˆæ³¨æ„è¦æ±‚çš„æ˜¯ä¸¥æ ¼çš„ç¬¬ $k$ çŸ­è·¯ï¼‰ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    static int N = 10010, M = 4 * N, INF = 0x3f3f3f3f, K = 2, idx = 0, n = 0;
    static int[] he = new int[N], e = new int[M], ne = new int[M];
    static int[] dist = new int[N];
    void add(int a, int b) {
        e[idx] = b;
        ne[idx] = he[a];
        he[a] = idx;
        idx++;
    }
    void bfs() {
        Arrays.fill(dist, INF);
        Deque<Integer> d = new ArrayDeque<>();
        d.addLast(n);
        dist[n] = 0;
        while (!d.isEmpty()) {
            int x = d.pollFirst(), step = dist[x];
            for (int i = he[x]; i != -1; i = ne[i]) {
                int j = e[i];
                if (dist[j] != INF) continue;
                dist[j] = step + 1;
                d.addLast(j);
            }
        }
    }
    int astar() {
        int k = K, min = -1;
        PriorityQueue<int[]> q = new PriorityQueue<>((a,b)->a[2]-b[2]);
        q.add(new int[]{1, 0, dist[1]});
        while (!q.isEmpty()) {
            int[] poll = q.poll();
            int x = poll[0], step = poll[1];
            if (x == n && min != step) {
                min = step;
                if (--k == 0) return min; 
            }
            for (int i = he[x]; i != -1; i = ne[i]) {
                int j = e[i];
                q.add(new int[]{j, step + 1, step + 1 + dist[j]});
            }
        }
        return -1; // never
    }
    public int secondMinimum(int _n, int[][] edges, int time, int change) {
        n = _n; idx = 0;
        Arrays.fill(he, -1);
        for (int[] e : edges) {
            int u = e[0], v = e[1];
            add(u, v); add(v, u);
        }
        bfs();
        int cnt = astar(), ans = 0;
        for (int i = 0; i < cnt; i++) {
            int a = ans / change, b = ans % change;
            int wait = a % 2 == 0 ? 0 : change - b;
            ans += time + wait;
        }
        return ans;
    }
}
```

---

## å…¶ä»–ã€Œæœ€çŸ­è·¯ã€ç›¸å…³å†…å®¹

è€ƒè™‘åŠ ç»ƒå¦‚ä¸‹ã€Œæœ€çŸ­è·¯ã€ç›¸å…³å†…å®¹ ğŸ­ğŸ­ğŸ­

| é¢˜ç›®                                                         | é¢˜è§£                                                         | éš¾åº¦ | æ¨èæŒ‡æ•° |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- | -------- |
| [407. æ¥é›¨æ°´ II](https://leetcode-cn.com/problems/trapping-rain-water-ii/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/trapping-rain-water-ii/solution/gong-shui-san-xie-jing-dian-dijkstra-yun-13ik/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [743. ç½‘ç»œå»¶è¿Ÿæ—¶é—´](https://leetcode-cn.com/problems/network-delay-time/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/network-delay-time/solution/gong-shui-san-xie-yi-ti-wu-jie-wu-chong-oghpz/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [787. K ç«™ä¸­è½¬å†…æœ€ä¾¿å®œçš„èˆªç­](https://leetcode-cn.com/problems/cheapest-flights-within-k-stops/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/cheapest-flights-within-k-stops/solution/gong-shui-san-xie-xiang-jie-bellman-ford-dc94/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [1631. æœ€å°ä½“åŠ›æ¶ˆè€—è·¯å¾„](https://leetcode-cn.com/problems/path-with-minimum-effort/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/path-with-minimum-effort/solution/fan-zheng-fa-zheng-ming-si-lu-de-he-fa-x-ohby/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©      |
| [1786. ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å—é™è·¯å¾„æ•°](https://leetcode-cn.com/problems/number-of-restricted-paths-from-first-to-last-node/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/number-of-restricted-paths-from-first-to-last-node/solution/xiang-jie-dui-you-hua-dijkstra-dong-tai-i6j0d/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©      |

**æ³¨ï¼šä»¥ä¸Šç›®å½•æ•´ç†æ¥è‡ª [wiki](https://github.com/SharingSource/LogicStack-LeetCode/wiki/æœ€çŸ­è·¯)ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½å¼•ç”¨è¯·ä¿ç•™å‡ºå¤„ã€‚**

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~