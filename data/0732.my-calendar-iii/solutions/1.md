## [732.æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ III ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/my-calendar-iii/solutions/100000/xian-duan-shu-by-xiaohu9527-rfzj)

ä½œè€…ï¼š[Xiaohu9527](https://leetcode.cn/u/Xiaohu9527)

### å‰è¨€
æœ¬äººè¢«çº¿æ®µæ ‘æŠ˜ç£¨å·²ä¹…ï¼Œæ€»æ˜¯é€ƒé¿ä¸æƒ³å­¦ä¹ ï¼Œä»Šå¤©ç»ˆäºåˆå…¥é—¨é“ï¼Œå› æ­¤æ¥å†™ä¸€ç¯‡æ¯”è¾ƒåŸºç¡€çš„çº¿æ®µæ ‘é¢˜è§£ä¾›å¤§å®¶å­¦ä¹ å‚è€ƒã€‚å»ç½‘ä¸Šæœç´¢çº¿æ®µæ ‘å­¦ä¹ çš„æ—¶å€™ï¼Œæœ€ç»å…¸çš„åº”è¯¥æ˜¯åŠ›æ‰£ç¬¬307é¢˜â€œ[åŒºåŸŸå’Œæ£€ç´¢](https://leetcode.cn/problems/range-sum-query-mutable/)â€ã€‚å°±æ˜¯ç»™ä½ ä¸€ä¸ªæ•°ç»„ï¼Œä¼šæœ‰ç®€å•çš„æ›´æ–°æ“ä½œä»¥åŠæŸ¥è¯¢åŒºåŸŸå’Œçš„æ“ä½œã€‚æŸ¥è¯¢æ“ä½œæŒ‡çš„æ˜¯ç»™ä½ ä¸€ä¸ªåŒºé—´`[L,R]`, è¿”å›è¯¥åŒºé—´`[L,R]`å†…æ‰€æœ‰å…ƒç´ çš„å’Œã€‚æ›´æ–°æ“ä½œæŒ‡çš„æ˜¯ï¼Œç»™ä½ ä¸€ä¸ªä¸‹æ ‡ç´¢å¼•å’Œä¸€ä¸ªå€¼ï¼Œå°†æ•°ç»„ä¸­è¯¥ç´¢å¼•å€¼å¯¹äºçš„å…ƒç´ å€¼æ”¹ä¸ºæ–°çš„ç»™å®šå€¼ã€‚åœ¨è®²æœ¬é¢˜çš„é¢˜è§£å‰æˆ‘ä»¬å¾—å…ˆä»è¿™ä¸€é¢˜å¼€å§‹è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ç”¨çº¿æ®µæ ‘ï¼Œä½¿ç”¨çº¿æ®µæ ‘æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œçº¿æ®µæ ‘çš„æ€æƒ³æ˜¯ä»€ä¹ˆã€‚ç”±äºæ—¶é—´åŸå› ä¸å¯èƒ½å¤ªè¿‡å…¨é¢ï¼Œæœ¬æ–‡è¾ƒé•¿ï¼Œä½†æ˜¯è¯»æ‡‚åè¯»è€…èƒ½å­¦åˆ°è®¸å¤šï¼Œæˆ‘ä»¬è¿›å…¥çº¿æ®µæ ‘çš„æ¢ç´¢è¿‡ç¨‹ã€‚
**æ³¨ï¼šæ£€ç´¢åŒºé—´å³ä¸ºæŸ¥è¯¢åŒºé—´ã€‚ä¸ä¸€æ ·çš„è¯ï¼Œç›¸è¿‘çš„æ„æ€ã€‚ä¸‹é¢åªæ˜¯ä¸å°å¿ƒç”¨äº†ä¸ªæ£€ç´¢è¿™ä¸ªç”Ÿè¯ã€‚**
********************
### çº¿æ®µæ ‘ï¼ˆåŒºåŸŸå’Œæ£€ç´¢é—®é¢˜ï¼‰
#### 1.æœ´ç´ çš„æ€æƒ³
å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬æƒ³å¯¹å…¶ä¸€ä¸ªåŒºé—´æŸ¥è¯¢å…¶åŒºé—´å’Œï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªæ•°ç»„çš„æŸ¥è¯¢æ“ä½œï¼ŒåŠæ‰¾åˆ°è¯¥åŒºé—´å†…æ‰€æœ‰å…ƒç´ çš„å’Œçš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n)$ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´æ–°å…¶æ•°ç»„å†…çš„ä¸€ä¸ªæ•°çš„å€¼ï¼Œè¿™ä¸ªæ›´æ–°æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¾¿ä¸º$O(1)$ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®ä¸‹æ ‡è¿›è¡Œä¿®æ”¹ã€‚
![7ceb305aa9aa94999a3fd9e70c14021.png](https://pic.leetcode.cn/1654475429-nPxEuU-7ceb305aa9aa94999a3fd9e70c14021.png)
#### 2.å‰ç¼€å’Œ
æåˆ°å’Œï¼Œå°¤å…¶æ˜¯å¯¹äºæŸ¥è¯¢åŒºé—´å’Œï¼Œæˆ‘ä»¬å®¹æ˜“æƒ³åˆ°çš„ä¸€ä¸ªç‚¹å°±æ˜¯ä½¿ç”¨å‰ç¼€å’Œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†æŸ¥è¯¢çš„æ“ä½œæå‡åˆ°$O(1)$, ä½†æ˜¯ä½¿ç”¨å‰ç¼€å’Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬çš„æ›´æ–°æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œå°¤å…¶æ˜¯éœ€è¦æ›´æ–°çš„å…ƒç´ æ¯”è¾ƒé å‰æ—¶ï¼Œæ¯ä¸€æ¬¡æ›´æ–°çš„ä»£ä»·éƒ½ä¼šä¸º$O(n)$ï¼Œä»è€Œæ²¡æœ‰è¾¾åˆ°ä¼˜åŒ–çš„æ•ˆæœã€‚**ä½†æ˜¯å¯¹äºå…ƒç´ ä¸å˜åŠ¨çš„æ•°ç»„å‰ç¼€å’Œè¿˜æ˜¯æœ‰å¾ˆä¸é”™çš„ä¼˜åŠ¿ï¼**
![865c2871b073173ea3913b033cbb996.png](https://pic.leetcode.cn/1654475963-dYHHeJ-865c2871b073173ea3913b033cbb996.png)
#### 3.çº¿æ®µæ ‘
é‚£ä¹ˆçº¿æ®µæ ‘ä¸ºä»€ä¹ˆä¼šå¯¹æ­¤æœ‰å½±å“å‘¢ï¼Ÿçº¿æ®µæ ‘å°†æ­¤ç±»é—®é¢˜çš„æŸ¥è¯¢ä»¥åŠæ›´æ–°çš„æ—¶é—´å¤æ‚åº¦éƒ½å˜æˆäº†$O(logn)$ã€‚å½“è¿›è¡Œ**å¤šæ¬¡æŸ¥è¯¢ä¸æ›´æ–°**æ—¶ï¼Œçº¿æ®µæ ‘ä¸€å®šæ¯”ä¸Šè¿°ä¸¤ç§æ–¹æ³•æ›´å…·ä¼˜åŠ¿ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹çº¿æ®µæ ‘æ˜¯ä»€ä¹ˆç»“æ„ã€‚è¿™ç§ç»“æ„æœ‰ç‚¹åƒå †ï¼Œé¦–å…ˆæ¯”è¾ƒé‡è¦éœ€è¦çŸ¥é“çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ç”¨æ•°ç»„æ¥è¡¨ç¤ºæ ‘çš„ç»“æ„ï¼Œå¯¹äºæ ¹æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå®ƒä¼šåœ¨`index=1`çš„ä½ç½®ä¸Š(å…¶å®æ­¤å¤„0ä¹Ÿè¡Œï¼Œä¸è¿‡å¤§å®¶æ™®éç”¨1,åŒºåˆ«å°±æ˜¯è®¡ç®—å­èŠ‚ç‚¹çš„æ–¹å¼ä¸åŒ)ï¼Œç„¶åå¯¹äºå…¶èŠ‚ç‚¹çš„å·¦å³å­èŠ‚ç‚¹çš„ä¸‹æ ‡åˆ†åˆ«ä¸º`2*index`ä¸`2*index+1`ã€‚ç„¶åå…¶å­èŠ‚ç‚¹ä¹Ÿæ˜¯è¿™æ ·çš„è§„å¾‹ï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ¥è§¦å»ºè®®è¯»è€…ç”¨çº¸ç¬”è‡ªå·±è®¡ç®—ä¸€ç•ªã€‚è¿™å°±æ˜¯ä¸€æ£µæ»¡äºŒå‰æ ‘å¯¹äºä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹æ ‡è®¡ç®—æ–¹å¼ã€‚
![image.png](https://pic.leetcode.cn/1654492806-OPBLfB-image.png)
æŸ¥è¯¢: æˆ‘ä»¬ä¼šæ ¹æ®åŒºé—´`ä»æ ¹èŠ‚ç‚¹`å‘æ ‘çš„ä¸¤è¾¹é€’å½’æŸ¥å¯»ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨è¦æŸ¥æ‰¾æ­¤æ ‘çš„`[2,4]`çš„åŒºé—´å’Œï¼ŒåŠ`[50,50,1]`çš„å’Œ, é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ
![image.png](https://pic.leetcode.cn/1654492870-AXElKN-image.png)
æ›´æ–°ï¼šå‡è®¾æˆ‘ä»¬è¦å°†å…¶æ•°ç»„ä¸­çš„`1`æ›´æ–°ä¸º`2`ï¼Œç»“æ„ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿè€Œæœ‰é‚£äº›èŠ‚ç‚¹ä¼šåšå‡ºæ”¹å˜å‘¢ï¼Ÿ
![image.png](https://pic.leetcode.cn/1654492907-RrcDkw-image.png)
åˆ°æ­¤æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº†çº¿æ®µæ ‘äº†ï¼Œæˆ‘ä»¬å‘ç°çº¿æ®µæ ‘è®©æ›´æ–°ä¸æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦éƒ½å˜æˆäº†$O(logn)$, ä¸‹é¢æˆ‘ä»¬æ¥ä»£ç å±‚é¢çš„å­¦ä¹ ä¸€ä¸‹çº¿æ®µæ ‘ã€‚
************************
#### 1. å»ºæ ‘
![image.png](https://pic.leetcode.cn/1654502669-NYSNdm-image.png)
è·‘å®Œä»¥ä¸Šä»£ç åï¼Œæˆ‘ä»¬çš„çº¿æ®µæ ‘æ•°ç»„å¦‚ä¸‹: ï¼ˆå¯ä»¥å‘ç°æ ¹èŠ‚ç‚¹åœ¨ç´¢å¼•ä¸º`1`çš„ä½ç½®çš„ç¡®ä¸º284ï¼Œæ˜¯æ‰€æœ‰å…ƒç´ çš„å’Œï¼Œè¯»è€…å¯ä»¥æ ¹æ®æ ‘çš„ç»“æ„ï¼Œä»¥åŠä»å¼€å¤´ä»‹ç»çš„å·¦å³å­èŠ‚ç‚¹çš„è®¡ç®—æ–¹å¼ä¸€ä¸€æ£€æŸ¥æ˜¯å¦æ­£ç¡®
![image.png](https://pic.leetcode.cn/1654502837-eeXbBG-image.png)
**********************
#### 2. æ£€ç´¢
æ£€ç´¢éœ€è¦è®¨è®ºä»¥ä¸‹æƒ…å†µï¼š
æƒ…å†µä¸€ï¼š
![image.png](https://pic.leetcode.cn/1654478958-YzcdJk-image.png)
æƒ…å†µäºŒï¼š
æƒ…å†µäºŒåˆ™æ˜¯å½“å‰åŒºé—´è¢«æˆ‘ä»¬çš„æ£€ç´¢åŒºé—´åŒ…å›´ï¼ŒåŠè“è‰²åŒºé—´åœ¨ç»¿è‰²åŒºé—´é‡Œé¢æ—¶ï¼Œå› æ­¤ä¸å¿…ç»§ç»­å¾€ä¸‹é€’å½’ï¼Œå¯ä»¥ç›´æ¥è¿”å›å½“å‰èŠ‚ç‚¹å€¼ã€‚è¿™é‡Œæ¯”è¾ƒå®¹æ˜“æƒ³ï¼Œè¯»è€…å¯å‚è€ƒä¹‹å‰çš„çº¿æ®µæ ‘æŸ¥è¯¢ã€‚æ€è€ƒä¸€ä¸‹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºçš„éƒ½æ˜¯ä¸€ä¸ªåŒºé—´å†…æ‰€æœ‰å…ƒç´ çš„å’Œï¼Œé‚£ä¹ˆå½“æ•´ä¸ªå½“å‰åŒºé—´éƒ½è¢«æˆ‘ä»¬çš„æ£€ç´¢åŒºé—´åŒ…å›´äº†ï¼Œè¯æ˜æˆ‘ä»¬éœ€è¦æ‰€æœ‰çš„å…ƒç´ ï¼Œå› æ­¤ä¸å¿…ç»§ç»­å¾€ä¸‹é€’å½’æŸ¥è¯¢ï¼Œå¯ä»¥è¿”å›å…¶èŠ‚ç‚¹å€¼ã€‚è­¬å¦‚ä¹‹å‰ä¾‹å­ä¸­çš„åŒºé—´`[3,4]`ï¼Œä»£ç è¾“å‡ºä¸­ä¾ç„¶å¯ä»¥è§‚å¯Ÿåˆ°è¿™ä¸€ç‚¹ã€‚

ä»£ç å¦‚ä¸‹:
![image.png](https://pic.leetcode.cn/1654479351-AtmiGP-image.png)
ç¤ºä¾‹æŸ¥è¯¢åŒºé—´`[2,4]`çš„åŒºåŸŸå’Œç»“æœå¦‚ä¸‹: 50 + 50 + 1 = 101.ä¸ºäº†å¯è§†åŒ–ï¼Œæˆ‘åœ¨å…¶`query`æ–¹æ³•ä¸­åŠ å…¥äº†å‡ è¡Œè¾“å‡ºã€‚æˆ‘ä»¬å¯ä»¥å‘ç°å½“é€’å½’åˆ°åŒºé—´`[3,4]`æ—¶å…¶å®å·²ç»åœæ­¢ç»§ç»­é€’å½’ä¸‹å»äº†ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚
![image.png](https://pic.leetcode.cn/1654503176-NPAxFI-image.png)
******************
#### 3. æ›´æ–°
æ›´æ–°ä¸å»ºæ ‘å¾ˆåƒï¼Œå½“å…¶é€’å½’åˆ°å‡ºå£æ—¶å°±è¯´æ˜æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†è¦æ›´æ–°å…ƒç´ çš„èŠ‚ç‚¹ã€‚è¦æ³¨æ„æ›´æ–°å®Œå…ƒç´ åï¼Œå…¶åŒ…å«æ­¤å…ƒç´ çš„åŒºé—´èŠ‚ç‚¹éƒ½éœ€è¦æ›´æ–°ï¼Œä»£ç ä¸­å·²åŠ æ³¨é‡Šã€‚
![image.png](https://pic.leetcode.cn/1654479939-WKnwrz-image.png)
æˆ‘ä»¬åšä¸€æ¬¡æ›´æ–°ï¼Œå°†æ•°ç»„ä»`[93,90,50,50,1]`æ”¹åˆ°`[93,90,50,50,2]`ï¼Œç„¶ååœ¨åšä¸€æ¬¡æŸ¥è¯¢çœ‹ç»“æœæ˜¯å¦æ­£ç¡®:
![image.png](https://pic.leetcode.cn/1654502577-yXkXqb-image.png)
*****************************
### æœ¬é¢˜
ç»ˆäºæ¥åˆ°äº†æœ¬é¢˜ï¼Œå¦‚æœä¸äº†è§£ä»¥ä¸ŠçŸ¥è¯†ï¼Œæˆ‘ä»¬æ ¹æœ¬æ— æ³•è®¨è®ºæœ¬é¢˜çš„è§£é¢˜æ–¹æ³•ã€‚é¦–å…ˆæˆ‘ä»¬æ¥å°†é—®é¢˜è½¬åŒ–ä¸€ä¸‹ï¼Œè®©é¢˜æ„æ›´åŠ æ˜æ˜¾ï¼Œå…¶å®æœ¬é¢˜çš„æœ¬è´¨å°±æ˜¯ç»™ä½ ä¸€ä¸ªåŒºé—´ï¼Œç„¶åè®©ä½ å°†å…¶`[start, end)`å†…æ‰€æœ‰çš„å…ƒç´ å€¼åŠ ä¸Šä¸€ï¼Œåœ¨è¿›è¡Œäº†æ¯ä¸€æ¬¡çš„`book`æ›´æ–°çš„æ“ä½œåï¼Œåœ¨è¿”å›`[0, 1e9]`è¿™ä¸ªåŒºé—´å†…çš„æœ€å¤§å…ƒç´ å€¼æ˜¯å¤šå°‘ã€‚æœ¬é¢˜çš„è§£æ³•æœ¬è´¨ä¸Šå…¶å®ä¹Ÿæ˜¯è¿ç”¨äº†çº¿æ®µæ ‘çš„æ€æƒ³ï¼Œ**ä½†æ˜¯ä»æ£€æŸ¥åŒºåŸŸå’Œï¼Œå˜ä¸ºäº†æ£€ç´¢çº¿æ®µæ ‘ä¸­å¶å­èŠ‚ç‚¹çš„æœ€å¤§å€¼æ˜¯å¤šå°‘**ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“çš„æƒ³åˆ°ï¼Œå¯¹äºå…¶ä¸€æ®µåŒºé—´æˆ‘ä»¬éœ€è¦`book`æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ éƒ½åŠ ä¸Š`1`ã€‚æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•çœŸçš„å»å»ºæ ‘ï¼Œä»¥åŠçœŸçš„å»æ›´æ–°å…¶å…ƒç´ å€¼ã€‚å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºæ­¤é¢˜çš„æ•°æ®é—®é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½é€ æˆå†…å­˜æº¢å‡ºã€‚å› æ­¤æˆ‘ä»¬ç”¨å“ˆå¸Œè¡¨æ¥è¡¨ç¤ºæˆ‘ä»¬çš„çº¿æ®µæ ‘ï¼Œè¿™æ ·å¯ä»¥çœå»è®¸å¤šå†…å­˜ç©ºé—´ã€‚å¯¹äºå…¶ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸éœ€è¦çœŸçš„å»æ‰‹åŠ¨æ›´æ–°æ¯ä¸ªèŠ‚ç‚¹å€¼ï¼Œè¿™ä¸æœ´ç´ æ€æƒ³æ— å¼‚ã€‚æˆ‘ä»¬é€‰æ‹©çš„æ˜¯å®˜è§£ä¸­çš„`æ‡’æ ‡è®°`ï¼ŒåŠ**å¦‚æœå½“å‰èŠ‚ç‚¹åŒºé—´çš„è¢«ç´¢å¼•çš„åŒºé—´è¦†ç›–æ—¶ï¼Œæˆ‘ä»¬åˆ™å°†è¡¨ç¤ºæ­¤åŒºé—´çš„èŠ‚ç‚¹å€¼åŠ ä¸€ï¼Œè¡¨ç¤ºæ­¤åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ å€¼éƒ½åŠ äº†ä¸€ä½ï¼Œè¿™é‡Œå¾ˆé‡è¦ï¼Œè¯»è€…éœ€è¦å¤šè¯»å‡ éã€‚** ä¸ªäººè§‰å¾—æ‡’æ ‡è®°æœ€éš¾ç†è§£çš„åœ°æ–¹å°±åœ¨è¿™é‡Œï¼Œè¯¦ç»†å¯çœ‹æ€è·¯æ­¥éª¤ä¸­çš„ç¬¬äºŒç‚¹è§£è¯»ã€‚
*************
æ€è·¯æ­¥éª¤ï¼š
1. éœ€è¦ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œä¸€ä¸ªç”¨äºçº¿æ®µæ ‘ï¼Œä¸€ä¸ªç”¨äºåŒºé—´çš„æ‡’æ ‡è®°ä½¿ç”¨ã€‚æ³¨æ„æ­¤æ—¶çš„çº¿æ®µæ ‘çš„èŠ‚ç‚¹æ‹¥æœ‰çš„æ˜¯è¯¥åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ ä¸­çš„æœ€å¤§å€¼ã€‚ï¼ˆä¸è¦è¢«ä¸Šè¿°åŒºé—´å’Œçš„ä¾‹å­å¹²æ‰°ï¼Œæ³¨æ„æœ¬é¢˜é—®çš„æ˜¯ä»€ä¹ˆï¼åŒºé—´å’Œæä¾›çš„æ˜¯æ€è·¯ï¼)
2. å¯¹äºä¸€ä¸ªåŒºé—´çš„æ›´æ–°ï¼Œæˆ‘ä»¬å·¦å³é€’å½’ï¼Œä¸‹é¢åˆ†ç±»è®¨è®ºï¼š
    - å½“è¯¥åŒºé—´ä¸åœ¨æ£€ç´¢åŒºé—´å†…æ—¶ï¼Œåˆ™`start > r || end < l`ï¼Œä¸åšæ›´æ–°ï¼Œç›´æ¥è¿”å›ã€‚
    - å½“è¯¥åŒºé—´è¢«æ£€ç´¢åŒºé—´è¦†ç›–æ—¶ï¼Œæˆ‘ä»¬**æ— éœ€æ‰‹åŠ¨å»æ›´æ–°è¯¥åŒºé—´å†…æ‰€æœ‰å…ƒç´ å€¼ï¼Œåªéœ€è¦æ ‡è®°ä¸€ä¸‹è¯¥åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ éƒ½è¢«åŠ ä¸Šäº†ä¸€ä½å³å¯**ã€‚æ˜¾è€Œæ˜“è§ï¼Œæ— è®ºå½“å‰èŠ‚ç‚¹åŒºé—´çš„æœ€å¤§å€¼ä¸ºå¤šå°‘ï¼Œå½“è¯¥åŒºé—´çš„æ‰€æœ‰å…ƒç´ å€¼éƒ½åŠ ä¸€æ—¶ï¼Œå…¶æ‹¥æœ‰çš„æœ€å¤§å€¼è‡ªç„¶ä¹Ÿéœ€è¦åŠ ä¸€ä½ã€‚
    - å½“è¯¥åŒºé—´å†…æœ‰å…ƒç´ ä¸åœ¨å…¶æ£€ç´¢åŒºé—´æ—¶ï¼Œé€’å½’å·¦å³ä¸¤è¾¹å»æ›´æ–°æˆ‘ä»¬çš„çº¿æ®µæ ‘ã€‚
3. è¿”å›æ ¹èŠ‚ç‚¹çš„æœ€å¤§å€¼ï¼ŒåŠæ‰€æœ‰å…ƒç´ ä¸­çš„æœ€å¤§å€¼ã€‚
**************
```cpp []
class MyCalendarThree {
private:
    unordered_map<int, int> tree;
    unordered_map<int, int> lazy;
public:
    MyCalendarThree() {

    }

    void update(int start, int end, int l, int r, int node)
    {
        if(start > r || end < l) {
            return;
        } else if(start <= l && r <= end) { 
            // å½“å‰åŒºé—´è¢«æ£€ç´¢åŒºé—´è¦†ç›–, å› æ­¤åŒºé—´å†…æ‰€æœ‰å…ƒç´ éƒ½åŠ ä¸€
            // è‡ªç„¶è€Œç„¶ï¼Œæ— è®ºå½“å‰èŠ‚ç‚¹åŒºé—´çš„æœ€å¤§å€¼ä¸ºå¤šå°‘ï¼Œå½“è¯¥åŒºé—´çš„æ‰€æœ‰
            // å…ƒç´ å€¼éƒ½åŠ ä¸€æ—¶ï¼Œå…¶æ‹¥æœ‰çš„æœ€å¤§å€¼è‡ªç„¶ä¹Ÿéœ€è¦åŠ ä¸€ä½
            ++tree[node]; 
            ++lazy[node];
        } else {
            int left_node = node*2, right_node = node*2 + 1;
            int mid = (l+r) >> 1;
            update(start, end, l, mid, left_node);
            update(start, end, mid+1, r, right_node);
            tree[node] = lazy[node] + max(tree[left_node], tree[right_node]);
        }
    }
    
    int book(int start, int end) {
        update(start, end-1, 0, 1e9, 1);
        return tree[1];
    }
};
```
```cpp []
// çº¿æ®µæ ‘ä»£ç 
#include <iostream>
#include <vector>
using namespace std;

void build_tree(vector<int>& arr, vector<int>& tree, int start, int end, int node_idx)
{
    //é€’å½’çš„å‡ºå£ï¼Œä¹Ÿå°±æ˜¯åˆ°äº†å¶å­èŠ‚ç‚¹
    if(start == end) {
        tree[node_idx] = arr[start];
    } else {
        //æ‰¾åˆ°å·¦å­æ ‘çš„èŠ‚ç‚¹(2*node_idx)
        //æ‰¾åˆ°å³å­æ ‘çš„èŠ‚ç‚¹(2*node_idx+1)
        int left_node = 2*node_idx, right_node = 2*node_idx + 1;
        int mid = (start + end) / 2;
        //å°†æ ‘è¿›è¡Œåˆ†å‰²ï¼Œç„¶åå·¦å³é€’å½’å»ºæ ‘
        build_tree(arr, tree, start, mid, left_node);
        build_tree(arr, tree, mid+1, end, right_node);
        tree[node_idx] = tree[left_node] + tree[right_node];
    }
}

int query(vector<int>& arr, vector<int>& tree, int start, int end, int l, int r, int node_idx)
{
    //æƒ…å†µä¸€
    if(l > end || r < start) {
        return 0;
    } else if (l <= start && end <= r) { //æƒ…å†µäºŒ
        return tree[node_idx];
    } else {
        //é€’å½’æŸ¥è¯¢
        //æ‰¾åˆ°å·¦å­æ ‘çš„èŠ‚ç‚¹(2*node_idx)
        //æ‰¾åˆ°å³å­æ ‘çš„èŠ‚ç‚¹(2*node_idx+1)
        int left_node = 2*node_idx, right_node = 2*node_idx + 1;
        int mid = (start + end) / 2;
        //å°†æ ‘è¿›è¡Œåˆ†å‰²ï¼Œç„¶åå·¦å³é€’å½’æŸ¥è¯¢
        int left_sum = query(arr, tree, start, mid, l, r, left_node);
        int right_sum = query(arr, tree, mid+1, end, l, r, right_node);
        return left_sum + right_sum;
    }
}

void update(vector<int>& arr, vector<int>& tree, int start, int end, int node_idx, int update_idx, int val)
{
    //é€’å½’çš„å‡ºå£ï¼Œä¹Ÿå°±æ˜¯åˆ°äº†å¶å­èŠ‚ç‚¹, æ›´æ–°å…¶å€¼
    if(start == end) {
        tree[node_idx] = arr[start] = val;
    } else {
        //æ‰¾åˆ°å·¦å­æ ‘çš„èŠ‚ç‚¹(2*node_idx)
        //æ‰¾åˆ°å³å­æ ‘çš„èŠ‚ç‚¹(2*node_idx+1)
        int left_node = 2*node_idx, right_node = 2*node_idx + 1;
        int mid = (start + end) / 2;
        //å¦‚æœè¦æ›´æ–°èŠ‚ç‚¹åœ¨å³è¾¹
        if(update_idx > mid) {
            update(arr, tree, mid+1, end, right_node, update_idx, val);
        } else { //è¦æ›´æ–°èŠ‚ç‚¹åœ¨å·¦è¾¹
            update(arr, tree, start, mid, left_node, update_idx, val);
        }
        //è¦æ³¨æ„æ›´æ–°å½“å‰èŠ‚ç‚¹ï¼ï¼ï¼ï¼ï¼ï¼
        tree[node_idx] = tree[left_node] + tree[right_node];
    }
}
int main()
{
    vector<int> arr = {93, 90, 50, 50, 1};
    int n = arr.size();
    vector<int> tree(4*n);
    build_tree(arr, tree, 0, n-1, 1);
    cout << "æ›´æ–°å‰çš„æ ‘:";
    for (auto& x : tree) cout << x << " ";
    cout << endl;
    
    //æ›´æ–° idx = 4çš„å…ƒç´ å€¼ä¸º 2
    update(arr, tree, 0, n-1, 1, 4, 2);
    cout << "æ›´æ–°åçš„æ ‘:";
    for (auto& x : tree) cout << x << " ";
    cout << endl;
    
    cout << "æŸ¥è¯¢åŒºé—´[2,4]çš„å’Œä¸ºï¼š" << query(arr, tree, 0, n-1, 2, 4, 1) << endl;

    return 0;
}
```
****************
æ—¶é—´å¤æ‚åº¦: $O(nlogC)$
ç©ºé—´å¤æ‚åº¦: $O(nlogC)$
æ­¤é¢˜è§£å‚è€ƒ[åŠ›æ‰£å®˜æ–¹é¢˜è§£](https://leetcode.cn/problems/my-calendar-iii/solution/wo-de-ri-cheng-an-pai-biao-iii-by-leetco-9rif/)ã€‚
æ¨¡æ¿ä¸é‡è¦ï¼Œè¿™ä¸ªæ€ç»´æœ€é‡è¦ã€‚å¦‚æœè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¸®å¿™ç‚¹ä¸ªğŸ‘å§~



