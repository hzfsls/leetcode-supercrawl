## [488.ç¥–ç›æ¸¸æˆ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/zuma-game/solutions/100000/gong-shui-san-xie-yi-ti-shuang-jie-sou-s-3ftb)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)
## æœç´¢ + å‰ªæ

æ•°æ®èŒƒå›´ $1 <= board.length <= 16$ å’Œ $1 <= hand.length <= 5$ã€‚

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨ $a$ å’Œ $b$ æ¥ä»£æŒ‡ $board$ å’Œ $hand$ã€‚

ä½†åœ¨çˆ†æœè¿‡ç¨‹ä¸­åŒæ—¶ç»´æŒä¸¤ä¸ªå­—ç¬¦ä¸²æ„é€ ä¼šè¶…æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨ä¸€ä¸ª `int` æ¥è®°å½• $hand$ çš„ä½¿ç”¨æƒ…å†µã€‚

![image.png](https://pic.leetcode-cn.com/1636436638-kqDwIl-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    int INF = 0x3f3f3f3f;
    String b;
    int m;
    Map<String, Integer> map = new HashMap<>();
    public int findMinStep(String a, String _b) {
        b = _b;
        m = b.length();
        int ans = dfs(a, 1 << m);
        return ans == INF ? -1 : ans;
    }
    int dfs(String a, int cur) {
        if (a.length() == 0) return 0;
        String hashKey = a + "_" + cur;
        if (map.containsKey(hashKey)) return map.get(hashKey);
        int ans = INF;
        int n = a.length();
        for (int i = 0; i < m; i++) {
            if (((cur >> i) & 1) == 1) continue;
            int next = (1 << i) | cur;
            for (int j = 0; j <= n; j++) {
                boolean ok = false;
                if (j > 0 && j < n && a.charAt(j) == a.charAt(j - 1) && a.charAt(j - 1) != b.charAt(i)) ok = true;
                if (j < n && a.charAt(j) == b.charAt(i)) ok = true;
                if (!ok) continue;
                StringBuilder sb = new StringBuilder();
                sb.append(a.substring(0, j)).append(b.substring(i, i + 1));
                if (j != n) sb.append(a.substring(j));
                int k = j;
                while (0 <= k && k < sb.length()) {
                    char c = sb.charAt(k);
                    int l = k, r = k;
                    while (l >= 0 && sb.charAt(l) == c) l--;
                    while (r < sb.length() && sb.charAt(r) == c) r++;
                    if (r - l - 1 >= 3) {
                        sb.delete(l + 1, r);
                        k = l >= 0 ? l : r; 
                    } else {
                        break;
                    }
                }
                ans = Math.min(ans, dfs(sb.toString(), next) + 1);
            }
        }
        map.put(hashKey, ans);
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šç•¥ã€‚ã€Œçˆ†æœã€åŒæ—¶è¿˜å¾—è€ƒè™‘ã€Œå‰ªæã€çš„å¤æ‚åº¦åˆ†ææ„ä¹‰ä¸å¤§ã€‚
* ç©ºé—´å¤æ‚åº¦ï¼šç•¥

---

## AStar ç®—æ³•

æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªç±» `Node` æ¥ä»£æŒ‡å½“å‰æœç´¢å±€é¢ã€‚

```Java []
class Node {
    // å½“å‰çš„æ£‹ç›˜çŠ¶å†µ
    String a;
    // cur ä»£è¡¨å½“å‰ hand çš„ä½¿ç”¨æƒ…å†µï¼ˆè‹¥ cur äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„ç¬¬ k ä½ä¸º 1ï¼Œä»£è¡¨ hand çš„ç¬¬ k ä¸ªå½©çƒå·²è¢«ä½¿ç”¨ï¼‰
    // val ä»£è¡¨ã€Œå½“å‰æ£‹ç›˜ä¸º aã€å’Œã€Œhand ä½¿ç”¨æƒ…å†µä¸º curã€çš„æƒ…å†µä¸‹ï¼Œè‡³å°‘è¿˜éœ€è¦å¤šå°‘æ­¥æ‰èƒ½å°† a å…¨éƒ¨æ¶ˆæ‰ï¼ˆå¯å‘å¼ä¼°ç®—å€¼ï¼‰
    // step ä»£è¡¨å½“å‰å±€é¢æ˜¯ç»è¿‡å¤šå°‘æ­¥è€Œæ¥
    int cur, val, step;
    Node (String _a, int _c, int _v, int _s) {
        a = _a;
        cur = _c; val = _v; step = _s;
    }
}
```

æ˜¾ç„¶ï¼Œç›´æ¥å¯¹æ­¤è¿›è¡Œ `BFS`ï¼Œä¼š TLEã€‚

æˆ‘ä»¬è€ƒè™‘å°†ä¼˜åŒ– `BFS` ä¸­ä½¿ç”¨åˆ°çš„é˜Ÿåˆ—æ”¹ä¸ºä¼˜å…ˆé˜Ÿåˆ—ï¼š**æ›´æ¥è¿‘ç­”æ¡ˆçš„å±€é¢å…ˆå‡ºé˜Ÿè¿›è¡Œå±€é¢å»¶å±•ã€‚**

ç„¶åæˆ‘ä»¬è€ƒè™‘å¦‚ä½•è®¾è®¡ AStar çš„å¯å‘å¼å‡½æ•°ã€‚

**é¦–å…ˆï¼Œä¸€ä¸ªåˆæ ¼çš„ AStar å¯å‘å¼å‡½æ•°åº”å½“èƒ½å¤Ÿç¡®ä¿ã€Œä¼°å€¼ä¸ä¼šå°äºç†è®ºæœ€å°è·ç¦»ã€ã€‚åŒæ—¶ç”±äºå¯å‘å¼çš„ä¼°å€¼å‡½æ•°æ˜¯é’ˆå¯¹äºæœ€ç»ˆçŠ¶æ€è¿›è¡Œä¼°ç®—ï¼Œå› æ­¤åªç¡®ä¿æœ€ç»ˆçŠ¶æ€çš„ç¬¬ä¸€æ¬¡å‡ºé˜Ÿæ—¶ä¸ºæœ€çŸ­è·¯ï¼Œå…¶ä½™ä¸­é—´çŠ¶æ€çš„é¦–æ¬¡å‡ºé˜Ÿä¸ä¸€å®šæ˜¯æœ€çŸ­è·¯ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨å“ˆå¸Œè¡¨æ¥è®°å½•ä¸­é—´çŠ¶æ€çš„è·ç¦»å˜åŒ–ï¼Œå¦‚æœæŸä¸ªå±€é¢çš„æœ€çŸ­è·ç¦»è¢«æ›´æ–°ï¼Œæˆ‘ä»¬åº”å½“å°†å…¶å†æ¬¡å…¥é˜Ÿã€‚**

åŸºäºæ­¤ï¼Œæˆ‘ä»¬è®¾è®¡å¦‚ä¸‹çš„ AStar çš„å¯å‘å¼å‡½æ•°ï¼šä½¿ç”¨å“ˆå¸Œè¡¨æ¥ç»Ÿè®¡ã€Œå½“å‰çš„æ£‹ç›˜ $a$ çš„å½©çƒæ•°é‡ã€&ã€Œå½“å‰æ‰‹ä¸Šæ‹¥æœ‰çš„å½©çƒæ•°é‡ã€ï¼Œå¯¹ã€Œæ— è§£æƒ…å†µã€å’Œã€Œç†è®ºæœ€å°æ¬¡æ•°ã€è¿›è¡Œåˆ†æï¼š
 
 * å¯¹äºæŸä¸ªå½©çƒ $c$ è€Œè¨€ï¼Œå¦‚æœå½“å‰æ£‹ç›˜çš„æ•°é‡ + æ‰‹ä¸Šçš„æ•°é‡ éƒ½ä¸è¶³ $3$ ä¸ªï¼Œé‚£ä¹ˆè¯¥å±€é¢å¾€ä¸‹æœç´¢ä¹Ÿå¿…ç„¶æ— è§£ï¼Œè¯¥å±€é¢æ— é¡»å…¥é˜Ÿï¼›
 * å¯¹äºæŸä¸ªå½©çƒ $c$ è€Œè¨€ï¼Œå¦‚æœå½“å‰æ£‹ç›˜æ•°é‡å°‘äº $3$ ä¸ªï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦è¡¥å……è‡³ $3$ ä¸ªæ‰èƒ½è¢«æ¶ˆé™¤ï¼Œè€Œç¼ºå°‘çš„ä¸ªæ•°åˆ™æ˜¯ã€Œä»æ‰‹ä¸Šå½©çƒæ”¾å…¥æ£‹ç›˜å†…ã€çš„æ¬¡æ•°ï¼Œå³å¯¹äºå½©çƒ $c$ï¼Œæˆ‘ä»¬ç†è®ºä¸Šè‡³å°‘éœ€è¦æ¶ˆè€— $3 - cnt$ æ¬¡ï¼ˆ$cnt$ ä¸ºå½“å‰æ£‹ç›˜æ‹¥æœ‰çš„å½©çƒ $c$ çš„æ•°é‡ï¼‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¯¹äºæŸä¸ªå±€é¢ $node$ è€Œè¨€ï¼Œæœ€ç»ˆçš„è·ç¦»æ˜¯ç”±ã€Œå·²ç¡®å®šè·ç¦»ã€+ã€Œä¼°å€¼è·ç¦»ã€ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæˆ‘ä»¬åº”å½“æ ¹æ®è¿™ä¸¤éƒ¨åˆ†ä¹‹å’Œè¿›è¡Œå‡ºé˜Ÿï¼Œæ‰èƒ½ç¡®ä¿ç®—æ³•çš„æ­£ç¡®æ€§ã€‚

![image.png](https://pic.leetcode-cn.com/1636436200-gPQhnD-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    class Node {
        String a;
        int cur, val, step;
        Node (String _a, int _c, int _v, int _s) {
            a = _a;
            cur = _c; val = _v; step = _s;
        }
    }
    int f(String a, int k) {
        Map<Character, Integer> m1 = new HashMap<>(), m2 =  new HashMap<>();
        for (int i = 0; i < a.length(); i++) {
            m1.put(a.charAt(i), m1.getOrDefault(a.charAt(i), 0) + 1);
        }
        for (int i = 0; i < m; i++) {
            if (((k >> i) & 1) == 0) m2.put(b.charAt(i), m2.getOrDefault(b.charAt(i), 0) + 1);
        }
        int ans = 0;
        for (char c : m1.keySet()) {
            int c1 = m1.get(c), c2 = m2.getOrDefault(c, 0);
            if (c1 + c2 < 3) return INF;
            if (c1 < 3) ans += (3 - c1);
        }
        return ans;
    }

    int INF = 0x3f3f3f3f;
    String b;
    int m;
    Map<String, Integer> map = new HashMap<>();
    public int findMinStep(String _a, String _b) {
        b = _b;
        m = b.length();
        PriorityQueue<Node> q = new PriorityQueue<>((o1,o2)->(o1.val+o1.step)-(o2.val+o2.step));
        q.add(new Node(_a, 1 << m, f(_a, 1 << m), 0));
        map.put(_a + "_" + (1 << m), 0);
        while (!q.isEmpty()) {
            Node poll = q.poll();
            String a = poll.a;
            int cur = poll.cur;
            int step = poll.step;
            int n = a.length();
            for (int i = 0; i < m; i++) {
                if (((cur >> i) & 1) == 1) continue;
                int next = (1 << i) | cur;
                for (int j = 0; j <= n; j++) {
                    boolean ok = false;
                    if (j > 0 && j < n && a.charAt(j) == a.charAt(j - 1) && a.charAt(j - 1) != b.charAt(i)) ok = true;
                    if (j < n && a.charAt(j) == b.charAt(i)) ok = true;
                    if (!ok) continue;
                    StringBuilder sb = new StringBuilder();
                    sb.append(a.substring(0, j)).append(b.substring(i, i + 1));
                    if (j != n) sb.append(a.substring(j));
                    int k = j;
                    while (0 <= k && k < sb.length()) {
                        char c = sb.charAt(k);
                        int l = k, r = k;
                        while (l >= 0 && sb.charAt(l) == c) l--;
                        while (r < sb.length() && sb.charAt(r) == c) r++;
                        if (r - l - 1 >= 3) {
                            sb.delete(l + 1, r);
                            k = l >= 0 ? l : r; 
                        } else {
                            break;
                        }
                    }
                    String nextStr = sb.toString();
                    if (nextStr.length() == 0) return step + 1;
                    if (f(nextStr, next) == INF) continue;
                    String hashKey = nextStr + "_" + next;
                    if (!map.containsKey(hashKey) || map.get(hashKey) > step + 1) {
                        map.put(hashKey, step + 1);
                        q.add(new Node(nextStr, next, f(nextStr, next), step + 1));
                    }
                }
            }
        }
        return -1;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šç•¥ã€‚ã€Œçˆ†æœã€åŒæ—¶è¿˜å¾—è€ƒè™‘ã€Œå¯å‘å¼åŠ é€Ÿã€çš„å¤æ‚åº¦åˆ†ææ„ä¹‰ä¸å¤§ã€‚
* ç©ºé—´å¤æ‚åº¦ï¼šç•¥

---

## å…¶ä»–ã€Œå¯å‘å¼æœç´¢ã€å†…å®¹

| é¢˜ç›®                                                         | é¢˜è§£                                                         | éš¾åº¦ | æ¨èæŒ‡æ•° |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- | -------- |
| [127. å•è¯æ¥é¾™](https://leetcode-cn.com/problems/word-ladder/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/word-ladder/solution/gong-shui-san-xie-ru-he-shi-yong-shuang-magjd/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [752. æ‰“å¼€è½¬ç›˜é”](https://leetcode-cn.com/problems/open-the-lock/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/open-the-lock/solution/gong-shui-san-xie-yi-ti-shuang-jie-shuan-wyr9/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [773. æ»‘åŠ¨è°œé¢˜](https://leetcode-cn.com/problems/sliding-puzzle/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/sliding-puzzle/solution/gong-shui-san-xie-fa-hui-a-suan-fa-zui-d-3go8/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [847. è®¿é—®æ‰€æœ‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„](https://leetcode-cn.com/problems/shortest-path-visiting-all-nodes/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/shortest-path-visiting-all-nodes/solution/gong-shui-san-xie-yi-ti-shuang-jie-bfs-z-6p2k/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [1239. ä¸²è”å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦](https://leetcode-cn.com/problems/maximum-length-of-a-concatenated-string-with-unique-characters/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/maximum-length-of-a-concatenated-string-with-unique-characters/solution/gong-shui-san-xie-yi-ti-san-jie-jian-zhi-nfeb/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [1723. å®Œæˆæ‰€æœ‰å·¥ä½œçš„æœ€çŸ­æ—¶é—´](https://leetcode-cn.com/problems/find-minimum-time-to-finish-all-jobs/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/find-minimum-time-to-finish-all-jobs/solution/gong-shui-san-xie-yi-ti-shuang-jie-jian-4epdd/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |


**æ³¨ï¼šä»¥ä¸Šç›®å½•æ•´ç†æ¥è‡ª [wiki](https://github.com/SharingSource/LogicStack-LeetCode/wiki/å¯å‘å¼æœç´¢)ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½å¼•ç”¨è¯·ä¿ç•™å‡ºå¤„ã€‚**


---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 