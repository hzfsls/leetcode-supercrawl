## [1001.ç½‘æ ¼ç…§æ˜ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/grid-illumination/solutions/100000/gong-shui-san-xie-ha-xi-biao-xian-ying-s-s48d)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)

## å“ˆå¸Œè¡¨ + çº¿æ˜ å°„

æ£‹ç›˜å¤§å°çš„æ•°æ®èŒƒå›´ä¸º $n = 10^9$ï¼Œç¡¬æ¨¡æ‹Ÿã€Œäº®ç¯ã€çš„æ“ä½œå¿…ç„¶ä¼š `TLE`ï¼Œè€Œ `lamps` å’Œ `queries` æ•°æ®èŒƒå›´ä¸º $20000$ æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¸¸è§çš„çªç ´å£ã€‚

ç”±äºç‚¹äº®æ¯ä¸€ç›ç¯ï¼Œå¯ä»¥ä½¿å¾—å½“å‰ **è¡Œã€åˆ— å’Œ å¯¹è§’çº¿** çš„ä½ç½®è¢«ç…§äº®ï¼Œè¡Œåˆ—å¯ç›´æ¥ä½¿ç”¨æ£‹ç›˜åæ ‡çš„ $(x, y)$ æ¥ä»£æŒ‡ï¼Œè€Œå¯¹è§’çº¿åˆ™å¯ä»¥ä½¿ç”¨ã€Œæˆªè·ã€æ¥è¿›è¡Œä»£æŒ‡ï¼Œå³ä½¿ç”¨ $x + y$ å’Œ $x - y$ è¿›è¡Œä»£æŒ‡ã€‚

åˆ†åˆ«ä½¿ç”¨å››ä¸ªã€Œå“ˆå¸Œè¡¨ã€`row`ã€`col`ã€`left` å’Œ `right` æ¥è®°å½• **è¡Œã€åˆ— å’Œ å¯¹è§’çº¿** çš„ç‚¹äº®æƒ…å†µï¼ˆ`key` ä¸ºçº¿ç¼–å·ï¼Œ`value` ä¸ºç‚¹äº®æ¬¡æ•°ï¼‰ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ $O(1)$ çš„å¤æ‚åº¦å¤„ç†æ‰æ‰€æœ‰çš„ $lamps[i]$ï¼ŒæŸä¸ªä½ç½®è¢«ç…§äº®çš„å……è¦æ¡ä»¶ä¸ºï¼š**ã€Œå½“å‰ä½ç½®æ‰€åœ¨è¡Œè¢«ç‚¹äº®ã€æˆ–ã€Œå½“å‰ä½ç½®æ‰€åœ¨åˆ—è¢«ç‚¹äº®ã€æˆ–ã€Œå½“å‰ä½ç½®æ‰€å¤„çš„å¯¹è§’çº¿è¢«ç‚¹äº®ã€ã€‚**

åŒæ—¶ï¼Œç”±äºæ¯æ¬¡æŸ¥è¯¢åè¦è¿›è¡Œã€Œç­ç¯ã€æ“ä½œï¼ˆæ³¨æ„ï¼šç­ç¯åªèƒ½ç­æœ‰ç¯çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ç­æœ‰å…‰çš„ä½ç½® ğŸ¤£ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å¦å¤–è®°å½•æ¯ä¸ªç¯çš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨åˆ©ç”¨ã€ŒäºŒç»´è½¬ä¸€ç»´ã€çš„æŠ€å·§è¿›è¡Œç¼–å·ï¼š$idx = x * n + y$ï¼Œå¹¶ä½¿ç”¨ `HashSet` è¿›è¡Œè®°å½•ï¼ˆå¿½ç•¥é‡å¤çš„ $lamps[i]$ï¼‰ã€‚

ç”±äºè¯¢é—®æ¬¡æ•°æœ€å¤šä¸º $20000$ï¼Œå› æ­¤ç›´æ¥åœ¨æŸ¥è¯¢å®Œæˆåæ¨¡æ‹Ÿã€Œç­ç¯ã€å³å¯ï¼ˆè®¿é—®è‡ªèº«åŠç›¸é‚»æ ¼å­ï¼Œå…± $9$ ä¸ªï¼‰ï¼Œè®¡ç®—é‡ä¸º $2 * 10^5$ ä»¥å†…ï¼Œå¯ä»¥æ¥å—ã€‚è‹¥æŸä¸ªä½ç½®å­˜åœ¨ç¯ï¼Œå°†å…¶ä» `HashSet` ä¸­ç§»é™¤ï¼Œå¹¶æ›´æ–°å¯¹åº”çº¿çš„ç‚¹äº®æƒ…å†µã€‚

ä»£ç ï¼š
```Java []
class Solution {
    int[][] dirs = new int[][]{{0,0},{0,-1},{0,1},{-1,0},{-1,-1},{-1,1},{1,0},{1,-1},{1,1}};
    public int[] gridIllumination(int n, int[][] lamps, int[][] queries) {
        long N = n;
        Map<Integer, Integer> row = new HashMap<>(), col = new HashMap<>();
        Map<Integer, Integer> left = new HashMap<>(), right = new HashMap<>();
        Set<Long> set = new HashSet<>();
        for (int[] l : lamps) {
            int x = l[0], y = l[1];
            int a = x + y, b = x - y;
            if (set.contains(x * N + y)) continue;
            increment(row, x); increment(col, y);
            increment(left, a); increment(right, b);
            set.add(x * N + y);
        }
        int m = queries.length;
        int[] ans = new int[m];
        for (int i = 0; i < m; i++) {
            int[] q = queries[i];
            int x = q[0], y = q[1];
            int a = x + y, b = x - y;
            if (row.containsKey(x) || col.containsKey(y) || left.containsKey(a) || right.containsKey(b)) ans[i] = 1;

            for (int[] d : dirs) {
                int nx = x + d[0], ny = y + d[1];
                int na = nx + ny, nb = nx - ny;
                if (nx < 0 || nx >= n || ny < 0 || ny >= n) continue;
                if (set.contains(nx * N + ny)) {
                    set.remove(nx * N + ny);
                    decrement(row, nx); decrement(col, ny);
                    decrement(left, na); decrement(right, nb);
                }
            }
        }
        return ans;
    }
    void increment(Map<Integer, Integer> map, int key) {
        map.put(key, map.getOrDefault(key, 0) + 1);
    }
    void decrement(Map<Integer, Integer> map, int key) {
        if (map.get(key) == 1) map.remove(key);
        else map.put(key, map.get(key) - 1);
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $lamps$ é•¿åº¦ä¸º $a$ï¼Œ$queries$ é•¿åº¦ä¸º $b$ï¼Œå¤„ç†æ‰€æœ‰çš„ $lamp[i]$ å¤æ‚åº¦ä¸º $O(a)$ï¼Œå¤„ç†æ‰€æœ‰çš„ $queries[j]$ å¤æ‚åº¦ä¸º $O(C * b)$ï¼Œå…¶ä¸­ $C$ ä¸ºæ¨¡æ‹Ÿç­ç¯æ—¶æ‰€è”é€šçš„æ ¼å­æ•°é‡ï¼Œå›ºå®šä¸º $9$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(a + C * b)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(a)$


---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~