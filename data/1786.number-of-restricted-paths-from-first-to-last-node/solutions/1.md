## [1786.ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å—é™è·¯å¾„æ•° ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/number-of-restricted-paths-from-first-to-last-node/solutions/100000/xiang-jie-dui-you-hua-dijkstra-dong-tai-i6j0d)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)
## å †ä¼˜åŒ– Dijkstra + åŠ¨æ€è§„åˆ’

ä¸ºäº†æ–¹ä¾¿ï¼Œä»¤ `n` ä¸ºç‚¹çš„æ•°é‡ï¼Œ`m` ä¸ºè¾¹çš„æ•°é‡ï¼ŒåŒæ—¶å°†ç¬¬ $n$ ä¸ªç‚¹ç§°ä¸ºã€Œèµ·ç‚¹ã€ï¼Œç¬¬ $1$ ä¸ªç‚¹ç§°ä¸ºã€Œç»“å°¾ã€ã€‚

æŒ‰ç…§é¢˜æ„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ±‚æ¯ä¸ªç‚¹åˆ°ç»“å°¾çš„ã€Œæœ€çŸ­è·¯ã€ï¼Œæ±‚æœ€çŸ­è·¯çš„ç®—æ³•æœ‰å¾ˆå¤šï¼Œé€šå¸¸æ ¹æ®ã€Œæœ‰æ— è´Ÿæƒè¾¹ã€& ã€Œç¨ å¯†å›¾è¿˜æ˜¯ç¨€ç–å›¾ã€è¿›è¡Œé€‰æ‹©ã€‚

è¯¥é¢˜åªæœ‰æ­£æƒå˜ï¼Œè€Œä¸”â€œè¾¹â€å’Œâ€œç‚¹â€çš„æ•°é‡åœ¨ä¸€ä¸ªæ•°é‡çº§ä¸Šï¼Œå±äºç¨€ç–å›¾ã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ã€Œæœ€çŸ­è·¯ã€ç®—æ³•ï¼šå †ä¼˜åŒ–çš„ Dijkstraï¼Œå¤æ‚åº¦ä¸º $O(m\log{n})$ã€‚

> PS. ä¹ æƒ¯ä¸Šä¼šä¼˜å…ˆé€‰æ‹© SPFAï¼ŒSPFA é€šå¸¸æƒ…å†µä¸‹å¤æ‚åº¦ä¸º $O(m)$ï¼Œä½†æœ€åæƒ…å†µä¸‹å¤æ‚åº¦ä¸º $O(n \times m)$ã€‚ä»æ•°æ®ä¸Šæ¥è¯´ SPFA ä¹Ÿä¼šè¶…ï¼Œè€Œä¸”æœ¬é¢˜è¿˜ç»“åˆäº† DPï¼Œå› æ­¤å¯èƒ½ä¼šå¡æ‰å›¾è®ºéƒ¨åˆ†çš„ SPFAã€‚å‡ºäºè¿™äº›è€ƒè™‘ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨å †ä¼˜åŒ– Dijkstra

å½“æˆ‘ä»¬æ±‚å¾—äº†æ¯ä¸ªç‚¹åˆ°ç»“å°¾çš„ã€Œæœ€çŸ­è·¯ã€ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ±‚å¾—ä»ã€Œèµ·ç‚¹ã€åˆ°ã€Œç»“å°¾ã€çš„**å—é™è·¯å¾„æ•°é‡**ã€‚

è¿™æ˜¾ç„¶å¯ä»¥ç”¨ DP æ¥åšã€‚

æˆ‘ä»¬å®šä¹‰ $f[i]$ ä¸ºä»ç¬¬ $i$ ä¸ªç‚¹åˆ°ç¬¬ $n$ ä¸ªç‚¹çš„å—é™è·¯å¾„æ•°é‡ï¼Œ$f[1]$ å°±æ˜¯æˆ‘ä»¬çš„ç­”æ¡ˆï¼Œè€Œ $f[n] = 1$ æ˜¯ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„èµ·å§‹æ¡ä»¶ã€‚

å› ä¸ºé¢˜ç›®çš„**å—é™è·¯å¾„æ•°**çš„å®šä¹‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾çš„è·¯å¾„æ‰€åŒ…å«çš„ç‚¹ï¼Œå¿…é¡»æ˜¯å…¶è·ç¦»ç»“å°¾çš„æœ€çŸ­è·¯è¶Šæ¥è¶Šè¿‘çš„ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œå¯¹äºç¤ºä¾‹ 1ï¼Œå…¶ä¸­ä¸€æ¡ç¬¦åˆè¦æ±‚çš„è·¯å¾„ä¸º 1 --> 2 --> 3 --> 5ã€‚

è¿™æ¡è·¯å¾„çš„æœç´¢è¿‡ç¨‹å¯ä»¥çœ‹åšï¼Œä»ç»“å°¾ï¼ˆç¬¬ $5$ ä¸ªç‚¹ï¼‰å‡ºå‘ï¼Œé€†ç€èµ°ï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªç‚¹ï¼ˆä¾‹å¦‚ `a`ï¼‰ä¹‹åï¼Œå†é€‰æ‹©ä¸‹ä¸€ä¸ªç‚¹ï¼ˆä¾‹å¦‚ `b`ï¼‰æ—¶å°±å¿…é¡»**æ»¡è¶³æœ€çŸ­è·¯è·ç¦»æ¯”ä¸Šä¸€ä¸ªç‚¹ï¼ˆç‚¹ `a`ï¼‰è¦è¿œ**ï¼Œå¦‚æœæœ€ç»ˆèƒ½é€‰åˆ°èµ·ç‚¹ï¼ˆç¬¬ä¸€ä¸ªç‚¹ï¼‰ï¼Œè¯´æ˜ç»Ÿè®¡å‡ºä¸€æ¡æœ‰æ•ˆè·¯å¾„ã€‚

æˆ‘ä»¬çš„æœç´¢æ–¹å¼å†³å®šäº†éœ€è¦å…ˆæŒ‰ç…§æœ€çŸ­è·¯è·ç¦»è¿›è¡Œä»å°åˆ°å¤§æ’åºã€‚

**ä¸å¤±ä¸€èˆ¬æ€§ï¼Œå½“æˆ‘ä»¬è¦æ±‚ $f[i]$ çš„æ—¶å€™ï¼Œå…¶å®æ‰¾çš„æ‰€æœ‰æ»¡è¶³ã€Œä¸ç‚¹ $i$ ç›¸è¿ï¼Œä¸”æœ€çŸ­è·¯æ¯”ç‚¹ $i$ è¦å°çš„ç‚¹ $j$ã€ï¼Œç¬¦åˆæ¡ä»¶çš„ç‚¹ $j$ æœ‰å¾ˆå¤šä¸ªï¼Œå°†æ‰€æœ‰çš„ $f[j]$ ç´¯åŠ å³æ˜¯ $f[i]$ã€‚**

ä»£ç ï¼š
```Java []
class Solution {
    int mod = 1000000007;
    public int countRestrictedPaths(int n, int[][] es) {
        // é¢„å¤„ç†æ‰€æœ‰çš„è¾¹æƒã€‚ a b w -> a : { b : w } + b : { a : w }
        Map<Integer, Map<Integer, Integer>> map = new HashMap<>(); 
        for (int[] e : es) {
            int a = e[0], b = e[1], w = e[2];
            Map<Integer, Integer> am = map.getOrDefault(a, new HashMap<Integer, Integer>());
            am.put(b, w);
            map.put(a, am);
            Map<Integer, Integer> bm = map.getOrDefault(b, new HashMap<Integer, Integer>());
            bm.put(a, w);
            map.put(b, bm);
        }

        // å †ä¼˜åŒ– Dijkstraï¼šæ±‚ æ¯ä¸ªç‚¹ åˆ° ç¬¬nä¸ªç‚¹ çš„æœ€çŸ­è·¯
        int[] dist = new int[n + 1];
        boolean[] st = new boolean[n + 1];
        Arrays.fill(dist, Integer.MAX_VALUE);
        dist[n] = 0;
        Queue<int[]> q = new PriorityQueue<int[]>((a, b)->a[1]-b[1]); // ç‚¹ç¼–å·ï¼Œç‚¹è·ç¦»ã€‚æ ¹æ®ç‚¹è·ç¦»ä»å°åˆ°å¤§
        q.add(new int[]{n, 0});
        while (!q.isEmpty()) {
            int[] e = q.poll();
            int idx = e[0], cur = e[1];
            if (st[idx]) continue;
            st[idx] = true;
            Map<Integer, Integer> mm = map.get(idx);
            if (mm == null) continue;
            for (int i : mm.keySet()) {
                dist[i] = Math.min(dist[i], dist[idx] + mm.get(i));
                q.add(new int[]{i, dist[i]});
            }
        }

        // dp è¿‡ç¨‹
        int[][] arr = new int[n][2];
        for (int i = 0; i < n; i++) arr[i] = new int[]{i + 1, dist[i + 1]}; // ç‚¹ç¼–å·ï¼Œç‚¹è·ç¦»
        Arrays.sort(arr, (a, b)->a[1]-b[1]); // æ ¹æ®ç‚¹è·ç¦»ä»å°åˆ°å¤§æ’åº

        // å®šä¹‰ f(i) ä¸ºä»ç¬¬ i ä¸ªç‚¹åˆ°ç»“å°¾çš„å—é™è·¯å¾„æ•°é‡
        // ä» f[n] é€’æ¨åˆ° f[1]
        int[] f = new int[n + 1]; 
        f[n] = 1;
        for (int i = 0; i < n; i++) {
            int idx = arr[i][0], cur = arr[i][1];
            Map<Integer, Integer> mm = map.get(idx);
            if (mm == null) continue;
            for (int next : mm.keySet()) {
                if (cur > dist[next]) {
                    f[idx] += f[next];
                    f[idx] %= mod;
                }
            }
            // ç¬¬ 1 ä¸ªèŠ‚ç‚¹ä¸ä¸€å®šæ˜¯è·ç¦»ç¬¬ n ä¸ªèŠ‚ç‚¹æœ€è¿œçš„ç‚¹ï¼Œä½†æˆ‘ä»¬åªéœ€è¦ f[1]ï¼Œå¯ä»¥ç›´æ¥è·³å‡ºå¾ªç¯
            if (idx == 1) break;
        }
        return f[1];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šæ±‚æœ€çŸ­è·¯çš„å¤æ‚åº¦ä¸º $O(m\log{n})$ï¼ŒDP è¿‡ç¨‹åæƒ…å†µä¸‹è¦æ‰«å®Œæ‰€æœ‰çš„è¾¹ï¼Œå¤æ‚åº¦ä¸º $O(m)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(m\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n + m)$

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 