## [432.å…¨ O(1) çš„æ•°æ®ç»“æ„ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/all-oone-data-structure/solutions/100000/by-ac_oier-t26d)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)
## åŒå‘é“¾è¡¨ + å“ˆå¸Œè¡¨

é¢˜ç›®è¦æ±‚æˆ‘ä»¬æ”¯æŒ $O(1)$ çš„æŸ¥è¯¢å’Œä¿®æ”¹ï¼Œå…¶ä¸­æŸ¥è¯¢åªéœ€è¿”å›ä»»æ„ä¸€ä¸ªè®¡æ•°æ¬¡æ•°ã€Œæœ€å¤šã€å’Œã€Œæœ€å°‘ã€çš„å…ƒç´ å³å¯ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

è™½ç„¶æ’å…¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸è¶…è¿‡ $10$ï¼ˆè¯¥æ•°æ®èŒƒå›´çš„å«ä¹‰ä¸ºå­—ç¬¦ä¸²çš„å“ˆå¸Œè®¡ç®—æ¶ˆè€—å¯çœ‹ä½œå¸¸æ•°ï¼‰ï¼Œä½†å•çº¯çš„ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ã€ä»…èƒ½åšåˆ° $O(1)$ çš„è®¡æ•°ï¼Œæ— æ³•åšåˆ° $O(1)$ æŸ¥è¯¢ã€‚

**æˆ‘ä»¬å¯ä»¥é‡‡å–å’Œ [LFUCache](https%3A//mp.weixin.qq.com/s?__biz%3DMzU4NDE3MTEyMA%3D%3D%26mid%3D2247486856%26idx%3D1%26sn%3D59b2ed57e4a75eac0e63fc0cf08bed5d) ç±»ä¼¼çš„æ€è·¯ï¼Œé€šè¿‡è‡ªå®šä¹‰èŠ‚ç‚¹å¹¶æ‰‹å†™åŒé“¾è¡¨æ¥å®ç°ï¼Œè¿˜æ²¡ã€Œæ‰‹å†™åŒå‘é“¾è¡¨ã€çš„åŒå­¦å¯ä»¥çœ‹å‰ç½® ğŸ§€ ï¼š[å®ç°ä¸€ä¸ª LRUCacheï¼ˆæ‰‹å†™åŒå‘é“¾è¡¨å…¥é—¨é¢˜ï¼‰](https%3A//mp.weixin.qq.com/s?__biz%3DMzU4NDE3MTEyMA%3D%3D%26mid%3D2247490403%26idx%3D1%26sn%3Ddd361a87d74eec4ca9ef97efe016c906) ã€‚**

å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹ç±» `Node`ï¼Œé™¤äº†åŒ…å«ç”¨äºå®ç°åŒå‘é“¾è¡¨çš„ `left` å’Œ `right` ä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸€ä¸ªæ•°å€¼ç±»å‹çš„å˜é‡ `cnt`ï¼Œ ç”¨äºè®°å½•è¯¥èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è®¡æ•°æ¬¡æ•°ä¸ºå¤šå°‘çš„å…ƒç´ ï¼Œä»¥åŠä¸€ä¸ª `Set` ç±»å‹çš„å®¹å™¨ï¼Œç”¨äºæ”¯æŒ $O(1)$ æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œè®°ä½œ `set`ã€‚

åŒæ—¶ä¸ºäº†å¿«é€ŸçŸ¥é“æŸä¸ªå­—ç¬¦ä¸²å±äºå“ªä¸ª `Node`ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼€ä¸€ä¸ªã€Œå“ˆå¸Œè¡¨ã€è¿›è¡Œå®šä½ï¼ˆä»¥å­—ç¬¦ä¸²ä¸ºå“ˆå¸Œè¡¨çš„é”®ï¼Œå­—ç¬¦ä¸²æ‰€åœ¨ `Node` ä½œä¸ºå€¼ï¼‰ï¼Œå½“å®šä½åˆ°å­—ç¬¦ä¸²å¯¹åº”çš„ `Node` ä¹‹ååˆ™å¯ä»¥åˆ©ç”¨åŒå‘é“¾è¡¨çš„ $O(1)$ å¢åŠ /ä¿®æ”¹/åˆ é™¤ã€‚

åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œèµ·å§‹åªæœ‰ä¸¤ä¸ªå“¨å…µèŠ‚ç‚¹ `hh` å’Œ `tt` ï¼Œå½“è¿›è¡Œè‹¥å¹² `inc/dec` æ“ä½œåçš„åŸºæœ¬å½¢æ€ä¸ºï¼š

![image.png](https://pic.leetcode-cn.com/1647386842-kYgoaN-image.png)

å¯¹åº”å‡ ä¸ªæ“ä½œï¼š

`inc/dec` æ“ä½œï¼šå½“å¯¹ä¸€ä¸ªå­—ç¬¦ä¸² `key` è¿›è¡Œã€Œå¢åŠ è®¡æ•°ã€æˆ–ã€Œå‡å°‘è®¡æ•°ã€æ—¶ï¼Œå…ˆåœ¨å“ˆå¸Œè¡¨ä¸­çœ‹ `key` æ˜¯å¦å­˜åœ¨ï¼š

* è‹¥å­˜åœ¨ï¼šæ ¹æ®å…¶æ‰€å±çš„ `Node` çš„è®¡æ•° `cnt` ä¸ºå¤šå°‘ï¼Œå¹¶ç»“åˆå½“å‰æ˜¯ã€Œå¢åŠ è®¡æ•°ã€è¿˜æ˜¯ã€Œå‡å°‘è®¡æ•°ã€æ¥å†³å®šæ˜¯æ‰¾ `Node` çš„ã€Œå³èŠ‚ç‚¹ã€è¿˜æ˜¯ã€Œå·¦èŠ‚ç‚¹ã€ï¼ŒåŒæ—¶æ£€æŸ¥ç›¸é‚»èŠ‚ç‚¹çš„è®¡æ•°å€¼ `cnt` æ˜¯å¦ä¸ºç›®æ ‡å€¼ï¼Œå¯¹åº”è¦æ£€æŸ¥æ•°å€¼æ˜¯ $cnt + 1$ å’Œ $cnt - 1$ï¼š
  * è‹¥ç›¸é‚»èŠ‚ç‚¹çš„ `cnt` ä¸ºç›®æ ‡å€¼ï¼šå³ç›®æ ‡èŠ‚ç‚¹å­˜åœ¨ï¼Œå°† `key` ä»åŸ `Node` çš„ `set` é›†åˆä¸­ç§»é™¤ï¼Œå¹¶æ·»åŠ åˆ°ç›®æ ‡èŠ‚ç‚¹çš„é›†åˆä¸­ï¼Œæ›´æ–°å“ˆå¸Œè¡¨ï¼›
  * è‹¥ç›¸é‚»èŠ‚ç‚¹çš„ `cnt` ä¸æ˜¯ç›®æ ‡å€¼ï¼šåˆ™éœ€è¦åˆ›å»ºç›¸åº”çš„ç›®æ ‡èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºåŒå‘é“¾è¡¨å…³ç³»ï¼ŒæŠŠ `key` å­˜å…¥æ–°åˆ›å»ºçš„ç›®æ ‡èŠ‚ç‚¹ï¼Œæ›´æ–°å“ˆå¸Œè¡¨ã€‚
* è‹¥ä¸å­˜åœ¨ï¼ˆåªèƒ½æ˜¯ `inc` æ“ä½œï¼‰ï¼šæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ $cnt = 1$ çš„èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯æ£€æŸ¥ `hh.right` èŠ‚ç‚¹çš„è®¡æ•°å€¼ï¼‰ï¼š
  * å¦‚æœå­˜åœ¨ $cnt = 1$ çš„ç›®æ ‡èŠ‚ç‚¹ï¼šå°† `key` æ·»åŠ åˆ°ç›®æ ‡èŠ‚ç‚¹çš„ `set` é›†åˆä¸­ï¼Œæ›´æ–°å“ˆå¸Œè¡¨ï¼›
  * è‹¥ä¸å­˜åœ¨ $cnt = 1$ çš„ç›®æ ‡èŠ‚ç‚¹ï¼šåˆ›å»ºç›¸åº”çš„èŠ‚ç‚¹ï¼Œå¹¶æ„å»ºåŒå‘å…³ç³»ï¼Œå¹¶æ„å»ºåŒå‘é“¾è¡¨å…³ç³»ï¼ŒæŠŠ `key` å­˜å…¥æ–°åˆ›å»ºçš„ç›®æ ‡èŠ‚ç‚¹ï¼Œæ›´æ–°å“ˆå¸Œè¡¨ã€‚

`getMaxKey/getMinKey` æ“ä½œï¼šåˆ†åˆ«ä» `tt.left` å’Œ `hh.right` ä¸­å°è¯•æŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨éå“¨å…µèŠ‚ç‚¹ï¼Œåˆ™ä»èŠ‚ç‚¹çš„ `set` é›†åˆä¸­å–ä»»æ„å…ƒç´ è¿›è¡Œè¿”å›ï¼Œå¦åˆ™è¿”å›ç©ºä¸²ã€‚

æœ€åï¼Œä¸ºäº†ç¡®ä¿ `getMaxKey/getMinKey` æ“ä½œèƒ½å¤Ÿä¸¥æ ¼ $O(1)$ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œ `inc/dec` æ“ä½œæ—¶æˆ‘ä»¬éœ€è¦å¯¹ä¸€äº› `set` å®¹é‡ä¸º $0$ çš„èŠ‚ç‚¹è¿›è¡Œé‡Šæ”¾ï¼Œå³è§£é™¤å…¶æ‰€åœ¨åŒå‘é“¾è¡¨çš„å…³ç³»ã€‚

**ä»£ç ï¼ˆæ„Ÿè°¢ [@5cm/s ğŸŒ¸](/u/megurine/) åŒå­¦æä¾›çš„å…¶ä»–è¯­è¨€ä»£ç ï¼‰ï¼š**
```Java []
class AllOne {
    class Node {
        int cnt;
        Set<String> set = new HashSet<>();
        Node left, right;
        Node(int _cnt) {
            cnt = _cnt;
        }
    }
    
    Node hh, tt;
    Map<String, Node> map = new HashMap<>();
    public AllOne() {
        hh = new Node(-1000); tt = new Node(-1000);
        hh.right = tt; tt.left = hh;
    }

    void clear(Node node) {
        if (node.set.size() == 0) {
            node.left.right = node.right;
            node.right.left = node.left;
        }
    }
    
    public void inc(String key) {
        if (map.containsKey(key)) {
            Node node = map.get(key);
            node.set.remove(key);
            int cnt = node.cnt;
            Node next = null;
            if (node.right.cnt == cnt + 1) {
                next = node.right;
            } else {
                next = new Node(cnt + 1);
                next.right = node.right;
                next.left = node;
                node.right.left = next;
                node.right = next;
            }
            next.set.add(key);
            map.put(key, next);
            clear(node);
        } else {
            Node node = null;
            if (hh.right.cnt == 1) {
                node = hh.right;
            } else {
                node = new Node(1);
                node.right = hh.right;
                node.left = hh;
                hh.right.left = node;
                hh.right = node;
            }
            node.set.add(key);
            map.put(key, node);
        }
    }
    
    public void dec(String key) {
        Node node = map.get(key);
        node.set.remove(key);
        int cnt = node.cnt;
        if (cnt == 1) {
            map.remove(key);
        } else {
            Node prev = null;
            if (node.left.cnt == cnt - 1) {
                prev = node.left;
            } else {
                prev = new Node(cnt - 1);
                prev.right = node;
                prev.left = node.left;
                node.left.right = prev;
                node.left = prev;
            }
            prev.set.add(key);
            map.put(key, prev);
        }
        clear(node);
    }
    
    public String getMaxKey() {
        Node node = tt.left;
        for (String str : node.set) return str;
        return "";
    }
    
    public String getMinKey() {
        Node node = hh.right;
        for (String str : node.set) return str;
        return "";
    }
}
```
```C++ []
struct Node {
    string s;
    int v;
    Node *pre, *nxt;
    Node(string s):s(s), v(0), pre(nullptr), nxt(nullptr) {};
};

class AllOne {
    vector<pair<Node*, Node*>> mp1;
    map<string, Node*> mp2;
    Node *head, *tail;
public:
    AllOne():mp1(50002) {
        head = mp1[0].second = new Node("");
        tail = mp1.back().first = new Node("");
        head->nxt = tail;
        tail->pre = head;
    }
    // å°† it èŠ‚ç‚¹æ’å…¥ tar èŠ‚ç‚¹åé¢
    void insert(Node *it, Node *tar) {
        it->nxt = tar->nxt;
        it->pre = tar;
        it->nxt->pre = it->pre->nxt = it;
        auto &[a, b] = mp1[it->v];
        if (!a && !b) {
            a = b = it;
        } else {
            a = it;
        }
    }
    // å°† it èŠ‚ç‚¹ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤
    void erase(Node *it) {
        it->pre->nxt = it->nxt;
        it->nxt->pre = it->pre;
        auto &[a, b] = mp1[it->v];
        if (a == it && b == it) {
            a = b = nullptr;
        } else if (a == it) {
            a = it->nxt;
        } else if (b == it) {
            b = it->pre;
        }
    }
    void inc(string key) {
        Node *cur = mp2.count(key) ? mp2[key] : new Node(key);
        if (cur->v) {
            erase(cur);
            cur->v++;
            if (mp1[cur->v - 1].second) {
                insert(cur, mp1[cur->v - 1].second);
            } else {
                insert(cur, cur->pre);
            }
        } else {
            mp2[key] = cur;
            cur->v++;
            insert(cur, head);
        }
    }
    
    void dec(string key) {
        Node *cur = mp2[key];
        erase(cur);
        if (cur->v == 1) {
            mp2.extract(key);
            delete cur;
        } else {
            cur->v--;
            if (mp1[cur->v].first) {
                insert(cur, mp1[cur->v].first->pre);
            } else {
                insert(cur, cur->pre);
            }
        }
    }
    
    string getMaxKey() {
        return tail->pre->s;
    }
    
    string getMinKey() {
        return head->nxt->s;
    }
};
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(1)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## åŒç±»å‹åŠ é¤ 

**AC æœ¬é¢˜çš„å‰ç½® ğŸ§€ ï¼š [å®ç°ä¸€ä¸ª LRUCacheï¼ˆæ‰‹å†™åŒå‘é“¾è¡¨å…¥é—¨é¢˜ï¼‰](https%3A//mp.weixin.qq.com/s?__biz%3DMzU4NDE3MTEyMA%3D%3D%26mid%3D2247490403%26idx%3D1%26sn%3Ddd361a87d74eec4ca9ef97efe016c906)**

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~

