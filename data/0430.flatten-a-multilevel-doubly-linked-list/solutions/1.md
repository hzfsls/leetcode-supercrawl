## [430.æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/flatten-a-multilevel-doubly-linked-list/solutions/100000/gong-shui-san-xie-yi-ti-shuang-jie-di-gu-9wfz)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)
## é€’å½’

ä¸€é“å¸¸è§„é“¾è¡¨æ¨¡æ‹Ÿé¢˜ã€‚

åˆ©ç”¨ `flatten` å‡½æ•°æœ¬èº«çš„å«ä¹‰ï¼ˆå°†é“¾è¡¨å¤´ä¸º $head$ çš„é“¾è¡¨è¿›è¡Œæ‰å¹³åŒ–ï¼Œå¹¶å°†æ‰å¹³åŒ–åçš„å¤´ç»“ç‚¹è¿›è¡Œè¿”å›ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å†™å‡ºé€’å½’ç‰ˆæœ¬ã€‚

ä¸ºé˜²æ­¢ç©ºèŠ‚ç‚¹ç­‰è¾¹ç•Œé—®é¢˜ï¼Œèµ·å§‹æ—¶å»ºç«‹ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ $dummy$ æŒ‡å‘ $head$ï¼Œç„¶ååˆ©ç”¨ $head$ æŒ‡é’ˆä»å‰å¾€åå¤„ç†é“¾è¡¨ï¼š

* å½“å‰èŠ‚ç‚¹ $head$ æ²¡æœ‰ $child$ èŠ‚ç‚¹ï¼šç›´æ¥è®©æŒ‡é’ˆåå³å¯ï¼Œå³ $head = head.next$ï¼›
* å½“å‰èŠ‚ç‚¹ $head$ æœ‰ $child$ èŠ‚ç‚¹ï¼šå°† $head.child$ ä¼ å…¥ `flatten` å‡½æ•°é€’å½’å¤„ç†ï¼Œæ‹¿åˆ°æ™®éåŒ–åçš„å¤´ç»“ç‚¹ $chead$ï¼Œç„¶åå°† $head$ å’Œ $chead$ å»ºç«‹â€œç›¸é‚»â€å…³ç³»ï¼ˆæ³¨æ„è¦å…ˆå­˜èµ·æ¥åŸæœ¬çš„ $tmp = head.next$ ä»¥åŠå°† $head.child$ ç½®ç©ºï¼‰ï¼Œç„¶åç»§ç»­å¾€åå¤„ç†ï¼Œç›´åˆ°æ‰å¹³åŒ–çš„ $chead$ é“¾è¡¨çš„å°¾éƒ¨ï¼Œå°†å…¶ä¸ $tmp$ å»ºç«‹â€œç›¸é‚»â€å…³ç³»ã€‚

é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ•´æ¡é“¾è¡¨è¢«å¤„ç†å®Œã€‚

![image.png](https://pic.leetcode-cn.com/1632439438-NXVGYC-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    public Node flatten(Node head) {
        Node dummy = new Node(0);
        dummy.next = head;
        while (head != null) {
            if (head.child == null) {
                head = head.next;
            } else {
                Node tmp = head.next;
                Node chead = flatten(head.child);
                head.next = chead;
                chead.prev = head;
                head.child = null;
                while (head.next != null) head = head.next;
                head.next = tmp;
                if (tmp != null) tmp.prev = head;
                head = tmp;
            }
        }
        return dummy.next;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šæœ€åæƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šè¢«è®¿é—® $h$ æ¬¡ï¼ˆ$h$ ä¸ºé€’å½’æ·±åº¦ï¼Œæœ€åæƒ…å†µä¸‹ $h = n$ï¼‰ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼šæœ€åæƒ…å†µä¸‹æ‰€æœ‰èŠ‚ç‚¹éƒ½åˆ†å¸ƒåœ¨ `child` ä¸­ï¼Œæ­¤æ—¶é€’å½’æ·±åº¦ä¸º $n$ã€‚å¤æ‚åº¦ä¸º $O(n)$


---

## é€’å½’ï¼ˆä¼˜åŒ–ï¼‰

åœ¨ä¸Šè¿°è§£æ³•ä¸­ï¼Œç”±äºæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `flatten` ä½œä¸ºé€’å½’å‡½æ•°ï¼Œå¯¼è‡´é€’å½’å¤„ç† $head.child$ åä¸å¾—ä¸å†è¿›è¡Œéå†æ¥æ‰¾å½“å‰å±‚çš„â€œå°¾ç»“ç‚¹â€ï¼Œè¿™å¯¼è‡´ç®—æ³•å¤æ‚åº¦ä¸º $O(n^2)$ã€‚

ä¸€ä¸ªå¯è¡Œçš„ä¼˜åŒ–æ˜¯ï¼Œé¢å¤–è®¾è®¡ä¸€ä¸ªé€’å½’å‡½æ•° `dfs` ç”¨äºè¿”å›æ‰å¹³åŒ–åçš„é“¾è¡¨â€œå°¾ç»“ç‚¹â€ï¼Œä»è€Œç¡®ä¿æˆ‘ä»¬æ‰¾å°¾ç»“ç‚¹çš„åŠ¨ä½œä¸ä¼šåœ¨æ¯å±‚å‘ç”Ÿã€‚

![image.png](https://pic.leetcode-cn.com/1632439410-oXoxbn-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    public Node flatten(Node head) {
        dfs(head);
        return head;
    }
    Node dfs(Node head) {
        Node last = head;
        while (head != null) {
            if (head.child == null) {
                last = head;
                head = head.next;
            } else {
                Node tmp = head.next;
                Node childLast = dfs(head.child);
                head.next = head.child;
                head.child.prev = head;
                head.child = null;
                if (childLast != null) childLast.next = tmp;
                if (tmp != null) tmp.prev = childLast;
                last = head;
                head = childLast;
            }
        }
        return last;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼šæœ€åæƒ…å†µä¸‹æ‰€æœ‰èŠ‚ç‚¹éƒ½åˆ†å¸ƒåœ¨ `child` ä¸­ï¼Œæ­¤æ—¶é€’å½’æ·±åº¦ä¸º $n$ã€‚å¤æ‚åº¦ä¸º $O(n)$

---

## è¿­ä»£

è‡ªç„¶ä¹Ÿèƒ½å¤Ÿä½¿ç”¨è¿­ä»£è¿›è¡Œæ±‚è§£ã€‚

ä¸ã€Œé€’å½’ã€ä¸åŒçš„æ˜¯ï¼Œã€Œè¿­ä»£ã€æ˜¯ä»¥â€œæ®µâ€ä¸ºå•ä½è¿›è¡Œæ‰å¹³åŒ–ï¼Œè€Œã€Œé€’å½’ã€æ˜¯ä»¥æ·±åº¦ï¼ˆæ–¹å‘ï¼‰è¿›è¡Œæ‰å¹³åŒ–ï¼Œè¿™å°±å¯¼è‡´äº†ä¸¤ç§æ–¹å¼å¯¹æ¯ä¸ªæ‰å¹³èŠ‚ç‚¹çš„å¤„ç†é¡ºåºä¸åŒã€‚

å·²æ ·ä¾‹ $1$ ä¸º ğŸŒ°ã€‚

é€’å½’çš„å¤„ç†èŠ‚ç‚¹ï¼ˆæ–°çš„ $next$ æŒ‡é’ˆçš„æ„å»ºï¼‰é¡ºåºä¸ºï¼š

![image.png](https://pic.leetcode-cn.com/1632439764-FsOwel-image.png)

è¿­ä»£çš„å¤„ç†èŠ‚ç‚¹ï¼ˆæ–°çš„ $next$ æŒ‡é’ˆçš„æ„å»ºï¼‰é¡ºåºä¸ºï¼š

![image.png](https://pic.leetcode-cn.com/1632439844-egvBMX-image.png)

ä½†ç”±äºé“¾è¡¨æœ¬èº«ä¸å­˜åœ¨ç¯ï¼Œã€Œè¿­ä»£ã€çš„æ„å»ºé¡ºåºå‘ç”Ÿè°ƒæ•´ï¼Œä»ç„¶å¯ä»¥ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ä¸ºå¸¸æ•°æ¬¡ã€‚

![image.png](https://pic.leetcode-cn.com/1632439410-oXoxbn-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    public Node flatten(Node head) {
        Node dummy = new Node(0);
        dummy.next = head;
        for (; head != null; head = head.next) {
            if (head.child != null) {
                Node tmp = head.next;
                Node child = head.child;
                head.next = child;
                child.prev = head;
                head.child = null;
                Node last = head;
                while (last.next != null) last = last.next;
                last.next = tmp;
                if (tmp != null) tmp.prev = last;
            }
        }
        return dummy.next;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šå¯ä»¥å‘ç°ï¼Œè¿­ä»£å†™æ³•çš„æ‰å¹³åŒ–è¿‡ç¨‹å¹¶ä¸ä¸éå†æ–¹å‘ä¿æŒä¸€è‡´ï¼ˆä»¥æ®µä¸ºå•ä½è¿›è¡Œæ‰å¹³åŒ–ï¼Œè€Œéåƒé€’å½’é‚£æ ·æ€»æ˜¯å¾€éå†æ–¹å‘è¿›è¡Œæ‰å¹³åŒ–ï¼‰ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ä»ä¸ºå¸¸æ•°æ¬¡ã€‚å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$

---

## å…¶ä»–ã€Œé“¾è¡¨ã€ç±»çš„å†…å®¹

å¯å°è¯•åŠ ç»ƒå¦‚ä¸‹ã€Œé“¾è¡¨ã€ç±»å†…å®¹ ğŸ­ğŸ­ğŸ­ ï¼š

| é¢˜ç›®                                                             | é¢˜è§£                                                                                                                             | éš¾åº¦ | æ¨èæŒ‡æ•° |
| ---------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- | ---- | -------- |
| [2. ä¸¤æ•°ç›¸åŠ ](https://leetcode-cn.com/problems/add-two-numbers/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/add-two-numbers/solution/po-su-jie-fa-shao-bing-ji-qiao-by-ac_oie-etln/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©   |
| [19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹](https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/solution/shua-chuan-lc-lian-biao-kuai-man-zhi-zhe-1gs1/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨](https://leetcode-cn.com/problems/merge-two-sorted-lists/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/merge-two-sorted-lists/solution/shua-chuan-lc-shuang-zhi-zhen-jie-fa-sha-b22z/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨](https://leetcode-cn.com/problems/merge-k-sorted-lists/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/merge-k-sorted-lists/solution/shua-chuan-lc-you-xian-dui-lie-jie-fa-sh-3flb/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤© |
| [24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/swap-nodes-in-pairs/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/swap-nodes-in-pairs/solution/shua-chuan-lc-di-gui-die-dai-jie-fa-shao-70t3/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨](https://leetcode-cn.com/problems/reverse-nodes-in-k-group/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/reverse-nodes-in-k-group/solution/shua-chuan-lc-duo-tu-jiang-jie-di-gui-gu-6wr0/) | å›°éš¾ | ğŸ¤©ğŸ¤© |
| [61. æ—‹è½¬é“¾è¡¨](https://leetcode-cn.com/problems/rotate-list/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/rotate-list/solution/kuai-man-zhi-zhen-ru-he-fen-bu-zou-jie-j-ns7u/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤© |
| [83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ ](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/solution/tong-yong-shan-chu-zhong-fu-jie-dian-lia-101c/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [82. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´  II](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list-ii/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list-ii/solution/tong-yong-shan-chu-zhong-fu-jie-dian-lia-od9g/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [92. åè½¬é“¾è¡¨ II](https://leetcode-cn.com/problems/reverse-linked-list-ii/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/reverse-linked-list-ii/solution/yi-ge-neng-ying-yong-suo-you-lian-biao-t-vjx6/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤© |
| [138. å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨](https://leetcode-cn.com/problems/copy-list-with-random-pointer/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/copy-list-with-random-pointer/solution/gong-shui-san-xie-yi-ti-shuang-jie-ha-xi-pqek/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤© |
| [160. ç›¸äº¤é“¾è¡¨](https://leetcode-cn.com/problems/intersection-of-two-linked-lists/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/intersection-of-two-linked-lists/solution/gong-shui-san-xie-zhao-liang-tiao-lian-b-h3bd/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [146. LRU ç¼“å­˜æœºåˆ¶](https://leetcode-cn.com/problems/lru-cache/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/lru-cache/solution/gong-shui-san-xie-she-ji-shu-ju-jie-gou-68hv2/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [203. ç§»é™¤é“¾è¡¨å…ƒç´ ](https://leetcode-cn.com/problems/remove-linked-list-elements/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/remove-linked-list-elements/solution/gong-shui-san-xie-yi-chu-lian-biao-yuan-ca6fu/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤© |
| [430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨](https://leetcode-cn.com/problems/flatten-a-multilevel-doubly-linked-list/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/flatten-a-multilevel-doubly-linked-list/solution/gong-shui-san-xie-yi-ti-shuang-jie-di-gu-9wfz/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [460. LFU ç¼“å­˜](https://leetcode-cn.com/problems/lfu-cache/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/lfu-cache/solution/gong-shui-san-xie-yun-yong-tong-pai-xu-s-53m3/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [725. åˆ†éš”é“¾è¡¨](https://leetcode-cn.com/problems/split-linked-list-in-parts/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/split-linked-list-in-parts/solution/gong-shui-san-xie-jing-dian-lian-biao-ju-9yj4/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [1600. çš‡ä½ç»§æ‰¿é¡ºåº](https://leetcode-cn.com/problems/throne-inheritance/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/throne-inheritance/solution/gong-shui-san-xie-shi-yong-dan-xiang-lia-7t65/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤© |
| [å‰‘æŒ‡ Offer 22. é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹](https://leetcode-cn.com/problems/lian-biao-zhong-dao-shu-di-kge-jie-dian-lcof/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/lian-biao-zhong-dao-shu-di-kge-jie-dian-lcof/solution/gong-shui-san-xie-yi-ti-san-jie-zhan-dui-w3rz/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |
| [å‰‘æŒ‡ Offer 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹](https://leetcode-cn.com/problems/liang-ge-lian-biao-de-di-yi-ge-gong-gong-jie-dian-lcof/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/liang-ge-lian-biao-de-di-yi-ge-gong-gong-jie-dian-lcof/solution/gong-shui-san-xie-zhao-liang-tiao-lian-b-ifqw/) | ç®€å• | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤© |

**æ³¨ï¼šä»¥ä¸Šç›®å½•æ•´ç†æ¥è‡ª [wiki](https://github.com/SharingSource/LogicStack-LeetCode/wiki/é“¾è¡¨)ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½å¼•ç”¨è¯·ä¿ç•™å‡ºå¤„ã€‚**

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 