## [615.å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/average-salary-departments-vs-company/solutions/100000/by-zg104-lytn)

ä½œè€…ï¼š[zg104](https://leetcode.cn/u/zg104)

##### æ€è·¯

é¦–å…ˆè®¡ç®—**æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä¸å…¬å¸çš„å¹³å‡å·¥èµ„**ï¼Œä»æ•°æ®å±‚é¢å‡ºå‘ï¼Œå…ˆåˆ©ç”¨çª—å£å‡½æ•°æ‰©å……æ•°æ®ï¼ˆå¢åŠ åˆ—ï¼‰ï¼Œå†ç”¨æ¡ä»¶ç­›é€‰ã€‚

##### ç®—æ³•

1. è®¡ç®—**æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä¸å…¬å¸çš„å¹³å‡å·¥èµ„**

```sql
-- éƒ¨é—¨
avg(amount) over(partition by department_id, pay_date) 
-- å…¬å¸
avg(amount) over(partition by pay_date) 
```

2. case when è½¬åŒ–

```sql
case
    when
        avg(amount) over(partition by department_id, pay_date) 
        < avg(amount) over(partition by pay_date) then "lower"
    when 
        avg(amount) over(partition by department_id, pay_date) 
        > avg(amount) over(partition by pay_date) then "higher"
    else 'same' end as comparison
```

3. left joinæ•´åˆå³å¯

##### ç­”æ¡ˆ

```sql
select distinct * from
(select 
    date_format(s.pay_date, '%Y-%m') as pay_month, 
    e.department_id, 
    case 
        when avg(amount) over (partition by e.department_id, s.pay_date) 
            < avg(amount) over (partition by s.pay_date) then 'lower'
        when avg(amount) over (partition by e.department_id, s.pay_date) 
            > avg(amount) over (partition by s.pay_date) then 'higher'
    else 'same' end as comparison
from salary s left join employee e
on s.employee_id = e.employee_id) a
order by 1 desc
```

ğŸ¥°è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œç‚¹ä¸ªèµï¼ŒåŠ ä¸ªå…³æ³¨å§~ğŸ¥°