## [1044.æœ€é•¿é‡å¤å­ä¸² ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/longest-duplicate-substring/solutions/100000/gong-shui-san-xie-zi-fu-chuan-ha-xi-ying-hae9)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)

## å­—ç¬¦ä¸²å“ˆå¸Œ + äºŒåˆ†

é¢˜ç›®è¦æ±‚å¾—ã€Œèƒ½å–å¾—æœ€å¤§é•¿åº¦çš„ä»»ä¸€æ–¹æ¡ˆã€ï¼Œé¦–å…ˆä»¥ã€Œæœ€å¤§é•¿åº¦ã€ä¸ºåˆ†å‰²ç‚¹çš„æ•°è½´å…·æœ‰ã€ŒäºŒæ®µæ€§ã€ï¼š

* å°äºç­‰äºæœ€å¤§é•¿åº¦æ–¹æ¡ˆå‡å­˜åœ¨ï¼ˆè€ƒè™‘åœ¨æœ€å¤§é•¿åº¦æ–¹æ¡ˆä¸Šåšåˆ å‡ï¼‰ï¼›
* å¤§äºæœ€å¤§é•¿åº¦çš„æ–¹æ¡ˆä¸å­˜åœ¨ã€‚

äºŒåˆ†èŒƒå›´ä¸º $[0, n]$ï¼Œå…³é”®åœ¨äºå¦‚ä½• `check` å‡½æ•°ï¼Œå³å®ç°ã€Œæ£€æŸ¥æŸä¸ªé•¿åº¦ $len$ ä½œä¸ºæœ€å¤§é•¿åº¦ï¼Œæ˜¯å¦å­˜åœ¨åˆæ³•æ–¹æ¡ˆã€ã€‚

å¯¹äºå¸¸è§„åšæ³•è€Œè¨€ï¼Œå¯æšä¸¾æ¯ä¸ªä½ç½®ä½œä¸ºèµ·ç‚¹ï¼Œå¾—åˆ°é•¿åº¦ä¸º $len$ çš„å­ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ `Set<String>` å®¹å™¨è®°å½•å·²è¢«å¤„ç†è¿‡å­ä¸²æœ‰å“ªäº›ï¼Œå½“å®¹å™¨ä¸­å‡ºç°è¿‡å½“å‰å­ä¸²ï¼Œè¯´æ˜å­˜åœ¨åˆæ³•æ–¹æ¡ˆã€‚

ä½†æ˜¯è¯¥åšæ³•å®ç°çš„ `check` å¹¶éçº¿æ€§ï¼Œå­ä¸²çš„ç”Ÿæˆå’Œå­˜å…¥å®¹å™¨çš„æ—¶æ‰§è¡Œçš„å“ˆå¸Œå‡½æ•°æ‰§è¡Œå‡å’Œå­ä¸²é•¿åº¦ç›¸å…³ï¼Œå¤æ‚åº¦æ˜¯ $O(n * len)$ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ã€Œå­—ç¬¦ä¸²å“ˆå¸Œã€è¿›è¡Œä¼˜åŒ–ï¼Œå¯¹ã€Œå­—ç¬¦ä¸²å“ˆå¸Œã€ä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥çœ‹å‰ç½® ğŸ§€ [å­—ç¬¦ä¸²å“ˆå¸Œå…¥é—¨](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247489813&idx=1&sn=7f3bc18ca390d85b17655f7164d8e660&chksm=fd9cb20acaeb3b1cc78abf05d6fea6d093098998ce877f799ac478247604bd267fbee6fcd989&token=1342991619&lang=zh_CN#rd)ã€‚

å…·ä½“çš„ï¼Œåœ¨äºŒåˆ†å‰å…ˆé€šè¿‡ $O(n)$ çš„å¤æ‚åº¦é¢„å¤„ç†å‡ºå“ˆå¸Œæ•°ç»„ï¼Œä»è€Œç¡®ä¿èƒ½å¤Ÿåœ¨ `check` æ—¶èƒ½å¤Ÿ $O(1)$ å¾—åˆ°æŸä¸ªå­ä¸²çš„å“ˆå¸Œå€¼ï¼Œæœ€ç»ˆå°† `check` çš„å¤æ‚åº¦é™ä¸º $O(n)$ã€‚

![image.png](https://pic.leetcode-cn.com/1640221520-iarJZE-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    long[] h, p;
    public String longestDupSubstring(String s) {
        int P = 1313131, n = s.length();
        h = new long[n + 10]; p = new long[n + 10];
        p[0] = 1;
        for (int i = 0; i < n; i++) {
            p[i + 1] = p[i] * P;
            h[i + 1] = h[i] * P + s.charAt(i);
        }
        String ans = "";
        int l = 0, r = n;
        while (l < r) {
            int mid = l + r + 1 >> 1;
            String t = check(s, mid);
            if (t.length() != 0) l = mid;
            else r = mid - 1;
            ans = t.length() > ans.length() ? t : ans;
        }
        return ans;
    }
    String check(String s, int len) {
        int n = s.length();
        Set<Long> set = new HashSet<>();
        for (int i = 1; i + len - 1 <= n; i++) {
            int j = i + len - 1;
            long cur = h[j] - h[i - 1] * p[j - i + 1];
            if (set.contains(cur)) return s.substring(i - 1, j);
            set.add(cur);
        }
        return "";
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $n$ ä¸ºå­—ç¬¦ä¸² `s` çš„é•¿åº¦ï¼Œé¢„å¤„ç†å‡ºå“ˆå¸Œæ•°ç»„çš„å¤æ‚åº¦ä¸º $O(n)$ï¼›äºŒåˆ†æœ€å¤§é•¿åº¦çš„å¤æ‚åº¦ä¸º $O(n\log{n})$ï¼›æ•´ä½“å¤æ‚åº¦ä¸º $O(n\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## åç¼€æ•°ç»„ 

å¦å¤–ä¸€ä¸ªè¾ƒä¸ºè¿›é˜¶çš„åšæ³•æ˜¯ä½¿ç”¨ã€Œåç¼€æ•°ç»„ã€ï¼Œåç¼€æ•°ç»„æœ‰åŸºäºåŸºæ•°æ’åºçš„å€å¢å®ç°ï¼Œå¤æ‚åº¦ä¸º $O(n\log{n})$ï¼Œä¹Ÿæœ‰åŸºäº `DC3` çš„ $O(n)$ åšæ³•ã€‚

`DC3` çš„åšæ³•å·²ç»å†™ä¸å‡ºæ¥äº†ï¼Œå†™ä¸€ä¸ªåŸºäºã€ŒåŸºæ•°æ’åºã€çš„å€å¢åšæ³•ã€‚

åç¼€æ•°ç»„åŒ…å«å‡ ä¸ªæ ¸å¿ƒæ•°ç»„ï¼š

* `sa` æ•°ç»„ï¼šå­—å…¸åºæ’åä¸º $i$ çš„åç¼€æ˜¯ç¬¬å‡ ä¸ªï¼›
* `rk` æ•°ç»„ï¼šç¬¬ $i$ ä¸ªåç¼€çš„æ’åæ˜¯å¤šå°‘ï¼ˆä¸éš¾å‘ç° `rk` ä¸ `sa` æ»¡è¶³ $sa[rk[i]] = rk[sa[i]] = i$ï¼‰ï¼›
* `height` æ•°ç»„ï¼šå­˜å‚¨ $sa[i]$ ä¸ $sa[i - 1]$ çš„ `LCPï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰` ä¸ºä½•å€¼ã€‚

![image.png](https://pic.leetcode-cn.com/1640221526-THtzau-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    int N = 30010;
    int[] x = new int[N], y = new int[N], c = new int[N];
    int[] sa = new int[N], rk = new int[N], height = new int[N];
    void swap(int[] a, int[] b) {
        int n = a.length;
        int[] c = a.clone();
        for (int i = 0; i < n; i++) a[i] = b[i];
        for (int i = 0; i < n; i++) b[i] = c[i];
    }
    public String longestDupSubstring(String s) {
        int n = s.length(), m = 128;
        s = " " + s;
        char[] cs = s.toCharArray();
        // saï¼šä¸¤éåŸºæ•°æ’åºï¼Œæ¿å­èƒŒä¸ä¸‹æ¥ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ sortï¼Œå¤æ‚åº¦é€€åŒ–åˆ° n \log^2 n
        for (int i = 1; i <= n; i++) {
            x[i] = cs[i]; c[x[i]]++;
        }
        for (int i = 2; i <= m; i++) c[i] += c[i - 1];
        for (int i = n; i > 0; i--) sa[c[x[i]]--] = i;
        for (int k = 1; k <= n; k <<= 1) {
            int cur = 0;
            for (int i = n - k + 1; i <= n; i++) y[++cur] = i;
            for (int i = 1; i <= n; i ++) {
                if (sa[i] > k) y[++cur] = sa[i] - k;
            }
            for (int i = 1; i <= m; i++) c[i] = 0;
            for (int i = 1; i <= n; i++) c[x[i]]++;
            for (int i = 2; i <= m; i++) c[i] += c[i - 1];
            for (int i = n; i > 0; i--) {
                sa[c[x[y[i]]]--] = y[i];
                y[i] = 0;
            }
            swap(x, y);
            x[sa[1]] = cur = 1;
            for (int i = 2; i <= n; i++) {
                if (y[sa[i]] == y[sa[i - 1]] && y[sa[i] + k] == y[sa[i - 1] + k]) x[sa[i]] = cur;
                else x[sa[i]] = ++cur;
            }
            if (cur == n) break;
            m = cur;
        }
        // height
        int k = 0;
        for (int i = 1; i <= n; i ++) rk[sa[i]] = i;
        for (int i = 1; i <= n; i++) {
            if (rk[i] == 1) continue;
            int j = sa[rk[i] - 1];
            k = k > 0 ? k - 1 : k;
            while (i + k <= n && j + k <= n && cs[i + k] == cs[j + k]) k++;
            height[rk[i]] = k;
        }
        int idx = -1, max = 0;
        for (int i = 1; i <= n; i++) {
            if (height[i] > max) {
                max = height[i];
                idx = sa[i];
            }
        }
        return max == 0 ? "" : s.substring(idx, idx + max);
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png) å’Œ åŠ å…¥æˆ‘ä»¬çš„[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 