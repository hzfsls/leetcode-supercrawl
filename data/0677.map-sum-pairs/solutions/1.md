## [677.é”®å€¼æ˜ å°„ ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/map-sum-pairs/solutions/100000/gong-shui-san-xie-jie-he-dfs-de-trie-yun-i4xa)

ä½œè€…ï¼š[AC_OIer](https://leetcode.cn/u/AC_OIer)
## Trie + DFS

ä»éœ€è¦å®ç°ã€Œå­˜å‚¨å­—ç¬¦ä¸²ï¼ˆæ˜ å°„å…³ç³»ï¼‰ã€å¹¶ã€Œæ£€ç´¢æŸä¸ªå­—ç¬¦ä¸²å‰ç¼€çš„æ€»å’Œã€æ¥çœ‹ï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯ä¸ $Trie$ ç›¸å…³çš„é¢˜ç›®ï¼Œè¿˜ä¸äº†è§£ $Trie$ çš„åŒå­¦å¯ä»¥å…ˆçœ‹å‰ç½® ğŸ§€ï¼š[å®ç° Trie (å‰ç¼€æ ‘)](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247488490&idx=1&sn=db2998cb0e5f08684ee1b6009b974089&chksm=fd9cb8f5caeb31e3f7f67dba981d8d01a24e26c93ead5491edb521c988adc0798d8acb6f9e9d&token=59039721&lang=zh_CN#rd) ã€‚

è€ƒè™‘å¦‚ä½•å®ç°ä¸¤ä¸ªæ“ä½œï¼š

* `insert` ï¼šåœ¨åŸºæœ¬çš„ $Trie$ æ’å…¥æ“ä½œçš„åŸºç¡€ä¸Šè¿›è¡Œæ‹“å±•å³å¯ã€‚ä¸å¸¸è§„çš„æ’å…¥æ“ä½œçš„å”¯ä¸€åŒºåˆ«ä¸ºï¼Œä¸èƒ½ç®€å•è®°å½•å•è¯çš„ç»“æŸä½ç½®ï¼Œè¿˜è¦å­˜å‚¨ $key$ å¯¹åº”çš„ $val$ æ˜¯å¤šå°‘ã€‚å…·ä½“çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `int` ç±»å‹çš„æ•°ç»„ $hash$ æ¥ä»£æ›¿åŸæœ‰çš„ `boolean` ç±»å‹çš„æ•°ç»„ $isWord$ï¼›

* `sum` ï¼š å…ˆå¯¹å…¥å‚ $prefix$ è¿›è¡Œå­—å…¸æ ‘æœç´¢ï¼Œåˆ°è¾¾å°¾éƒ¨åå†ä½¿ç”¨ `DFS` æœç´¢åé¢çš„æ‰€æœ‰æ–¹æ¡ˆï¼Œå¹¶ç´¯åŠ ç»“æœã€‚

ä»£ç ï¼ˆ`static` ä¼˜åŒ–ä»£ç è§ $P2$ï¼Œé¿å…æ¯ä¸ªæ ·ä¾‹éƒ½ `new` å¤§æ•°ç»„ï¼‰ï¼š
```Java []
class MapSum {
    int[][] tr = new int[2510][26];
    int[] hash = new int[2510];
    int idx;
    public void insert(String key, int val) {
        int p = 0;
        for (int i = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
        }
        hash[p] = val;
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return dfs(p);
    }
    int dfs(int p) {
        int ans = hash[p];
        for (int u = 0; u < 26; u++) {
            if (tr[p][u] != 0) ans += dfs(tr[p][u]);
        }
        return ans;
    }
}
```
```Java []
class MapSum {
    static int[][] tr = new int[2510][26];
    static int[] hash = new int[2510];
    static int idx;
    public MapSum() {
        for (int i = 0; i <= idx; i++) Arrays.fill(tr[i], 0);
        Arrays.fill(hash, 0);
        idx = 0;
    }
    public void insert(String key, int val) {
        int p = 0;
        for (int i = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
        }
        hash[p] = val;
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return dfs(p);
    }
    int dfs(int p) {
        int ans = hash[p];
        for (int u = 0; u < 26; u++) {
            if (tr[p][u] != 0) ans += dfs(tr[p][u]);
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $key$ çš„æœ€å¤§é•¿åº¦ä¸º $n$ï¼Œæœ€å¤§è°ƒç”¨æ¬¡æ•°ä¸º $m$ï¼Œå­—ç¬¦é›†å¤§å°ä¸º $C$ï¼ˆ æœ¬é¢˜ $C$ å›ºå®šä¸º $26$ ï¼‰ï¼Œ`insert` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$ï¼›ä» `DFS` çš„è§’åº¦åˆ†æï¼Œ`sum` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(C^n)$ï¼Œä½†äº‹å®ä¸Šï¼Œå¯¹äºæœ¬é¢˜å…·æœ‰æ˜ç¡®çš„è®¡ç®—é‡ä¸Šç•Œï¼Œæœç´¢æ‰€æœ‰çš„æ ¼å­çš„å¤æ‚åº¦ä¸º $O(n * m * C)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n * m * C)$

---

## Trie è®°å½•å‰ç¼€å­—ç¬¦ä¸²æ€»å’Œ

ä¸ºé™ä½ `sum` æ“ä½œçš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `insert` æ“ä½œä¸­åŒæ—¶è®°å½•ï¼ˆç´¯åŠ ï¼‰æ¯ä¸ªå‰ç¼€çš„æ€»å’Œã€‚

ä»£ç ï¼ˆ`static` ä¼˜åŒ–ä»£ç è§ $P2$ï¼Œé¿å…æ¯ä¸ªæ ·ä¾‹éƒ½ `new` å¤§æ•°ç»„ï¼‰ï¼š
```Java []
class MapSum {
    int N = 2510;
    int[][] tr = new int[N][26];
    int[] hash = new int[N];
    int idx;
    Map<String, Integer> map = new HashMap<>();
    public void insert(String key, int val) {
        int _val = val;
        if (map.containsKey(key)) val -= map.get(key);
        map.put(key, _val);
        for (int i = 0, p = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
            hash[p] += val;
        }
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return hash[p];
    }
}
```
```Java []
class MapSum {
    static int N = 2510;
    static int[][] tr = new int[N][26];
    static int[] hash = new int[N];
    static int idx;
    static Map<String, Integer> map = new HashMap<>();
    public MapSum() {
        for (int i = 0; i <= idx; i++) Arrays.fill(tr[i], 0);
        Arrays.fill(hash, 0);
        idx = 0;
        map.clear();
    }
    public void insert(String key, int val) {
        int _val = val;
        if (map.containsKey(key)) val -= map.get(key);
        map.put(key, _val);
        for (int i = 0, p = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
            hash[p] += val;
        }
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return hash[p];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $key$ çš„æœ€å¤§é•¿åº¦ä¸º $n$ï¼Œ`insert` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$ï¼›`sum` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼šä»¤ $key$ çš„æœ€å¤§é•¿åº¦ä¸º $n$ï¼Œæœ€å¤§è°ƒç”¨æ¬¡æ•°ä¸º $m$ï¼Œå­—ç¬¦é›†å¤§å°ä¸º $C$ï¼ˆ æœ¬é¢˜ $C$ å›ºå®šä¸º $26$ ï¼‰ï¼Œå¤æ‚åº¦ä¸º $O(n * m * C)$

---

## æ›´å¤šã€ŒTrieã€ç›¸å…³å†…å®¹

æ„çŠ¹æœªå°½ï¼Ÿè€ƒè™‘åŠ é¤å¦‚ä¸‹ $Trie$ å†…å®¹ï¼š

* [$Trie$ ç¬¬ä¸€éƒ¨ï¼ˆTrie æ¨¡æ¿é¢˜ï¼‰](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247488490&idx=1&sn=db2998cb0e5f08684ee1b6009b974089&chksm=fd9cb8f5caeb31e3f7f67dba981d8d01a24e26c93ead5491edb521c988adc0798d8acb6f9e9d&scene=178&cur_album_id=2049538161285955584#rd)
* [$Trie$ ç¬¬äºŒéƒ¨ï¼ˆTrie ä¼˜åŒ– DFS æœç´¢ï¼‰](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247489083&idx=1&sn=1971fdceb180ef3c7d51f8fbb81527d0&chksm=fd9cbd24caeb34321076e3f34bae0c001c9032b2b1814d15badab26cd4e8cddf48ac051550f6&scene=178&cur_album_id=2049538161285955584#rd)
* [$Trie$ ç¬¬ä¸‰éƒ¨ï¼ˆç»“åˆè´ªå¿ƒçš„ Trieï¼‰](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247489106&idx=1&sn=b7c1d4864f42e8a54f4b4754ff9ba8d7&chksm=fd9cbd4dcaeb345b5e39e799bdbeb2e89ed424c763e2af2a23fcb8eab228acc46d10f0395686&token=1901895674&lang=zh_CN#rd)
* [$Trie$ ç¬¬å››éƒ¨ï¼ˆå¯åˆ é™¤/å¯è®¡æ•°çš„ Trieï¼‰](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247489259&idx=1&sn=042ee479cebfbcf1f3b517461b32ddac&chksm=fd9cbdf4caeb34e2254783b211bac795eb0c9bd9b4be844cf48450ca5afa7ca5694fd98f7d39&token=1848397639&lang=zh_CN#rd) 

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 