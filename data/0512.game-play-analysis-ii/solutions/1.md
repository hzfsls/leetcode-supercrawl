## [512.æ¸¸æˆç©æ³•åˆ†æ II ä¸­æ–‡çƒ­é—¨é¢˜è§£1](https://leetcode.cn/problems/game-play-analysis-ii/solutions/100000/by-zg104-xt7d)

ä½œè€…ï¼š[zg104](https://leetcode.cn/u/zg104)
##### æ€è·¯

ä¸Šä¸€é¢˜ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºäº†æ¯ä¸ªç©å®¶æ˜¯é¦–æ¬¡ç™»é™†æ—¥æœŸï¼Œè¿™å›æˆ‘ä»¬è¦æ ¹æ®é¦–æ¬¡ç™»é™†æ—¥æœŸï¼Œå†å»å¯»æ‰¾å¯¹åº”çš„è®¾å¤‡åç§°ï¼Œé‚£ä¹ˆè·Ÿç€ä¸Šé¢˜æ€è·¯ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨**å­æŸ¥è¯¢ where in çš„è”åˆåŒ¹é…**ã€‚

å¦‚æœæŠ›å¼€ä¸Šä¸€é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**çª—å£å‡½æ•°æ’åº**ï¼Œç„¶ååˆ©ç”¨æ’åºä½œä¸ºç­›é€‰æ¡ä»¶ã€‚

##### ç®—æ³•

1. ä¸ç”¨çª—å£ï¼šåŒ¹é…`(player_id, event_date)`æ˜¯å¦åœ¨æ¯ä¸€ä¸ªç©å®¶çš„é¦–æ¬¡ç™»é™†æ—¥æœŸä¸­
2. ç”¨çª—å£ï¼šå…ˆæŒ‰æ—¶é—´æ’å€’åºï¼Œå†åˆ©ç”¨æ’åº`rnk=1`ç­›é€‰

##### SQLç­”æ¡ˆ

1. ä¸ç”¨çª—å£å‡½æ•°ï¼Œä½¿ç”¨è”åˆé”®å­æŸ¥è¯¢ where in ç­›é€‰

```sql
select 
	player_id, device_id
from activity
where (player_id, event_date) in 
(
    select player_id, min(event_date)
	from activity
	group by player_id
)
```

```sql
# è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼
# å¿…é¡»ç”¨è”åˆé”®æ¥åŒ¹é…
select 
	player_id, device_id
from activity
where event_date in 
(
    select min(event_date)
	from activity
	group by player_id
)
```


è¿™é‡Œä½ ä¼šå‘ç°ä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œæµ‹è¯•ç”¨ä¾‹èƒ½è¿‡ï¼Œä½†æ˜¯submitå´è¿‡ä¸äº†ï¼Œä¸ºå•¥ï¼Ÿ

å› ä¸ºå¯èƒ½å­˜åœ¨player Açš„event_dateå’Œplayer Bçš„min(event_date)åŒ¹é…åˆ°äº†ï¼Œè¿™æ˜¯ä¸è¡Œçš„ï¼

```sql
select 
	player_id, device_id
from 
(
    select player_id, device_id, min(event_date)
	from activity
	group by player_id
)
```

ä¸Šé¢è¿™ä¸ªä¹Ÿæ˜¯ï¼Œæµ‹è¯•ç”¨ä¾‹èƒ½è¿‡ï¼Œä½†æ˜¯submitå´è¿‡ä¸äº†ï¼Œä¸ºå•¥ï¼Ÿ

å› ä¸ºgroup by player_idï¼Œå¹¶ä¸èƒ½ä¿è¯ä½ select player_id, device_id, min(event_date)é‡Œé¢çš„device_idå°±æ˜¯min(event_date)ï¼

group by player_id, device_idä¹Ÿä¸å¯¹ï¼Œ å› ä¸ºè¿™ç§æ–¹å¼æ²¡åŠæ³•æ‰¾åˆ°min(event_date)å¯¹åº”çš„device

é‚£ä¸ºä»€ä¹ˆæµ‹è¯•ç»“æœæ˜¯å¯¹çš„ï¼Ÿå› ä¸ºä½ åªgroup by playerid å¯¹äºdevice idåªä¼šè¿”å›å½“å‰groupä¸­çš„ç¬¬ä¸€ä¸ªdevice idï¼Œç”±äºgroupä¸­çš„ç¬¬ä¸€ä¸ªdevice idæ°å¥½åœ¨ç”¨ä¾‹ä¸­å¯¹åº”ç€è¯¥groupçš„min(event_date)ï¼Œå¯¼è‡´äº†å·§åˆï¼Œå½“min(event_date)ä¸å‡ºç°åœ¨groupçš„ç¬¬ä¸€ä¸ªä½ç½®çš„æ—¶å€™å°±æ˜¯é”™çš„ï¼



âœï¸å°æŠ€å·§ï¼š

![image.png](https://pic.leetcode-cn.com/1651745557-JqFxKG-image.png)


2. çª—å£

```sql
select 
	player_id, device_id
from 
(
    select 
    	player_id, 
    	device_id, 
    	dense_rank() over(partition by player_id 
                          order by event_date asc) rnk 
   	from activity
) a where rnk=1
```


##### Pandasç­”æ¡ˆ

```python
import pandas as pd

def game_analysis(activity: pd.DataFrame) -> pd.DataFrame:
    data = activity.copy()

    # çª—å£å‡½æ•°
    data['rnk'] = data.groupby('player_id')['event_date'].rank(method='first')
    result = data[data['rnk'] == 1][['player_id', 'device_id']]

    # indexç­›é€‰
    # ä½¿ç”¨ groupby å’Œ idxmin() å‡½æ•°æ¥æ‰¾åˆ°æ¯ä¸ª player_id å¯¹åº”çš„æœ€æ—©çš„ event_date çš„ç´¢å¼•
    earliest_indices = data.groupby('player_id')['event_date'].idxmin()
    # é€šè¿‡ç´¢å¼•é€‰æ‹©ç›¸åº”çš„è¡Œï¼Œå¹¶æå– player_id å’Œ device_id åˆ—
    result = data.loc[earliest_indices, ['player_id', 'device_id']]
    return result
```

ğŸ¥°è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œç‚¹ä¸ªèµï¼ŒåŠ ä¸ªå…³æ³¨å§~ğŸ¥°



